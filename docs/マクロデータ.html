<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 2 マクロデータ | chap2</title>
  <meta name="description" content=" 2 マクロデータ | chap2" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content=" 2 マクロデータ | chap2" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 2 マクロデータ | chap2" />
  
  
  

<meta name="author" content="econ" />


<meta name="date" content="2023-08-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"/>
<link rel="next" href="民主主義国家データ.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R & 社会経済データ</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>はじめに</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#本資料の目的"><i class="fa fa-check"></i><b>0.1</b> 本資料の目的</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#社会経済データベース"><i class="fa fa-check"></i><b>0.2</b> 社会経済データベース</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><i class="fa fa-check"></i><b>1</b> RStudioのProject管理とさまざまなデータ形式の読み込み方法</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#rstudioのprojectの利用"><i class="fa fa-check"></i><b>1.1</b> RStudioのProjectの利用</a></li>
<li class="chapter" data-level="1.2" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#多様なデータ形式の読み込み方法"><i class="fa fa-check"></i><b>1.2</b> 多様なデータ形式の読み込み方法</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#import-datasetを利用する"><i class="fa fa-check"></i><b>1.2.1</b> Import Datasetを利用する</a></li>
<li class="chapter" data-level="1.2.2" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#関数を利用する"><i class="fa fa-check"></i><b>1.2.2</b> 関数を利用する</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#tidyverse1-1"><i class="fa fa-check"></i><b>1.3</b> tidyverse[^1-1]</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#特定の行を抽出する---filter関数"><i class="fa fa-check"></i><b>1.3.1</b> 特定の行を抽出する - filter()関数</a></li>
<li class="chapter" data-level="1.3.2" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#特定の列を抽出する---select関数"><i class="fa fa-check"></i><b>1.3.2</b> 特定の列を抽出する - select()関数</a></li>
<li class="chapter" data-level="1.3.3" data-path="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html"><a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html#処理をつなげる---パイプ演算子"><i class="fa fa-check"></i><b>1.3.3</b> 処理をつなげる - パイプ演算子 %&gt;%</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="マクロデータ.html"><a href="マクロデータ.html"><i class="fa fa-check"></i><b>2</b> マクロデータ</a>
<ul>
<li class="chapter" data-level="2.1" data-path="マクロデータ.html"><a href="マクロデータ.html#groningen-growth-and-development-centre"><i class="fa fa-check"></i><b>2.1</b> Groningen Growth and Development Centre</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="マクロデータ.html"><a href="マクロデータ.html#pwt"><i class="fa fa-check"></i><b>2.1.1</b> Penn World Table ― pwt10</a></li>
<li class="chapter" data-level="2.1.2" data-path="マクロデータ.html"><a href="マクロデータ.html#mpd"><i class="fa fa-check"></i><b>2.1.2</b> The Maddison Project Database ― maddison</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="マクロデータ.html"><a href="マクロデータ.html#WD"><i class="fa fa-check"></i><b>2.2</b> 世界銀行World Bank ― WDI</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="マクロデータ.html"><a href="マクロデータ.html#インストール方法"><i class="fa fa-check"></i><b>2.2.1</b> インストール方法</a></li>
<li class="chapter" data-level="2.2.2" data-path="マクロデータ.html"><a href="マクロデータ.html#データを探す--wdisearch"><i class="fa fa-check"></i><b>2.2.2</b> データを探す- WDISearch()</a></li>
<li class="chapter" data-level="2.2.3" data-path="マクロデータ.html"><a href="マクロデータ.html#データをダウンロードする--wdi"><i class="fa fa-check"></i><b>2.2.3</b> データをダウンロードする- WDI()</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="マクロデータ.html"><a href="マクロデータ.html#EC"><i class="fa fa-check"></i><b>2.3</b> EU統計局Eurostat - eurostat</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="マクロデータ.html"><a href="マクロデータ.html#rパッケージeurostatの利用法"><i class="fa fa-check"></i><b>2.3.1</b> Rパッケージeurostatの利用法</a></li>
<li class="chapter" data-level="2.3.2" data-path="マクロデータ.html"><a href="マクロデータ.html#応用例-地理空間情報の利用"><i class="fa fa-check"></i><b>2.3.2</b> 応用例 ― 地理空間情報の利用</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="マクロデータ.html"><a href="マクロデータ.html#OECD"><i class="fa fa-check"></i><b>2.4</b> 経済協力開発機構 - OECD</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="マクロデータ.html"><a href="マクロデータ.html#rパッケージoecdの利用方法"><i class="fa fa-check"></i><b>2.4.1</b> RパッケージOECDの利用方法</a></li>
<li class="chapter" data-level="2.4.2" data-path="マクロデータ.html"><a href="マクロデータ.html#応用例長期失業者推移の可視化"><i class="fa fa-check"></i><b>2.4.2</b> 応用例―長期失業者推移の可視化</a></li>
<li class="chapter" data-level="2.4.3" data-path="マクロデータ.html"><a href="マクロデータ.html#応用例時系列データの分析"><i class="fa fa-check"></i><b>2.4.3</b> 応用例―時系列データの分析</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="マクロデータ.html"><a href="マクロデータ.html#金融データを取得する-imf-bis"><i class="fa fa-check"></i><b>2.5</b> 金融データを取得する ― IMF &amp; BIS</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="マクロデータ.html"><a href="マクロデータ.html#IMF"><i class="fa fa-check"></i><b>2.5.1</b> 国際通貨基金(IMF) - imfr</a></li>
<li class="chapter" data-level="2.5.2" data-path="マクロデータ.html"><a href="マクロデータ.html#BIS"><i class="fa fa-check"></i><b>2.5.2</b> 国際決済銀行(BIS) - BIS</a></li>
<li class="chapter" data-level="2.5.3" data-path="マクロデータ.html"><a href="マクロデータ.html#Quandl"><i class="fa fa-check"></i><b>2.5.3</b> Quandl - GetQuandlData</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="マクロデータ.html"><a href="マクロデータ.html#DB"><i class="fa fa-check"></i><b>2.6</b> オープンデータポータル - DBnomics</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="マクロデータ.html"><a href="マクロデータ.html#rパッケージ---rdbnomics"><i class="fa fa-check"></i><b>2.6.1</b> Rパッケージ - rdbnomics</a></li>
<li class="chapter" data-level="2.6.2" data-path="マクロデータ.html"><a href="マクロデータ.html#rdbnomicsの利用方法"><i class="fa fa-check"></i><b>2.6.2</b> rdbnomicsの利用方法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html"><i class="fa fa-check"></i><b>3</b> 民主主義・国家データ</a>
<ul>
<li class="chapter" data-level="3.1" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#民主主義を測る--vdemdata"><i class="fa fa-check"></i><b>3.1</b> 「民主主義」を測る- vdemdata</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#vdemdataパッケージのインストール"><i class="fa fa-check"></i><b>3.1.1</b> vdemdataパッケージのインストール</a></li>
<li class="chapter" data-level="3.1.2" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#vdemdataパッケージの利用法"><i class="fa fa-check"></i><b>3.1.2</b> vdemdataパッケージの利用法</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#政府の質を測る---rgog"><i class="fa fa-check"></i><b>3.2</b> 「政府の質」を測る - rgog</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#データをダウンロードする---read_qog"><i class="fa fa-check"></i><b>3.2.1</b> データをダウンロードする - read_qog()</a></li>
<li class="chapter" data-level="3.2.2" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#データを探す"><i class="fa fa-check"></i><b>3.2.2</b> データを探す</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#政治体制を測る---democracydata"><i class="fa fa-check"></i><b>3.3</b> 「政治体制」を測る - democracyData</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#democracydataのインストール"><i class="fa fa-check"></i><b>3.3.1</b> democracyDataのインストール</a></li>
<li class="chapter" data-level="3.3.2" data-path="民主主義国家データ.html"><a href="民主主義国家データ.html#polity-vのダウンロード"><i class="fa fa-check"></i><b>3.3.2</b> Polity Vのダウンロード</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ミクロデータ.html"><a href="ミクロデータ.html"><i class="fa fa-check"></i><b>4</b> ミクロデータ</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ミクロデータ.html"><a href="ミクロデータ.html#general-social-survey-gssr"><i class="fa fa-check"></i><b>4.1</b> General Social Survey – gssr</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ミクロデータ.html"><a href="ミクロデータ.html#データの読み込み"><i class="fa fa-check"></i><b>4.1.1</b> データの読み込み</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ミクロデータ.html"><a href="ミクロデータ.html#european-social-survey-essurvey"><i class="fa fa-check"></i><b>4.2</b> European Social Survey – essurvey</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ミクロデータ.html"><a href="ミクロデータ.html#事前準備-essの認証とインストール"><i class="fa fa-check"></i><b>4.2.1</b> 事前準備-ESSの認証とインストール</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ミクロデータ.html"><a href="ミクロデータ.html#pew-research-center-pewmethods"><i class="fa fa-check"></i><b>4.3</b> Pew Research Center: pewmethods</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="covid-19と政策対応.html"><a href="covid-19と政策対応.html"><i class="fa fa-check"></i><b>5</b> COVID-19と政策対応</a>
<ul>
<li class="chapter" data-level="5.1" data-path="covid-19と政策対応.html"><a href="covid-19と政策対応.html#tidycovidを利用する"><i class="fa fa-check"></i><b>5.1</b> tidycovidを利用する</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="covid-19と政策対応.html"><a href="covid-19と政策対応.html#tidycovidのインストール"><i class="fa fa-check"></i><b>5.1.1</b> tidycovidのインストール</a></li>
<li class="chapter" data-level="5.1.2" data-path="covid-19と政策対応.html"><a href="covid-19と政策対応.html#tidycovidの関数とデータのダウンロード方法"><i class="fa fa-check"></i><b>5.1.2</b> tidycovidの関数とデータのダウンロード方法</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="covid-19と政策対応.html"><a href="covid-19と政策対応.html#imf-covid-19-recovery-index"><i class="fa fa-check"></i><b>5.2</b> IMF COVID-19 Recovery Index</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="snsデータ-テキスト分析---tidytext.html"><a href="snsデータ-テキスト分析---tidytext.html"><i class="fa fa-check"></i><b>6</b> SNSデータ &amp; テキスト分析 - tidytext</a>
<ul>
<li class="chapter" data-level="6.1" data-path="snsデータ-テキスト分析---tidytext.html"><a href="snsデータ-テキスト分析---tidytext.html#社会の関心を知る---gtrendsr"><i class="fa fa-check"></i><b>6.1</b> 「社会」の関心を知る - gtrendsR</a></li>
<li class="chapter" data-level="6.2" data-path="snsデータ-テキスト分析---tidytext.html"><a href="snsデータ-テキスト分析---tidytext.html#社会の声を集める---rtweet"><i class="fa fa-check"></i><b>6.2</b> 「社会」の声を集める - rtweet</a></li>
<li class="chapter" data-level="6.3" data-path="snsデータ-テキスト分析---tidytext.html"><a href="snsデータ-テキスト分析---tidytext.html#ツィッターテキストの分析---tidytext"><i class="fa fa-check"></i><b>6.3</b> ツィッターテキストの分析 - tidytext</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="snsデータ-テキスト分析---tidytext.html"><a href="snsデータ-テキスト分析---tidytext.html#文書の分割とトークン化"><i class="fa fa-check"></i><b>6.3.1</b> 文書の分割とトークン化</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html"><i class="fa fa-check"></i><b>7</b> 産業レベルデータ</a>
<ul>
<li class="chapter" data-level="7.1" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html#欧州委員会の産業rd投資iriスコアボードirir"><i class="fa fa-check"></i><b>7.1</b> 欧州委員会の産業R&amp;D投資(IRI)スコアボード－iriR</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html#国コードを取得する"><i class="fa fa-check"></i><b>7.1.1</b> 国コードを取得する</a></li>
<li class="chapter" data-level="7.1.2" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html#指標コードを取得する"><i class="fa fa-check"></i><b>7.1.2</b> 指標コードを取得する</a></li>
<li class="chapter" data-level="7.1.3" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html#企業名を取得する"><i class="fa fa-check"></i><b>7.1.3</b> 企業名を取得する</a></li>
<li class="chapter" data-level="7.1.4" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html#産業名を取得する"><i class="fa fa-check"></i><b>7.1.4</b> 産業名を取得する</a></li>
<li class="chapter" data-level="7.1.5" data-path="産業レベルデータ.html"><a href="産業レベルデータ.html#データを取得する"><i class="fa fa-check"></i><b>7.1.5</b> データを取得する</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="amecoannual-macro-economic-database-of-the-european-commissions-directorate-general-for-economic-and-financial-affairs.html"><a href="amecoannual-macro-economic-database-of-the-european-commissions-directorate-general-for-economic-and-financial-affairs.html"><i class="fa fa-check"></i><b>8</b> AMECO(annual macro-economic database of the European Commission’s Directorate General for Economic and Financial Affairs)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="amecoannual-macro-economic-database-of-the-european-commissions-directorate-general-for-economic-and-financial-affairs.html"><a href="amecoannual-macro-economic-database-of-the-european-commissions-directorate-general-for-economic-and-financial-affairs.html#including-plots"><i class="fa fa-check"></i><b>8.1</b> Including Plots</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">chap2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="マクロデータ" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number"> 2</span> マクロデータ<a href="マクロデータ.html#マクロデータ" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>今では国際機関，政府,研究組織によって多くのデータが提供されています．そ
うしたデータを取得するには，その機関・組織のサイトにアクセスし，csv,EXCEL等のファイルを直接ダウンロードすることでも、もちろん可能です．し
かし，すでに述べたように，Rには，国際機関，研究組織等の提供するデータベースからデータを取得するパッケージが多く開発されています．そ
うしたパッケージを利用すれば，シームレスかつ再現可能な形でのデータの読み込みが可能となります．そ
こで本資料では，Rパッケージを使った国際機関等のデータの取得方法と簡単な利用方法を紹介します．最
初に，以下のマクロ経済統計データベースをとりあげます．</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">DB提供機関</th>
<th align="left">マクロデータ概要</th>
<th align="left">該当節</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">フローニンゲン大学成長・発展センター</td>
<td align="left">所得、経済発展データ等</td>
<td align="left"><a href="マクロデータ.html#pwt">2.1.1</a>,<a href="マクロデータ.html#mpd">2.1.2</a></td>
</tr>
<tr class="even">
<td align="left">世界銀行</td>
<td align="left">世界開発指標等</td>
<td align="left"><a href="マクロデータ.html#WD">2.2</a></td>
</tr>
<tr class="odd">
<td align="left">EC統計局</td>
<td align="left">EUデータ（人口、経済、インフラ等）</td>
<td align="left"><a href="マクロデータ.html#EC">2.3</a></td>
</tr>
<tr class="even">
<td align="left">OECD</td>
<td align="left">OECDデータ</td>
<td align="left"><a href="マクロデータ.html#OECD">2.4</a></td>
</tr>
<tr class="odd">
<td align="left">IMF</td>
<td align="left">国際金融等データ</td>
<td align="left"><a href="マクロデータ.html#IMF">2.5.1</a></td>
</tr>
<tr class="even">
<td align="left">BIS</td>
<td align="left">銀行統計、為替レート、債務等データ</td>
<td align="left"><a href="マクロデータ.html#BIS">2.5.2</a></td>
</tr>
<tr class="odd">
<td align="left">Quandl</td>
<td align="left">金融データ</td>
<td align="left"><a href="マクロデータ.html#Quandl">2.5.3</a></td>
</tr>
<tr class="even">
<td align="left">DBnomics</td>
<td align="left">データベース集</td>
<td align="left"><a href="マクロデータ.html#DB">2.6</a></td>
</tr>
</tbody>
</table>
<div id="groningen-growth-and-development-centre" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Groningen Growth and Development Centre<a href="マクロデータ.html#groningen-growth-and-development-centre" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>1992年にフローニンゲン大学の経済学部内に設立された<a href="https://www.rug.nl/ggdc/?lang=en">Groningen Growth and Development Centre（GGDC）</a>は、.現在では、グローバリゼーション、テクノロジー、制度的変化の相互作用と、それが長期的な経済成長、構造変化、生産性、不平等に与える影響を研究する研究センターとなっています.
同センターは次のようなデータベースを公開しています.</p>
<table>
<colgroup>
<col width="38%" />
<col width="45%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">データベース名</th>
<th align="left">提供されるデータ</th>
<th align="left">Rパッケージ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Penn World Table</td>
<td align="left">所得,産出高，投入および生産性</td>
<td align="left">pwt10.0</td>
</tr>
<tr class="even">
<td align="left">10-Sector Database</td>
<td align="left">セクター別産出、投入、生産性データ</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">World Input-Output Database</td>
<td align="left">グローバルバリューチェーン</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">The Maddison Project Database</td>
<td align="left">歴史的発展</td>
<td align="left">maddison</td>
</tr>
</tbody>
</table>
<p>このうちRパッケージが開発されている２つのデータベース-Penn World TableとThe Maddison Project Database-を紹介しましょう.</p>
<div id="pwt" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Penn World Table ― pwt10<a href="マクロデータ.html#pwt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/gdp_gdpPC.gif" style="width:50.0%" alt="pwt10を利用した先進国とアジアのGDPの推移,1950-2019" />
<div class="figcaption">pwt10を利用した先進国とアジアのGDPの推移,1950-2019</div>
</div>
<p><a href="https://www.rug.nl/ggdc/productivity/pwt/?lang=en">Penn World Table</a>は経済研究においてもっとも頻繁に利用されているデータベースの１つと言えるでしょう.これは所得，産出高，投入および生産性に関する情報を提供するデータベースです．こ
れは1950年から2017年の182ヵ国をカバーしています（基準年は2011年）<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.
pwt9はデータパッケージです．
country（国名），isocode（3桁の国コード）, year（年）, currency（各国の通貨単位）の変数の他に，rgdpe（支出面の実質GDP），rgdpo（生産面の実質GDP）,hc(1人あたり人的資本指数)などを含む48の時系列データが提供されています．
それではinstall.packages()を使ってRにインストールしましょう．</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="マクロデータ.html#cb1-1" tabindex="-1"></a> <span class="co"># pwt9のインストール</span></span>
<span id="cb1-2"><a href="マクロデータ.html#cb1-2" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;pwt10&quot;</span>)</span></code></pre></div>
<p>Rパッケージptw9はデータだけのパッケージですので，data()関数で読み込みます．ス
クリプトに次のように入力し，[Run]をクリックしてください．</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="マクロデータ.html#cb2-1" tabindex="-1"></a> <span class="co"># pwt10.0の読み込み </span></span>
<span id="cb2-2"><a href="マクロデータ.html#cb2-2" tabindex="-1"></a> <span class="fu">data</span>(<span class="st">&quot;pwt10.0&quot;</span>)</span></code></pre></div>
<p>データ自体は更新され，現在，バージョン9.1となっています．こ
れを実行することにより，12,376の観察値×52の変数のデータフレームが取得されます．
データセットの最終数行を表示させる<strong>tail()</strong>関数を使ってこのデータセットの最後の部分を見てみましょう．ち
なみにtail()関数と反対の結果を出力するのがhead()関数です。h
ead()関数はデータフレームの冒頭部分を表示させます.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="マクロデータ.html#cb3-1" tabindex="-1"></a> <span class="fu">tail</span>(pwt9<span class="fl">.1</span>)</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig8.png" alt="Penn Wordl Table, pwt10.0" />
<div class="figcaption">Penn Wordl Table, pwt10.0</div>
</div>
<p>ここでpwt9.1データを使ってジンバブエ経済を観察してみましょう．そ
のためにジンバブエ経済だけ取り出し，zweというオブジェクトに容れます．</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="マクロデータ.html#cb4-1" tabindex="-1"></a> <span class="co"># ジンバブエデータを取り出す</span></span>
<span id="cb4-2"><a href="マクロデータ.html#cb4-2" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> pwt9<span class="fl">.1</span> <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="マクロデータ.html#cb4-3" tabindex="-1"></a>  <span class="fu">filter</span>(isocode <span class="sc">==</span> <span class="st">&quot;ZWE&quot;</span>)</span></code></pre></div>
<p>ここではfilter()関数を利用し、isocodeが”ZWE”に一致する行だけを抽出しています.
つまりジンバブエの行を取り出しています。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="マクロデータ.html#cb5-1" tabindex="-1"></a><span class="fu">filter</span>(データフレーム名, 抽出条件)</span></code></pre></div>
<p>filter() 関数の使い方はこのようになりますが、ここではパイプ(%)をつかって”pwt9.1”をfilter()関数に渡しています。こ
のためデータフレーム名が省略されています。</p>
<p>ジンバブエのマクロ状態―GDP，雇用，価格の成長率・上昇率―をグラフにし観察してみましょう．そ
れぞれの変数名はrgdpe（実質GDP）,emp（就業者数）,pl_c（家計消費の価格水準）です．
グラフ作成までの手順は次のようになります．</p>
<ul>
<li>手順1.３つの変数の時系列的推移を描くために，zweからこの３つの変数とyear変数を取り出します．</li>
<li>手順2. ３つの変数を成長率に変換します．</li>
<li>手順3. 最後に，３つの変数を表示するグラフを作成します．</li>
</ul>
<p><strong>手順1：特定の変数(列)の取出し – select()関数</strong></p>
<p>select()関数を使ってyearと３つの変数―rgdpe（実質GDP）,emp（就業者数）,pl_c（家計消費の価格水準）―を抽出します．</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="マクロデータ.html#cb6-1" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> zwe <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="マクロデータ.html#cb6-2" tabindex="-1"></a>  <span class="fu">select</span>(year, rgdpe, emp, pl_c)  </span></code></pre></div>
<p><strong>手順2：成長率の計算</strong></p>
<p>成長率の計算にあたっては対数差分を利用します．変
数を対数に変換するにはlog()を使います．た
とえば，log(rgdpe)と入力し，実行すれば（[Run]をクリックすると），Rはrgdpeの対数を返します．さ
らに，１期前の対数の値との差をとる必要があります.１期前に変換するためにlag()関数 を利用します<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>．
lag(rgdpe)で１期前の実質GDPの値を指定できます．
以上を利用すると，対数差分の計算式は以下のように表現されます．</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="マクロデータ.html#cb7-1" tabindex="-1"></a>  <span class="fu">log</span>(rgdpe) <span class="sc">-</span> <span class="fu">log</span>(<span class="fu">lag</span>(rgdpe))  <span class="co"># 成長率（対数差分）の計算</span></span></code></pre></div>
<p>この計算式を利用し，<strong>mutate()</strong>関数を使って成長率変数を作成します．m
utate()は既存の変数（列）に関数を適用し，新たな変数を作成する関数です．新
たな変数の名前は，この例では既存の変数の冒頭にg_をつけたものにしています．</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="マクロデータ.html#cb8-1" tabindex="-1"></a> zwe <span class="ot">&lt;-</span> zwe <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="マクロデータ.html#cb8-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="マクロデータ.html#cb8-3" tabindex="-1"></a>    <span class="at">g_rgdpe =</span> <span class="fu">log</span>(rgdpe) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(rgdpe)),</span>
<span id="cb8-4"><a href="マクロデータ.html#cb8-4" tabindex="-1"></a>      <span class="at">g_emp =</span> <span class="fu">log</span>(emp) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(emp)),</span>
<span id="cb8-5"><a href="マクロデータ.html#cb8-5" tabindex="-1"></a>      <span class="at">g_pl_c =</span>  <span class="fu">log</span>(pl_c) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(pl_c))</span>
<span id="cb8-6"><a href="マクロデータ.html#cb8-6" tabindex="-1"></a>  )</span></code></pre></div>
<p>以上をまとめてスクリプトに書くとつぎのようになります．</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="マクロデータ.html#cb9-1" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> pwt9<span class="fl">.1</span> <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="マクロデータ.html#cb9-2" tabindex="-1"></a>  <span class="fu">filter</span>(isocode <span class="sc">==</span> <span class="st">&quot;ZWE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="マクロデータ.html#cb9-3" tabindex="-1"></a>  <span class="fu">select</span>(year, rgdpe, emp, pl_c)  <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="マクロデータ.html#cb9-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-5"><a href="マクロデータ.html#cb9-5" tabindex="-1"></a>    <span class="at">g_rgdpe =</span> <span class="fu">log</span>(rgdpe) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(rgdpe)),</span>
<span id="cb9-6"><a href="マクロデータ.html#cb9-6" tabindex="-1"></a>      <span class="at">g_emp =</span> <span class="fu">log</span>(emp) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(emp)),</span>
<span id="cb9-7"><a href="マクロデータ.html#cb9-7" tabindex="-1"></a>      <span class="at">g_pl_c =</span>  <span class="fu">log</span>(pl_c) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(pl_c))</span>
<span id="cb9-8"><a href="マクロデータ.html#cb9-8" tabindex="-1"></a>  )</span></code></pre></div>
<p>これを実行すると，３つの変数とその成長率変数をもつジンバブエデータが作成されます．V
iew()関数で確認してみてください．</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="マクロデータ.html#cb10-1" tabindex="-1"></a>  <span class="fu">View</span>(zwe)</span></code></pre></div>
<p><strong>手順3：グラフの作成</strong></p>
<p>グラフの作成にはggplot2パッケージを利用します．</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="マクロデータ.html#cb11-1" tabindex="-1"></a>zwe_growth <span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> zwe) <span class="sc">+</span>           <span class="co"># GDP成長率のグラフ作成</span></span>
<span id="cb11-2"><a href="マクロデータ.html#cb11-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span>year, <span class="at">y =</span> g_rgdpe))<span class="sc">+</span></span>
<span id="cb11-3"><a href="マクロデータ.html#cb11-3" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> g_rgdpe))<span class="sc">+</span></span>
<span id="cb11-4"><a href="マクロデータ.html#cb11-4" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb11-5"><a href="マクロデータ.html#cb11-5" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;year&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Growth rate&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="マクロデータ.html#cb11-6" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="マクロデータ.html#cb12-1" tabindex="-1"></a>zwe_inflation <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> zwe) <span class="sc">+</span>　      <span class="co"># インフレ（価格上昇率）のグラフ作成</span></span>
<span id="cb12-2"><a href="マクロデータ.html#cb12-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> g_pl_c))<span class="sc">+</span></span>
<span id="cb12-3"><a href="マクロデータ.html#cb12-3" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> g_pl_c))<span class="sc">+</span></span>
<span id="cb12-4"><a href="マクロデータ.html#cb12-4" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb12-5"><a href="マクロデータ.html#cb12-5" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;year&quot;</span>,<span class="at">y=</span><span class="st">&quot;Inflation&quot;</span>)<span class="sc">+</span></span>
<span id="cb12-6"><a href="マクロデータ.html#cb12-6" tabindex="-1"></a>     <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="マクロデータ.html#cb13-1" tabindex="-1"></a>zwe_emp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> zwe) <span class="sc">+</span>         <span class="co"># 雇用成長率のグラフ作成</span></span>
<span id="cb13-2"><a href="マクロデータ.html#cb13-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> g_emp))<span class="sc">+</span></span>
<span id="cb13-3"><a href="マクロデータ.html#cb13-3" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> g_emp),<span class="at">lty=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-4"><a href="マクロデータ.html#cb13-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;year&quot;</span>,<span class="at">y=</span><span class="st">&quot;Employment&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-5"><a href="マクロデータ.html#cb13-5" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>グラフの作成にあたってはggplot2を利用していますが，このパッケージはtidyverseをインストールすることによってインストールされます．す
べてのグラフが同じ構成要素―データセット，座標システムおよびデータ点を表す描画の印― で作成されます．使
い方は構成要素を”＋“で重ねることが基本です．</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="マクロデータ.html#cb14-1" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> データフレーム名)<span class="sc">+</span></span>
<span id="cb14-2"><a href="マクロデータ.html#cb14-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x軸変数,<span class="at">y =</span> y軸変数))<span class="sc">+</span>   <span class="co"># データを点で表現します.</span></span>
<span id="cb14-3"><a href="マクロデータ.html#cb14-3" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">papping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x軸変数,<span class="at">y =</span> y軸変数))<span class="sc">+</span>      <span class="co"># データを線で結びつけます.</span></span></code></pre></div>
<p>この例では<strong>labs()</strong>を使ってx軸とy軸のタイトルを追加しています．l
abs()の書式は以下のとおりです．</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="マクロデータ.html#cb15-1" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;x軸タイトル&quot;</span>, <span class="at">y =</span> <span class="st">&quot;y軸タイトル&quot;</span>)</span></code></pre></div>
<p>さらに，<strong>geom_abline()</strong>を使って成長率ゼロの水準に直線を追加しています．g
eom_abline()の使用法は次のとおりです.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="マクロデータ.html#cb16-1" tabindex="-1"></a><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="st">&quot;直線の切片の位置&quot;</span>,<span class="at">slope =</span><span class="st">&quot;直線の傾き&quot;</span>)</span></code></pre></div>
<p>最後に，テーマを指定する<strong>theme_でtheme_bw()</strong>を選択し，白黒のテーマを選んでいます．そ
れぞれ３つのグラフを描きますが，ここではRパッケージ<strong>pachwork</strong>を使ってグラフのレイアウトを操作します．</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="マクロデータ.html#cb17-1" tabindex="-1"></a> <span class="fu">install.packages</span>(<span class="st">&quot;patchwork&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="マクロデータ.html#cb18-1" tabindex="-1"></a> <span class="fu">library</span>(patchwork)</span></code></pre></div>
<p>patchworkパッケージは操作対象の図を足し算記号（＋）や割り算記号（/）等を使って配置します。詳
細について<a href="https://cran.r-project.org/web/packages/patchwork/vignettes/patchwork.html">patchworkパッケージサイト</a>を参照してください．<code>l</code>
<code>ibrary(patchwork)</code>で呼び出したのちに，次のように入力することで3つのグラフを縦に配置します．</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="マクロデータ.html#cb19-1" tabindex="-1"></a>  zwe_growth<span class="sc">/</span>zwe_inflation<span class="sc">/</span>zwe_emp</span></code></pre></div>
</div>
<div id="mpd" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> The Maddison Project Database ― maddison<a href="マクロデータ.html#mpd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Maddisonプロジェクトは、世界のあらゆる地域の長期的な経済パフォーマンスを初めて定量化した故Angus Maddisonの業績を引き継ぐものです.Maddisonは世界のすべての地域の長期的な経済パフォーマンスを、一貫した枠組みで定量化した著名な経済学者です.</p>
<p>Maddison Project Databaseはローマ時代から現在までの世界の国々の所得の推定値を提供しています.このデータベースのおかげで成長のダイナミクスや長期的な経済成長の要因を調べることができます.</p>
<div id="maddisonのインストール" class="section level5 hasAnchor" number="2.1.2.0.1">
<h5><span class="header-section-number">2.1.2.0.1</span> maddisonのインストール<a href="マクロデータ.html#maddisonのインストール" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>次のように入力し、<code>maddison</code>をインストールし、library()でロードします.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="マクロデータ.html#cb20-1" tabindex="-1"></a> <span class="co"># maddisonのインストール</span></span>
<span id="cb20-2"><a href="マクロデータ.html#cb20-2" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;maddison&quot;</span>)</span>
<span id="cb20-3"><a href="マクロデータ.html#cb20-3" tabindex="-1"></a> <span class="co"># maddisonの呼び出し</span></span>
<span id="cb20-4"><a href="マクロデータ.html#cb20-4" tabindex="-1"></a>    <span class="fu">library</span>(maddison)</span></code></pre></div>
<p>このパッケージは1人あたりGDPとともにマディソンプロジェクトのデータを含むデータパッケージです.str()でデータフレームの内容をみると,</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="マクロデータ.html#cb21-1" tabindex="-1"></a>  <span class="fu">str</span>(maddison)</span></code></pre></div>
<p>19,873の行（観察値）と12列（変数）を持つことが分かります.主要な変数は次のとおりです.</p>
<table>
<thead>
<tr class="header">
<th align="left">変数</th>
<th align="left">説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp_pc</td>
<td align="left">1人あたり実質GDP</td>
</tr>
<tr class="even">
<td align="left">iso3c</td>
<td align="left">3文字の国コード</td>
</tr>
<tr class="odd">
<td align="left">continent</td>
<td align="left">大陸別</td>
</tr>
</tbody>
</table>
<p>Maddisonの1人あたり実質GDPをもとに主要経済の長期歴史的推移を確認してみましょう.データフレームmaddisonからfilter()を使ってサンプル国5カ国を取り出します.またデータは17世紀以降にしています.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="マクロデータ.html#cb22-1" tabindex="-1"></a>  sample5c <span class="ot">&lt;-</span> maddison <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="マクロデータ.html#cb22-2" tabindex="-1"></a>    <span class="fu">filter</span>(iso3c <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;FRA&quot;</span>,<span class="st">&quot;JPN&quot;</span>,<span class="st">&quot;GBR&quot;</span>,<span class="st">&quot;DEU&quot;</span>,<span class="st">&quot;USA&quot;</span>), year <span class="sc">&gt;</span> <span class="st">&quot;1600-01-01&quot;</span>)</span></code></pre></div>
<p>取り出した日本、アメリカ、イギリス、ドイツおよびフランスの長期的な推移を見ると、私たちの生活が豊かになり始めたのが20世紀に入ってからだということ,とくに第２次大戦以後だということが分かります.データが得られる範囲内では、それまでのおよそ2世紀にわたり停滞していたことが理解されます.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="マクロデータ.html#cb23-1" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> sample5c, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> gdp_pc, <span class="at">group =</span> country))<span class="sc">+</span></span>
<span id="cb23-2"><a href="マクロデータ.html#cb23-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> country))<span class="sc">+</span></span>
<span id="cb23-3"><a href="マクロデータ.html#cb23-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;GDP per capita&quot;</span>)<span class="sc">+</span></span>
<span id="cb23-4"><a href="マクロデータ.html#cb23-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>現在、アジア経済の成長は目覚ましいものがあります.同じようにMaddisonの1人あたり実質GDPをもとにアジア経済の長期歴史的推移を確認してみましょう.サンプル経済として中国、日本、韓国、マレーシアおよびタイの５カ国を採用しています.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="マクロデータ.html#cb24-1" tabindex="-1"></a> asia <span class="ot">&lt;-</span> maddison <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="マクロデータ.html#cb24-2" tabindex="-1"></a>  <span class="fu">filter</span>(iso3c <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;CHN&quot;</span>,<span class="st">&quot;JPN&quot;</span>,<span class="st">&quot;KOR&quot;</span>,<span class="st">&quot;MYS&quot;</span>,<span class="st">&quot;THA&quot;</span>), year <span class="sc">&gt;</span> <span class="st">&quot;1945-01-01&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="マクロデータ.html#cb25-1" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> asia, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> gdp_pc, <span class="at">group =</span> country))<span class="sc">+</span></span>
<span id="cb25-2"><a href="マクロデータ.html#cb25-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> country))<span class="sc">+</span></span>
<span id="cb25-3"><a href="マクロデータ.html#cb25-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;GDP per capita&quot;</span>)<span class="sc">+</span></span>
<span id="cb25-4"><a href="マクロデータ.html#cb25-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>これを見ると、日本が第２次世界大戦後急速に成長し、その後、1970年代末から韓国が豊かになり、いく分劣りますが,マレーシアとタイも続きます.中国は1975年の改革開放路線への転換後1人あたりGDPが伸び始め、WTO加盟後加速化し始めたことが分かります.</p>
</div>
</div>
</div>
<div id="WD" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 世界銀行World Bank ― WDI<a href="マクロデータ.html#WD" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>世界銀行が提供する<strong>世界開発指標WDI（World Development Indicators）</strong>は,グローバルな開発状況と貧困について国際的に比較可能な統計をまとめたものです．こ
のデータベースには，217の経済と40以上の国グループの1,600の時系列指標が収録されています．ま
たその多くの指標のデータは50年以上前までさかのぼることができます.</p>
<p>WDIデータは，さまざまな方法で取得できるようにされています．詳
しくは<a href="http://datatopics.worldbank.org/world-development-indicators/">世銀ホームページ</a>を参照してください．フ
ァイルが大きいためダウンロードに多少時間がかかりますが，すべてのデータ（ExcelおよびCSV形式ファイル）をまとめてダウンロードすることも可能です．</p>
<p>このWDIデータを利用するためのRパッケージWDIが開発されています .これ以外にも<a href="https://github.com/gshs-ornl/wbstats">wbstats</a>というパッケージもありますが，ここではWDIを紹介します．
RパッケージWDIは，世界銀行によって運営される40以上のデータベースからデータを検索・ダウンロードすることを可能にしています．そ
うしたデータベースには世界開発指標(WDI）はもちろんのこと，国際債務統計，Doing Business,人的資本指数，サブナショナルな貧困指標も含まれます．</p>
<div id="インストール方法" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> インストール方法<a href="マクロデータ.html#インストール方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RパッケージWDIはCRAN上で公開されていますのでインストールにはinstall.packages()を利用します．コ
ンソール画面に次のように入力し，エンターキーを押してください．</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="マクロデータ.html#cb26-1" tabindex="-1"></a> <span class="co"># WDIのインストール</span></span>
<span id="cb26-2"><a href="マクロデータ.html#cb26-2" tabindex="-1"></a> <span class="fu">install.packages</span>(<span class="st">&quot;WDI&quot;</span>)</span></code></pre></div>
<p>WDIを利用するために，スクリプト画面にlibrary(WDI)と入力し，実行しておきます．</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="マクロデータ.html#cb27-1" tabindex="-1"></a> <span class="co"># WDIのロード</span></span>
<span id="cb27-2"><a href="マクロデータ.html#cb27-2" tabindex="-1"></a>  <span class="fu">library</span>(WDI)</span></code></pre></div>
</div>
<div id="データを探す--wdisearch" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> データを探す- WDISearch()<a href="マクロデータ.html#データを探す--wdisearch" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データを探すためにはWDIパッケージに用意されたWDIsearch()関数を使います．こ
の関数は利用可能なWDIデータ系列のコード名，名前，説明，およびデータソースからなる行列を返します．基
本的な書式は以下の通りです．</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="マクロデータ.html#cb28-1" tabindex="-1"></a><span class="fu">WDIsearch</span>(<span class="at">string =</span> <span class="st">&quot;検索語&quot;</span>, <span class="at">field =</span> <span class="st">&quot;name&quot;</span>, <span class="at">short =</span> <span class="cn">TRUE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>それぞれの引数を説明しましょう．</p>
<ul>
<li>string = ““:”“に検索語（文字列）を入力します．WDIsearchは文字列マッチング関数grepを使い，”検索語”を探します．また，caseを無視します（igunore.case=TRUE）ので，正規表現―簡単に言えば，通常の文字―が利用可能です．</li>
<li>field = ““:”“に検索するフィールドを指定します．利用可能なフィールドは”indicator”, “name”, “description”, “sourceDatabase”, “sourceOrganization”です．たとえば “name” と入力すれば，データのnameの中を検索します．</li>
<li>short = : 既定値はshort=TRUEです．この場合，指標コードと名前だけを返します．short=FALSEの場合，指標コード，名前，説明およびデータソースを返します．</li>
<li>cache: WDIcache関数によって作成されるデータリストを返します．省略された場合（あるいはNULLの場合），WDIseachはデータ系列のローカルリストを探します．</li>
</ul>
<p>たとえば，GDPに関するデータを探すとしましょう．こ
の例では検索文字列を”gdp”とし，探すフィールドを”name”にしています．ま
た，詳しい説明を得るためにshort=FALSEと設定しています．検
索結果はオブジェクトgdpに格納します．</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="マクロデータ.html#cb29-1" tabindex="-1"></a>  gdp <span class="ot">&lt;-</span> <span class="fu">WDIsearch</span>(<span class="at">string =</span> <span class="st">&quot;gdp&quot;</span>,<span class="at">field =</span> <span class="st">&quot;name&quot;</span>,<span class="at">short =</span> <span class="cn">FALSE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>この結果をView(gdp)でみると，539×5の行列が返されます．こ
こで重要なのは<strong>indicator変数</strong>です．こ
れは指標コードであり，ダウンロードのさいに利用されます．</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig10.png" alt="WDIsearch()の検索結果" />
<div class="figcaption">WDIsearch()の検索結果</div>
</div>
<p>絞り込みが不十分なため，539行のデータ系列が表示されてしまっていますが，スクロールダウンして行くと，448行めにGDP(constant 2010 US$)が見つかります．そ
のindicator名は<strong>NY.GDP.MKTP.KD</strong>です.以下の例においては，これをダウンロードします．</p>
</div>
<div id="データをダウンロードする--wdi" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> データをダウンロードする- WDI()<a href="マクロデータ.html#データをダウンロードする--wdi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データをダウンロードするためにはWDI()関数を利用しますが，利用方法は次のようになります.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="マクロデータ.html#cb30-1" tabindex="-1"></a><span class="fu">WDI</span>(</span>
<span id="cb30-2"><a href="マクロデータ.html#cb30-2" tabindex="-1"></a>     <span class="at">country =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb30-3"><a href="マクロデータ.html#cb30-3" tabindex="-1"></a>     <span class="at">indicator =</span> <span class="st">&quot;NY.GDP.MKTP.KD&quot;</span>,</span>
<span id="cb30-4"><a href="マクロデータ.html#cb30-4" tabindex="-1"></a>     <span class="at">start =</span> <span class="dv">1960</span>, <span class="at">end =</span> <span class="dv">2020</span>, <span class="at">extra =</span> <span class="cn">FALSE</span>, <span class="at">cache =</span> <span class="cn">NULL</span></span>
<span id="cb30-5"><a href="マクロデータ.html#cb30-5" tabindex="-1"></a>     )</span></code></pre></div>
<p>この関数は６つの引数をとります．そ
れぞれを簡単に説明しましょう.</p>
<ul>
<li>country = ““:”“の中に，ダウンロード対象の国名（ISO-2文字コードで表現された国名）を入力します．たとえば，”US”,“CA”,“JP”です．複数の国を指定したい場合，c()を利用します. country = c(“US”,“CA”,“JP”) と入力します．なお，“all”と入力すると，すべての利用な国のデータがダウンロードされます．</li>
<li>indicator = : 指標のコード名を入力します．これは上の表のindicator列に表示されているものになります．</li>
<li>start = :データの開始年です．通常整数フォーマットの年です（ただし，1960以上）．</li>
<li>end = :データの終了年です．言うまでもなく，start引数に指定した値より大きくなければなりません.</li>
<li>extra = : TRUEの場合，地域，iso3コード，所得水準といった追加的な変数を返します．</li>
<li>WDIcache()によって作成されるリストで，extra = TRUEのとき利用されます．</li>
</ul>
<p>それではWDI()関数を使って，アメリカ経済のGDP(constant 2010 US$)をダウンロードしてみます．こ
のGDPデータのindicatorコードは，上述のとおり，<strong>NY.GDP.MKTP.KD</strong>です．ダ
ウンロードしたデータはgdp_usという名前をつけたオブジェクトに格納します．</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="マクロデータ.html#cb31-1" tabindex="-1"></a> gdp_us <span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">country =</span> <span class="st">&quot;US&quot;</span>, <span class="at">indicator =</span> <span class="st">&quot;NY.GDP.MKTP.KD&quot;</span>, <span class="at">start =</span> <span class="dv">1990</span>, <span class="at">end =</span> <span class="dv">2019</span>, <span class="at">extra =</span> <span class="cn">FALSE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>) </span></code></pre></div>
<p>head()やView()関数を使ってダウンロードしたデータを確認してみてください．</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="マクロデータ.html#cb32-1" tabindex="-1"></a> <span class="fu">head</span>(gdp_us)</span></code></pre></div>
<p>最後に，ダウンロードしたGDPデータをggplot2を使ってグラフにしてみましょう．</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="マクロデータ.html#cb33-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gdp_us)<span class="sc">+</span></span>
<span id="cb33-2"><a href="マクロデータ.html#cb33-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> NY.GDP.MKTP.KD))<span class="sc">+</span></span>
<span id="cb33-3"><a href="マクロデータ.html#cb33-3" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb33-4"><a href="マクロデータ.html#cb33-4" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">&quot;USA GDP, constant 2010 US$&quot;</span>,</span>
<span id="cb33-5"><a href="マクロデータ.html#cb33-5" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">&quot;GDP&quot;</span></span>
<span id="cb33-6"><a href="マクロデータ.html#cb33-6" tabindex="-1"></a> )<span class="sc">+</span></span>
<span id="cb33-7"><a href="マクロデータ.html#cb33-7" tabindex="-1"></a><span class="fu">theme_bw</span>()</span></code></pre></div>
<p>これを実行すると，[Plots]ウィンドウに上のグラフが表示されます.</p>
</div>
</div>
<div id="EC" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> EU統計局Eurostat - eurostat<a href="マクロデータ.html#EC" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>欧州委員会の統計局である<a href="https://ec.europa.eu/eurostat">Eurostat</a>は,オープンデータサービスを通じて,欧州の人口統計,経済,健康,インフラ,交通などに関する数千ものデータセットを提供しています.Rパッケージeurostatはそうした欧州統計局のオープンデータ取得のためのパッケージです.ヨーロッパ経済を実証分析の対象とする場合,とても有益なパッケージです.</p>
<div id="rパッケージeurostatの利用法" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Rパッケージeurostatの利用法<a href="マクロデータ.html#rパッケージeurostatの利用法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="パッケージeurostatのインストール" class="section level4 hasAnchor" number="2.3.1.1">
<h4><span class="header-section-number">2.3.1.1</span> パッケージeurostatのインストール<a href="マクロデータ.html#パッケージeurostatのインストール" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>最初に,次のようにコンソール画面に入力しエンターキーを押し,eurostatをインストールします.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="マクロデータ.html#cb34-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;eurostat&quot;</span>)         <span class="co"># eurostatのインストール</span></span></code></pre></div>
<p>さらに,library()でパッケージeurostatを呼び出し,利用できるようにしておきます.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="マクロデータ.html#cb35-1" tabindex="-1"></a> <span class="fu">library</span>(eurostat)                 <span class="co"># eurostatの呼び出し</span></span></code></pre></div>
</div>
<div id="データを探すget_eurostat_toc-search_eurostat" class="section level4 hasAnchor" number="2.3.1.2">
<h4><span class="header-section-number">2.3.1.2</span> データを探す―get_eurostat_toc(), search_eurostat()<a href="マクロデータ.html#データを探すget_eurostat_toc-search_eurostat" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>get_eurostat_toc()</strong> 　関数get_eurostat_toc()は,eurostatのデータセットの目次をダウンロードする関数です.最初に,この関数を使って目次をダウンロードしてみましょう.ここではダウンロードした目次をオブジェクト―euという名前にしています―に容れます.
　</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="マクロデータ.html#cb36-1" tabindex="-1"></a>eu <span class="ot">&lt;-</span> <span class="fu">get_eurostat_toc</span>()  <span class="co"># eurostatの目次取得し,オブジェクトeuに格納</span></span></code></pre></div>
<p>スクリプト画面にView(eu)と入力し,[Run]をクリックすると,euの内容が表示されます.これは10,004行×8列のデータフレームです.１列目のtitleはデータセット名,２列目codeはデータセットのコード番号です.このcode列の値は,選択されたデータセットをダウンロードするために使用されます.次のtype列はデータセットかフォルダかどうかを示しています.last update of data列はデータの最新の更新日,last table structure changeはテーブル構造の最新の変更時点,そして次の2つの列はデータの開始時期と終了時期を示しています.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_1.png" alt="Eurostatの目次一覧" />
<div class="figcaption">Eurostatの目次一覧</div>
</div>
<p><strong>search_eurostat()</strong></p>
<p>特定の検索ワードを指定し,データを探すためにはsearch_eurostat()関数を使用します.たとえば,search_eurostat()関数の引数に “unemployment”と入力し,失業に関連したデータセットを探してみましょう.ここではその結果をパイプ(%&gt;%)でView()関数につなげてViewウィンドウで表示させています.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="マクロデータ.html#cb37-1" tabindex="-1"></a><span class="fu">search_eurostat</span>(<span class="st">&quot;unemployment&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># &quot;unemployment&quot;の検索</span></span>
<span id="cb37-2"><a href="マクロデータ.html#cb37-2" tabindex="-1"></a>  <span class="fu">View</span>()                             <span class="co"># View()で検索結果を表示</span></span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_2.png" alt="search_eurostat(“キーワード”)検索結果の出力" />
<div class="figcaption">search_eurostat(“キーワード”)検索結果の出力</div>
</div>
<p>search_eurostat()関数の基本的な書き方は以下のとおりです.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="マクロデータ.html#cb38-1" tabindex="-1"></a>   <span class="fu">search_eurostat</span>(<span class="at">pattern=</span><span class="st">&quot;検索語&quot;</span>, <span class="at">type =</span> <span class="st">&quot;dataset&quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>このように引数にpattern,type,fixedの３つをとります.</p>
<ul>
<li>pattern=““,”“の部分に探したいデータに関連したキーワードを入力します.これにより,type=引数で指定した内容に応じて,データセットやテーブルが返されます.</li>
<li>type=““には,dataset, folder, table, もしくは以上のすべてを指定するallのいずれかを入力します.これにより対応したEurostatのテーブルが出力されます.デフォルトではdatasetです.</li>
<li>fixedにはTRUE, FALSEの論理値をとります.TRUEの場合,patternはマッチされる文字列となります.より複雑なregexマッチングが必要とされる場合,FALSEをとります.</li>
</ul>
</div>
<div id="データをダウンロードするget_eurostat" class="section level4 hasAnchor" number="2.3.1.3">
<h4><span class="header-section-number">2.3.1.3</span> データをダウンロードする―get_eurostat()<a href="マクロデータ.html#データをダウンロードするget_eurostat" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>データをダウンロードするには,get_eurostat()を使います.もっとも基本的な書式は次のようになります.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="マクロデータ.html#cb39-1" tabindex="-1"></a> <span class="fu">get_eurostat</span>(id, <span class="at">time_format =</span> <span class="st">&quot;&quot;</span>, <span class="at">filters =</span> <span class="st">&quot;&quot;</span>, <span class="at">type =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>この関数はおもな引数として次のものをとります.</p>
<ul>
<li>id=““:”“にデータセットのコード名を指定します.</li>
<li>time_format= ““: eurostatフォーマットの時間列をどのタイプに変換するかを指定します.”date”（既定値）と入力した場合,期間の最初のデータによって日付フォーマットDateへと変換されます.”num”を指定すると,数値へと変換されます.テーブルが年次データの場合,デフォルトの日付フォーマットDateを使用するよりも,数値numの時間変数を使用した方が便利です.</li>
<li>filters = ““:”none”を指定した場合,データセット全体が取得されます.一部分を取得したい場合,ここにリストを入れます（以下の例を参照してください）.</li>
<li>type= ““: 変数のタイプを指定します.具体的には”code”（デフォルト）もしくは “label”となります.これは変数の値を知りたいときに便利です（以下の例を参照してください）.</li>
</ul>
<p>それでは具体的な例を使ってデータをダウンロードしてみましょう.ここでは EUの「住宅価格」データを探すことにします.最初に,上で説明した<strong>search_eurostat()</strong>関数を使って取得するデータのidを確認します.その上で,<strong>get_eurostat()</strong>関数を利用し,イギリス,フランス,スペインの「住宅価格」データを取得してみましょう.</p>
<p>検索結果をオブジェクトhouseに容れます.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="マクロデータ.html#cb40-1" tabindex="-1"></a>    house <span class="ot">&lt;-</span> <span class="fu">search_eurostat</span>(<span class="st">&quot;House&quot;</span>,<span class="at">type=</span> <span class="st">&quot;table&quot;</span>) </span></code></pre></div>
<p>View(house)の結果をみると,13行めに<strong>House price index - annual data</strong>（住宅価格指数,年次データ）が表示されています.これをダウンロードします.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_3.png" alt="キーワード”House”の検索結果" />
<div class="figcaption">キーワード”House”の検索結果</div>
</div>
<p>ここではダウンロードしたデータをhouse_priceと名前をつけたオブジェクトに容れます.get_eurostat()の引数id = ““には、検索結果の<strong>code変数のtipsho20</strong> を利用します.引数time_format=”num”では数値を指定しています.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="マクロデータ.html#cb41-1" tabindex="-1"></a>  house_price<span class="ot">&lt;-</span><span class="fu">get_eurostat</span>(<span class="at">id=</span><span class="st">&quot;tipsho20&quot;</span>,<span class="at">time_format =</span> <span class="st">&quot;num&quot;</span>,<span class="at">type =</span> <span class="st">&quot;code&quot;</span>)</span></code></pre></div>
<p>これにより,４つの変数,1,483の観察値がダウンロードされます.結果をstr()で表示してみます.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="マクロデータ.html#cb42-1" tabindex="-1"></a>   <span class="fu">str</span>(house_price)</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_4.png" alt="house_priceのデータ構造" />
<div class="figcaption">house_priceのデータ構造</div>
</div>
<p>最初の変数unit（単位）,２番目の変数geoは地理情報,３番目の変数timeは年,最後の変数valuesが住宅価格指数を示しています.しかし,実はこれだけではそれぞれの変数がとる値が何を意味しているかは分かりません,少なくとも分かりづらい表示になっています.とりわけ,<strong>unit変数</strong>がコード名で表記されているため, <strong>“INX_A_AVG”</strong>等がわかりません.ダウロードするさいの引数<strong>type = “label”</strong>とした方が良いでしょう.デフォルトではコード名で表示されます（引数type = “code”）.変数の値の意味を知るには変数のラベルを表示させた方が,コード名よりも便利です.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="マクロデータ.html#cb43-1" tabindex="-1"></a>  house_price <span class="ot">&lt;-</span> <span class="fu">get_eurostat</span>(<span class="at">id=</span><span class="st">&quot;tipsho20&quot;</span>,</span>
<span id="cb43-2"><a href="マクロデータ.html#cb43-2" tabindex="-1"></a>  <span class="at">time_format =</span> <span class="st">&quot;num&quot;</span>,</span>
<span id="cb43-3"><a href="マクロデータ.html#cb43-3" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p>type = “label”でダウンロードした上で,次に,以下のように入力し,変数unitがどのような値を持つか確認してみて下さい.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="マクロデータ.html#cb44-1" tabindex="-1"></a>   house_price <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="マクロデータ.html#cb44-2" tabindex="-1"></a>        <span class="fu">distinct</span>(unit)</span></code></pre></div>
<p><strong>distinct()</strong>関数はデータフレームから,()内に指定した変数のうちユニークな,異なった値（行）だけを選択します.つまり,unit変数は1,403行から形成されますが,すべて異なった値をとるわけではありません.ユニークな値は―以下のdistinct()関数の結果をみると―３種類だけです.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_5.png" style="width:50.0%" alt="distinct()関数の出力結果" />
<div class="figcaption">distinct()関数の出力結果</div>
</div>
<p>以下の例でunit変数の値を抽出条件とすることによって特定の行を抽出します.</p>
</div>
<div id="住宅価格上昇率のグラフを描く" class="section level4 hasAnchor" number="2.3.1.4">
<h4><span class="header-section-number">2.3.1.4</span> 住宅価格上昇率のグラフを描く<a href="マクロデータ.html#住宅価格上昇率のグラフを描く" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>いくつかのヨーロッパ経済をピックアップし,住宅価格（年平均変化率）の推移と１時点における住宅価格変化率をみてみましょう.このために次のような作業を行います.</p>
<ol style="list-style-type: decimal">
<li>複数の国を指定し,住宅データをダウンロードする.</li>
<li>unit変数にもとづき年平均変化率を示す値（行）を抽出する.</li>
<li>ggplot2を利用し,ダウンロードしたデータの時系列グラフを作成する.</li>
<li>地理情報を利用し,ヨーロッパ地図上に2018年の住宅価格（年平均変化率）を表示させる.</li>
</ol>
<p><strong>1.複数の国を指定し,住宅データをダウンロードする</strong></p>
<p>最初に,国コードを容れたベクトルを作成しておきます―isoという名前にします.直接get_eurostat()関数において指定しても良いのですがスクリプトが見づらくなりますので,事前に,この作業を行っておきます.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="マクロデータ.html#cb45-1" tabindex="-1"></a>    iso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FR&quot;</span>,<span class="st">&quot;DE&quot;</span>,<span class="st">&quot;ES&quot;</span>,<span class="st">&quot;IT&quot;</span>,<span class="st">&quot;SE&quot;</span>)</span></code></pre></div>
<p><strong>2. unit変数にもとづき年平均変化率を示す値（行）およびサンプル国を抽出する</strong></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="マクロデータ.html#cb46-1" tabindex="-1"></a>  house_price_eu <span class="ot">&lt;-</span> house_price <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="マクロデータ.html#cb46-2" tabindex="-1"></a>        <span class="fu">filter</span>(unit <span class="sc">==</span> <span class="st">&quot;RCH_A_AVG&quot;</span>, geo <span class="sc">%in%</span> iso)</span></code></pre></div>
<p>変数unitのとる値のうち年平均変化率を表現するラベルは”RCH_A_AVG”ですのでfilter()関数の中の抽出条件の１つに<strong>unit == “RCH_A_AVG”</strong>を指定しています.また,国を示す変数はgeoですが,このうちベクトルisoに容れた複数の国を選択することになりますので<strong>geo %in% iso</strong>を利用しています.この表記が意味しているのは,「geo変数がisoベクトルの中のいずれかに等しい国コードをとる行を選択しなさい」ということを意味しています.これによりgeo変数のうちisoベクトルの中の国のいずれかに等しい行だけが選択されます.</p>
<p>これで行の抽出条件にマッチする行だけが選択され,house_price_euというオブジェクトに格納されます.View(house_price_eu)やstr(house_price_eu)を利用し,house_price_euの内容を確認してみてください.</p>
<p><strong>3. ggplot2を利用し,ダウンロードしたデータの時系列グラフを作成する</strong></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="マクロデータ.html#cb47-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> house_price_eu, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> values))<span class="sc">+</span>    </span>
<span id="cb47-2"><a href="マクロデータ.html#cb47-2" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">shape =</span> geo))<span class="sc">+</span> </span>
<span id="cb47-3"><a href="マクロデータ.html#cb47-3" tabindex="-1"></a>        <span class="co"># 点の形状で国別を示すためにaes()の中でshpae = geoと指定</span></span>
<span id="cb47-4"><a href="マクロデータ.html#cb47-4" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">lty=</span>geo))<span class="sc">+</span>             </span>
<span id="cb47-5"><a href="マクロデータ.html#cb47-5" tabindex="-1"></a>    <span class="co"># さらにgeom_line()で線を重ねる.</span></span>
<span id="cb47-6"><a href="マクロデータ.html#cb47-6" tabindex="-1"></a>    <span class="co"># 線の種類で国別表示するため,aes()の中でlyt=geoと指定.</span></span>
<span id="cb47-7"><a href="マクロデータ.html#cb47-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;year&quot;</span>, <span class="at">y=</span><span class="st">&quot;Housing price&quot;</span>,       </span>
<span id="cb47-8"><a href="マクロデータ.html#cb47-8" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">&quot;Housing price (Annual average rate of change %)&quot;</span>)<span class="sc">+</span> </span>
<span id="cb47-9"><a href="マクロデータ.html#cb47-9" tabindex="-1"></a><span class="fu">theme_bw</span>()  </span></code></pre></div>
<p>このスクリプトを実行すると,以下のようなグラフが出力されます.</p>
<center>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_6hp.png" alt="ヨーロッパ主要経済の住宅価格の推移,2001~2019" />
<div class="figcaption">ヨーロッパ主要経済の住宅価格の推移,2001~2019</div>
</div>
</center>
<p><strong>4. 地理情報を利用し,ヨーロッパ地図上に2015年の住宅価格（年平均変化率）を表示させる</strong></p>
<p>上のグラフでは各国の住宅価格上昇率の時間的推移を比較しましたが,今度は2015年の１時点をとり各国を比較してみましょう.このためにeurostatの提供する地理空間情報を利用し,2015年の住宅価格をヨーロッパの地図上に描きます.最初に出力されるグラフを示しておきましょう.地理情報の使い方の詳細については2.3.2を参照してください.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_7.png" alt="ヨーロッパ経済の住宅価格上昇率,2015年" />
<div class="figcaption">ヨーロッパ経済の住宅価格上昇率,2015年</div>
</div>
<p>出力される結果は上のようになります.この図を描くための詳しい説明は2.3.2に譲り,ここではスクリプトだけ示しておきます.手順は４つです.</p>
<ul>
<li>手順① ヨーロッパの地図データの取得</li>
<li>手順② 住宅価格データから特定の国と2015年のデータを抽出</li>
<li>手順③ ２つのデータフレームの結合</li>
<li>手順④ geom_sf()の利用</li>
</ul>
<p><strong>①ヨーロッパの地図データを取得し,そのデータをshp_0という名前をつけたオブジェクトに容れます.</strong></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="マクロデータ.html#cb48-1" tabindex="-1"></a>  shp_0 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">0</span>, <span class="at">year =</span> <span class="dv">2016</span>)</span></code></pre></div>
<p><strong>②上で取得した住宅価格データからヨーロッパ諸国と2015年のデータを抽出します.</strong></p>
<p>そしてその結果をhousing2015というオブジェクトに容れます.最初に,isoの内容は事前に上記のisoベクトルを,次のように書き換え,サンプル国を拡充しておきます.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="マクロデータ.html#cb49-1" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AT&quot;</span>, <span class="st">&quot;BE&quot;</span>, <span class="st">&quot;CY&quot;</span>,<span class="st">&quot;CZ&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;DK&quot;</span>, <span class="st">&quot;EL&quot;</span>, <span class="st">&quot;ES&quot;</span>, <span class="st">&quot;FI&quot;</span>, <span class="st">&quot;FR&quot;</span>, <span class="st">&quot;HR&quot;</span>, <span class="st">&quot;IE&quot;</span>, <span class="st">&quot;IT&quot;</span>, <span class="st">&quot;LT&quot;</span>,<span class="st">&quot;LU&quot;</span>, </span>
<span id="cb49-2"><a href="マクロデータ.html#cb49-2" tabindex="-1"></a><span class="st">&quot;LV&quot;</span>, <span class="st">&quot;MT&quot;</span>, <span class="st">&quot;NL&quot;</span>, <span class="st">&quot;PT&quot;</span>, <span class="st">&quot;SE&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="マクロデータ.html#cb50-1" tabindex="-1"></a>housing2015 <span class="ot">&lt;-</span> house_price <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="マクロデータ.html#cb50-2" tabindex="-1"></a>         <span class="fu">filter</span> (unit <span class="sc">==</span> <span class="st">&quot;RCH_A_AVG&quot;</span>, geo <span class="sc">%in%</span> iso, time <span class="sc">==</span> <span class="dv">2015</span>)</span></code></pre></div>
<p><strong>③そして,オブジェクトshp_0とhousing2015を結合します.</strong></p>
<p>マージしたデータは地理データと住宅価格データを持つことになります.マージしたデータにはmap_housingというオブジェクト名を与えています.２つのオブジェクトの結合には<strong>inner_join()関数</strong>を使っています.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="マクロデータ.html#cb51-1" tabindex="-1"></a> map_housing <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp_0,housing2015, <span class="at">by =</span> <span class="st">&quot;geo&quot;</span>)</span></code></pre></div>
<p><strong>④最後に,ggplot2―geom_sf()―を利用し,ヨーロッパ地図上に,住宅価格上昇率を描きます.</strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="マクロデータ.html#cb52-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> map_housing) <span class="sc">+</span></span>
<span id="cb52-2"><a href="マクロデータ.html#cb52-2" tabindex="-1"></a>        <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">&quot;white&quot;</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb52-3"><a href="マクロデータ.html#cb52-3" tabindex="-1"></a>        <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb52-4"><a href="マクロデータ.html#cb52-4" tabindex="-1"></a>        <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">70</span>))<span class="sc">+</span></span>
<span id="cb52-5"><a href="マクロデータ.html#cb52-5" tabindex="-1"></a>        <span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">&quot;Classic Gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-6"><a href="マクロデータ.html#cb52-6" tabindex="-1"></a>        <span class="fu">labs</span> (<span class="at">subtitle =</span> <span class="st">&quot;Housing price (Annual average rate of change), 2015&quot;</span>,</span>
<span id="cb52-7"><a href="マクロデータ.html#cb52-7" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;% Annual average</span><span class="sc">\n</span><span class="st">rate of change&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="マクロデータ.html#cb52-8" tabindex="-1"></a>        <span class="fu">theme_classic</span>()</span></code></pre></div>
<p>全体のスクリプトをまとめると,次のようになります.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="マクロデータ.html#cb53-1" tabindex="-1"></a><span class="co"># ヨーロッパの地理空間データをダウンロード</span></span>
<span id="cb53-2"><a href="マクロデータ.html#cb53-2" tabindex="-1"></a>shp_0 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">resolution =</span> <span class="dv">10</span>,<span class="at">nuts_level =</span> <span class="dv">0</span>,<span class="at">year =</span> <span class="dv">2016</span>)</span>
<span id="cb53-3"><a href="マクロデータ.html#cb53-3" tabindex="-1"></a></span>
<span id="cb53-4"><a href="マクロデータ.html#cb53-4" tabindex="-1"></a><span class="co"># サンプル国を指定.</span></span>
<span id="cb53-5"><a href="マクロデータ.html#cb53-5" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AT&quot;</span>, <span class="st">&quot;BE&quot;</span>, <span class="st">&quot;CY&quot;</span>,<span class="st">&quot;CZ&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;DK&quot;</span>, <span class="st">&quot;EL&quot;</span>, <span class="st">&quot;ES&quot;</span>, <span class="st">&quot;FI&quot;</span>, <span class="st">&quot;FR&quot;</span>, <span class="st">&quot;HR&quot;</span>, <span class="st">&quot;IE&quot;</span>,<span class="st">&quot;IT&quot;</span>, <span class="st">&quot;LT&quot;</span>,<span class="st">&quot;LU&quot;</span>, <span class="st">&quot;LV&quot;</span>, <span class="st">&quot;MT&quot;</span>, <span class="st">&quot;NL&quot;</span>, <span class="st">&quot;PT&quot;</span>, <span class="st">&quot;SE&quot;</span>)</span>
<span id="cb53-6"><a href="マクロデータ.html#cb53-6" tabindex="-1"></a></span>
<span id="cb53-7"><a href="マクロデータ.html#cb53-7" tabindex="-1"></a><span class="co"># サンプル国の住宅価格（年平均変化率）データを取得. </span></span>
<span id="cb53-8"><a href="マクロデータ.html#cb53-8" tabindex="-1"></a>housing2015 <span class="ot">&lt;-</span> house_price <span class="sc">%&gt;%</span> </span>
<span id="cb53-9"><a href="マクロデータ.html#cb53-9" tabindex="-1"></a>        <span class="fu">filter</span> (unit <span class="sc">==</span> <span class="st">&quot;RCH_A_AVG&quot;</span>, geo <span class="sc">%in%</span> iso),time <span class="sc">==</span> <span class="dv">2015</span><span class="er">)</span></span>
<span id="cb53-10"><a href="マクロデータ.html#cb53-10" tabindex="-1"></a></span>
<span id="cb53-11"><a href="マクロデータ.html#cb53-11" tabindex="-1"></a><span class="co"># 地理空間データと住宅価格データを結合.</span></span>
<span id="cb53-12"><a href="マクロデータ.html#cb53-12" tabindex="-1"></a>map_housing <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp_0,housing2015, <span class="at">by =</span> <span class="st">&quot;geo&quot;</span>) </span>
<span id="cb53-13"><a href="マクロデータ.html#cb53-13" tabindex="-1"></a></span>
<span id="cb53-14"><a href="マクロデータ.html#cb53-14" tabindex="-1"></a><span class="co">#  ヨーロッパの地図上に住宅価格を表示.</span></span>
<span id="cb53-15"><a href="マクロデータ.html#cb53-15" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> map_housing) <span class="sc">+</span></span>
<span id="cb53-16"><a href="マクロデータ.html#cb53-16" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">&quot;white&quot;</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb53-17"><a href="マクロデータ.html#cb53-17" tabindex="-1"></a>     <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb53-18"><a href="マクロデータ.html#cb53-18" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">70</span>))<span class="sc">+</span></span>
<span id="cb53-19"><a href="マクロデータ.html#cb53-19" tabindex="-1"></a>    <span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">&quot;Classic Gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb53-20"><a href="マクロデータ.html#cb53-20" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Housing price (Annual average rate of change), 2015&quot;</span>,</span>
<span id="cb53-21"><a href="マクロデータ.html#cb53-21" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">&quot;% Annual average</span><span class="sc">\n</span><span class="st">rate of change&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-22"><a href="マクロデータ.html#cb53-22" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div>
<p>このようにRパッケージeurostatを利用することで,わずか10数行のスクリプトを書くだけで上のグラフを描くことができます.</p>
</div>
</div>
<div id="応用例-地理空間情報の利用" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> 応用例 ― 地理空間情報の利用<a href="マクロデータ.html#応用例-地理空間情報の利用" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>北欧諸国はミステリー小説の多くの傑作を生み出しています.そうした背景には社会経済的要因はもちろんのこと犯罪を身近なものと受け止める社会不安があるのかもしれません.そこで欧州委員会統計局Eurostatが提供する犯罪や暴力に対する不安度を示す指標によって,そうした社会的不安を代理させ観察することにします.そして同指標を視覚的に示すためにEurostatの提供する地理空間情報と結合し,ヨーロッパ地図上に表示します.主な手順は次のようになります,</p>
<ol style="list-style-type: decimal">
<li>地理空間情報(シェイプ・ファイル)をダウンロードし,ヨーロッパ地図を描く.</li>
<li>犯罪・暴力・破壊行為に対する不安度を示す指標をダンロードする.</li>
<li>1と2のファイルを結合し,不安度指標を表示した北欧地図を描く.</li>
</ol>
<p><strong>1 地理空間情報のダウンロードとggplot2による描画―sfパッケージ</strong></p>
<p>地理空間データ分析用のRパッケージとしてsfパッケージがあります.sfパッケージは,simple featuresというGIS(geographic information system)データ規格をRで扱うためのパッケージです.Eurostatの提供する地理空間情報データを扱うために,最初に,このパッケージをインストールしておきます.　
コンソール画面に次のように入力し,エンターキーを押してください.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="マクロデータ.html#cb54-1" tabindex="-1"></a> <span class="co"># sfパッケージのインストール</span></span>
<span id="cb54-2"><a href="マクロデータ.html#cb54-2" tabindex="-1"></a> <span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<p>インストールを終えたら,スクリプト画面に次のように入力し,実行します.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="マクロデータ.html#cb55-1" tabindex="-1"></a> <span class="co"># sfパッケージの呼び出し</span></span>
<span id="cb55-2"><a href="マクロデータ.html#cb55-2" tabindex="-1"></a> <span class="fu">library</span>(sf)</span></code></pre></div>
<p>このパッケージを利用することによって地理空間データのさまざまな処理が可能となります.</p>
<p>すでに幾度も登場しているggplot2も,バージョン3.0.0以後sfクラスのデータを扱えるようになりました.sfクラスのオブジェクトのプロットには,<strong>geom_sf()</strong>という関数を使います.</p>
<p>Eurostatの地理空間情報は,国レベルにとどまらず,それ以上に詳細な行政単位レベルの情報も提供しています.1970年代初頭,Eurostatは,欧州連合（EU）の地域統計を作成するために,EUの領土を分割するための統一された,一貫したシステムとしてNUTS (Nomenclature of territorial units)分類 を設定しました.イタリアを例にとれば,NUTSレベル0はイタリアという国そのものの,NUTSレベル１はNord-Ovest（北西部）, Sud（南部）といった地域,さらにNUTSレベル２はPiemonte（ピエモンテ）, Liguria（リグーリア）, Lombardia（ロンバルディア）といった州, もっとも細かいレベルのNUTSレベル３はTorino（トリノ）, Genova（ジェノバ）, Milano（ミラノ）等の都市空間を示します.これにより,たとえば,個人世帯の可処分所得の地理的分布を調べたいとき,NUTSレベル2すなわち各国の州レベルまで調べること（グラフ表示）も可能です.</p>
<p>それでは最初に,NUTSレベル１と２のヨーロッパ地図を描いてみましょう.地図を描くためにはシェイプファイルshapefileという図形情報と属性情報を入れたファイルをダウンロードする必要があります.RパッケージeurostatはGISGOからヨーロッパの地理情報を取得する関数<strong>get_eurostat_geospatial()</strong>を用意しています.この関数の基本的な用法は次のようになります.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="マクロデータ.html#cb56-1" tabindex="-1"></a><span class="fu">get_eurostat_geospatial</span>(</span>
<span id="cb56-2"><a href="マクロデータ.html#cb56-2" tabindex="-1"></a>  <span class="at">output_class =</span> <span class="st">&quot;sf&quot;</span>,</span>
<span id="cb56-3"><a href="マクロデータ.html#cb56-3" tabindex="-1"></a>  <span class="at">resolution =</span> ,</span>
<span id="cb56-4"><a href="マクロデータ.html#cb56-4" tabindex="-1"></a>  <span class="at">nuts_level =</span> ,</span>
<span id="cb56-5"><a href="マクロデータ.html#cb56-5" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2016</span></span>
<span id="cb56-6"><a href="マクロデータ.html#cb56-6" tabindex="-1"></a>)</span></code></pre></div>
<p>以下はこの関数がとる引数の概要です.</p>
<ul>
<li>output_class　= ““:”“に sf, df,もしくはspdfのいずれかの文字列を指定することで返されるオブジェクトのクラスを選択します.sfはsimple features,dfは data_frame, spdfはSpatialPolygonDataFrameを表現します.デフォルトは”sf”です.</li>
<li>resolution = : 地理空間データの解像度を指定します.利用可能な解像度は60（1:6,000万）,20（1:2,000万）,10（1:1,000万）,03（1:3,000万）,01（1:1,000万）のいずれかです.</li>
<li>nuts_level = : NUTS分類のレベルをしていします.0,1, 2, 3, allのいずれかをとります.</li>
<li>year = : NUTSのリリース年を指定します.具体的には,2003, 2006, 2010, 2013, 2016 のいずれかを入力します.</li>
</ul>
<p>それでは地理空間情報をダウンロードしてみましょう.ここではNUTSレベルの異なる２つのオブジェクトを作成します.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="マクロデータ.html#cb57-1" tabindex="-1"></a><span class="co"># NUTS分類のレベル0で地図情報を取得し,オブジェクトshp0に容れる</span></span>
<span id="cb57-2"><a href="マクロデータ.html#cb57-2" tabindex="-1"></a>shp0 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">output_class =</span> <span class="st">&quot;sf&quot;</span>, <span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">0</span>, <span class="at">year =</span> <span class="dv">2016</span>)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="マクロデータ.html#cb58-1" tabindex="-1"></a> <span class="co"># NUTS分類のレベル2で地図情報を取得し,オブジェクトshp2に容れる</span></span>
<span id="cb58-2"><a href="マクロデータ.html#cb58-2" tabindex="-1"></a>shp2 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">output_class =</span> <span class="st">&quot;sf&quot;</span>, <span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">2</span>, <span class="at">year =</span> <span class="dv">2016</span>)</span></code></pre></div>
<p>オブジェクト―shp0, shp2―は,引数output_class=“sf”で指定していますのでsfクラスです.
geom_sf()はsfクラスのオブジェクトを扱いますから, この指定が必要となります（ただし,デフォルトでもsfクラスですから,指定しなくとも結果はsfクラスのオブジェクトとなります）.</p>
<p>NUTSレベル0は国単位を意味します.NUTSレベル２は,上述のように,イタリアで言えばロンバルディアといった州レベルの行政単位まで描かれます.
ヨーロッパの地図情報が取得できましたので,ggplot2を利用しヨーロッパ地図を描いてみましょう.ggplot2にはsfクラスのオブジェクトを描くためにgeom_sf()が開発されています.グラフの作成はこれまで紹介したggplot2の利用方法に同じです.基本は<strong>ggplot(オブジェクト名)+geom_sf()</strong>です.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="マクロデータ.html#cb59-1" tabindex="-1"></a><span class="fu">ggplot</span>(shp0)<span class="sc">+</span>       <span class="co"># オブジェクト名を入力</span></span>
<span id="cb59-2"><a href="マクロデータ.html#cb59-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>()         <span class="co"># sfクラスのオブジェクトを指定</span></span></code></pre></div>
<p>これだけでヨーロッパ地図がプロット画面に出力されます.しかし,かなり広いヨーロッパ地域が表示されてしまいます.そこでx軸,y軸の範囲を限定し,わたしたちが通常目にするヨーロッパを描くとしましょう.そのためにはxlim()を利用し,x軸の範囲を決定します.xlim（c（西に-10度, 東に37度））のように東西の経度を入力します.y軸の範囲も同様に,ylim(c(,))を利用し,緯度を入力します.あるいはggplot2のcoord_map()という関数を使っても良いでしょう.引数xlim=()で経度,ylim=()で緯度の範囲を指定できます.たとえば,coord_map(xlim = c(-30, 45), ylim = c(30, 75))と入力することによってヨーロッパ地域を指定することができます.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="マクロデータ.html#cb60-1" tabindex="-1"></a>nuts0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(shp0) <span class="sc">+</span></span>
<span id="cb60-2"><a href="マクロデータ.html#cb60-2" tabindex="-1"></a>         <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb60-3"><a href="マクロデータ.html#cb60-3" tabindex="-1"></a>         <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb60-4"><a href="マクロデータ.html#cb60-4" tabindex="-1"></a>         <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">65</span>))</span></code></pre></div>
<p>わずか数行の入力で以下のグラフのようなヨーロッパ地図を描くことができます.あわせてNUTレベル2の地図も描いてみましょう.上述のグラフ作成との違いはggplot()にsfオブジェクト名shp2を指定するだけです.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="マクロデータ.html#cb61-1" tabindex="-1"></a>nuts2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(shp2) <span class="sc">+</span></span>
<span id="cb61-2"><a href="マクロデータ.html#cb61-2" tabindex="-1"></a>         <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb61-3"><a href="マクロデータ.html#cb61-3" tabindex="-1"></a>         <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb61-4"><a href="マクロデータ.html#cb61-4" tabindex="-1"></a>         <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">65</span>))</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_8.png" alt="異なったNUTSレベルの地理情報" />
<div class="figcaption">異なったNUTSレベルの地理情報</div>
</div>
<p>北欧地域だけを描く場合には,x軸範囲とy軸の範囲を以下のように限定すれば,北欧地域だけの地図を描くことができます.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="マクロデータ.html#cb62-1" tabindex="-1"></a>n_euro <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(shp0)<span class="sc">+</span></span>
<span id="cb62-2"><a href="マクロデータ.html#cb62-2" tabindex="-1"></a>    <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb62-3"><a href="マクロデータ.html#cb62-3" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">32</span>))<span class="sc">+</span>      <span class="co">#　北欧地域の範囲を経度で指定</span></span>
<span id="cb62-4"><a href="マクロデータ.html#cb62-4" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">54</span>,<span class="dv">70</span>))<span class="sc">+</span>     <span class="co">#　北欧地域の範囲を緯度で指定</span></span></code></pre></div>
<p><strong>2 犯罪・暴力・破壊行為に対する不安度データのダウンロード</strong></p>
<p>次に,犯罪や暴力に対する不安度データを地図上に表示するために,犯罪に関連するデータを探します.これはすでに紹介したsearch_eurostat()関数を利用します.
“crime（犯罪）”をキーワードにデータを探してみましょう.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="マクロデータ.html#cb63-1" tabindex="-1"></a><span class="fu">search_eurostat</span>(<span class="st">&quot;crime&quot;</span>,<span class="at">type=</span><span class="st">&quot;table&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="マクロデータ.html#cb63-2" tabindex="-1"></a>    <span class="fu">View</span>()</span></code></pre></div>
<p>上のスクリプトを実行すると,search_eurostat()の結果をView()関数に渡しているため,crimeに関連した検索結果が表示されます.関連するデータテーブルは１つだけで<strong>sdg_16_20</strong>というファイルです.このデータは地域における犯罪・暴力・破壊行為を報告した人の比率を示しています.そうした点では人々の犯罪や暴力に対する不安度を代理する指標として良いでしょう.</p>
<p>次に,データ・テーブルsdg_16_20をダウンロードし,結果をcrimeというオブジェクトに容れます.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="マクロデータ.html#cb64-1" tabindex="-1"></a>   crime<span class="ot">&lt;-</span><span class="fu">get_eurostat</span>(<span class="at">id=</span><span class="st">&quot;sdg_16_20&quot;</span>,<span class="at">time_format =</span> <span class="st">&quot;num&quot;</span>)</span></code></pre></div>
<p>これによりヨーロッパ諸国の犯罪・暴力・破壊行為の報告者比率データを取得できます.ここから第１に,北欧４カ国とバルト３国の７ヵ国だけを抽出します.このために変数のgeoの値が”DK”,“SE”,“NO”,“FI”,“LV”,“EE”,“LT”のどれかをとる行を抽出します.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="マクロデータ.html#cb65-1" tabindex="-1"></a>   <span class="fu">filter</span>(geo <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;DK&quot;</span>,<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;NO&quot;</span>,<span class="st">&quot;FI&quot;</span>,<span class="st">&quot;LV&quot;</span>,<span class="st">&quot;EE&quot;</span>,<span class="st">&quot;LT&quot;</span>))</span></code></pre></div>
<p>ここで”geo %in% c()“は「geo変数がc（国コード）の中のいずれかに等しい国コードをとる行を選択しなさい」を意味しています.また,このデータは,incgrpという変数を持っていますが,これはincome group（所得グループ）を示し,所得階層別情報を提供しています.しかし,ここでは所得階層別情報は使いませんのでincgrp変数のうち値がTOTALの行だけを抽出します.そこで上の抽出条件にくわえて,次の抽出条件も入力します.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="マクロデータ.html#cb66-1" tabindex="-1"></a>   <span class="fu">filter</span>(incgrp <span class="sc">==</span> <span class="st">&quot;TOTAL&quot;</span>)</span></code></pre></div>
<p>２つの抽出条件をあわせると,次のようになります.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="マクロデータ.html#cb67-1" tabindex="-1"></a>   <span class="fu">filter</span>(geo <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;DK&quot;</span>,<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;NO&quot;</span>,<span class="st">&quot;FI&quot;</span>,<span class="st">&quot;LV&quot;</span>,<span class="st">&quot;EE&quot;</span>,<span class="st">&quot;LT&quot;</span>), incgrp <span class="sc">==</span> <span class="st">&quot;TOTAL”)</span></span></code></pre></div>
<p>さらに,時間も2017年に指定し ― time == 2017 ―,最終的に次のように入力します.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="マクロデータ.html#cb68-1" tabindex="-1"></a>  ne_crime <span class="ot">&lt;-</span> crime <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="マクロデータ.html#cb68-2" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">==</span> <span class="dv">2017</span>, geo <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;DK&quot;</span>,<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;NO&quot;</span>,<span class="st">&quot;FI&quot;</span>,<span class="st">&quot;LV&quot;</span>,<span class="st">&quot;EE&quot;</span>,<span class="st">&quot;LT&quot;</span>), incgrp <span class="sc">==</span> <span class="st">&quot;TOTAL&quot;</span>)</span></code></pre></div>
<p>filter()の基本コードはfilter(データフレーム名,抽出条件)ですが,ここではパイプ(%&gt;%)を利用し,データフレームcrimeを関数filter()に渡していますのでデータフレーム名が省略されています.
最終的に,ne_crimeというオブジェクトに容れます.</p>
<p>以上で,北欧地域の犯罪や暴力に対する不安度を示す指標が取得できました.これを地図上に表示させるために,地図情報の入ったshp0と結合します.</p>
<p><strong>3 シェイプファイルshp0と犯罪データファイルne_crimeの結合</strong></p>
<p>ここではヨーロッパの地図情報の入った”shp0”ファイルと,北欧地域の犯罪不安度情報の入った”ne_crime”ファイルを結合します.データフレームの結合にあたっては<strong>inner_join()</strong>関数を使います.ジョイン_join()は２つのデータテーブルの変数を結合します.inner_join()はby= “キー変数”にしたがって,キーの値が等しい観察値が結合されます.したがってキー変数にマッチしない観察値は除外されます.</p>
<p>inner_join()のもっとも簡単な書き方は次のようになります.２つのデータフレームa,bがある場合,</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="マクロデータ.html#cb69-1" tabindex="-1"></a><span class="fu">inner_join</span>(データフレームa,データフレームb, <span class="at">by =</span> <span class="st">&quot;キー変数&quot;</span>)</span></code></pre></div>
<p>それではinner_join()を利用し,shp0とne_crimeを,両データフレームに共通のgeo変数を基準に結合します.その上でshp_neというオブジェクトに容れます.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="マクロデータ.html#cb70-1" tabindex="-1"></a>  shp_ne <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp_0, ne_crime, <span class="at">by =</span> <span class="st">&quot;geo&quot;</span>) </span></code></pre></div>
<p>これで不安度指標と地理空間情報の入った,74行×17列のデータフレームが作成されました.残りの作業はggplot2を使って,不安度指標を色の濃淡で示した北欧地図を描くだけです.</p>
<p>shp_neはsfクラスのオブジェクトです.このため描画にあたってはgeom_sf()関数に渡すだけです.この場合,何よって色分けするかをaes() で指定します.この例では,犯罪・暴力・破壊行為の報告者比率を示すvalues変数の値の大きさで色分けします.このために <strong>fill = values</strong>とします.</p>
<p>具体的には,まず最初に,ggplot()にデータフレーム名を指定します.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="マクロデータ.html#cb71-1" tabindex="-1"></a> <span class="fu">ggplot</span>(shp_ne) <span class="sc">+</span></span></code></pre></div>
<p>次に,geom_sf()関数を使ってデータを地図に描きますが,変数valuesを地図上の色の濃淡で表現するために,aes(fiill = )で指定します.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="マクロデータ.html#cb72-1" tabindex="-1"></a><span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">&quot;white&quot;</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span></code></pre></div>
<p>values変数は犯罪・暴力・破壊行為の報告者比率です.さらに,color = ““でボーダー（国境）をwhite(白)で描き,その線の太さをsize = で指定しています.これで基本的な作業は終わりです.実行すると,犯罪・暴力・破壊行為の報告者比率がデフォルトの色の濃淡によって描かれた北欧地図が出力されます.
この例ではさらに,<strong>scale_fill_continuous_tableau()</strong>を使って犯罪・暴力・破壊行為の報告者比率を描く色の濃淡をグレイに変更します.この関数によって連続したカラースケールを指定することができます.引数palett =”“部分に”Blue”, “Red”のように入力します.ここでは白黒印刷にあわせ,グレイの色を採用しています.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="マクロデータ.html#cb73-1" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">&quot;Classic Gray&quot;</span>)<span class="sc">+</span></span></code></pre></div>
<p>次に,labs()を使ってタイトルをつけます.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="マクロデータ.html#cb74-1" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;The share of the population who reported </span><span class="sc">\n</span><span class="st">that they face the problem of crime, violence or vandalism, 2017&quot;</span>,　<span class="at">fill =</span> <span class="st">&quot;% the respondent </span><span class="sc">\n</span><span class="st">feels crime&quot;</span>) <span class="sc">+</span></span></code></pre></div>
<p>英文タイトルの中のthatの前に<code>"\n"</code>が挿入されていることに気づいたと思います.これはその部分で文書の改行を命令する記号です.また,fill = ““によって色の濃淡を表示するバーのタイトルを指定しています.
最後に,背景のテーマを設定します.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="マクロデータ.html#cb75-1" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p>以上のスクリプトをまとめると,つぎのようになります,</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="マクロデータ.html#cb76-1" tabindex="-1"></a><span class="fu">ggplot</span>(shp_ne) <span class="sc">+</span></span>
<span id="cb76-2"><a href="マクロデータ.html#cb76-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">&quot;white&quot;</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb76-3"><a href="マクロデータ.html#cb76-3" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">&quot;Classic Gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb76-4"><a href="マクロデータ.html#cb76-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;The share of the population who reported </span><span class="sc">\n</span><span class="st">that they face the problem of crime, violence or vandalism, 2017&quot;</span>,　<span class="at">fill =</span> <span class="st">&quot;% the respondent </span><span class="sc">\n</span><span class="st">feels crime&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-5"><a href="マクロデータ.html#cb76-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p>これを実行すると,次のようなグラフが描かれます.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_9.png" style="width:50.0%" alt="犯罪や暴力,破壊行為の問題に直面していると回答した人の割合（％）" />
<div class="figcaption">犯罪や暴力,破壊行為の問題に直面していると回答した人の割合（％）</div>
</div>
<p>見られるように,サンプル経済の中では編集者ミカエル<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> の活躍するスウエーデンがもっとも高く,これにリガの犬<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> が蠢くラトビア等のバルト３国が続きます.バルト海を挟む諸国において犯罪や暴力,破壊行為の問題に直面している人々が多そうです.こうした社会的不安が犯罪小説の創造に寄与しているのかもしれません
.</p>
<p><strong>4 地理空間情報― NUTSレベル3の利用</strong></p>
<p>さらに,スウェーデンに注目し,こうした犯罪の背景―犯罪や暴力,破壊行為―を地域レベルでみてみましょう.これまで地理空間をNUTSレベル０としてきました.つまり国単位で情報を扱っていました.次に,北欧社会の中でも,犯罪や暴力,破壊行為の問題にもっとも強く直面しているスウェーデンに注目し,NUTSレベルを3までブレークダウンし,より詳細な犯罪情報を地図上に描いてみます.</p>
<p>上で利用したデータはNUTSレベル２の情報を提供していませんが,犯罪に関連したNUTSレベル２,3のデータとしては<strong>「犯罪記録件数」(Crimes recorded by the police by NUTS 3 regions)</strong>があります.このデータをget_eurostat()を利用し,ダウンロードします.これをcrimeという名前をつけたオブジェクトに容れます.本データの<strong>id</strong>は<strong>crim_gen_reg</strong>です.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="マクロデータ.html#cb77-1" tabindex="-1"></a>  crime <span class="ot">&lt;-</span> <span class="fu">get_eurostat</span>(<span class="at">id =</span> <span class="st">&quot;crim_gen_reg&quot;</span>)</span></code></pre></div>
<p>最初に,スウェーデンをピックアップします.このためgeo変数にfilter()をかけますが,抽出条件をgeo == “SE”とすると,スウェーデンの国内の行政単位のデータ―たとえば,SE1,SE2という記号で表示―は抽出条件に合致しないため,削除されてしまいます.そこで最初に,<strong>str.detect()</strong>関数を使って”SE”という文字列を持つgeo変数の行を探します.そしてそれと一致したgeo変数の行を抽出します.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="マクロデータ.html#cb78-1" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str.detect</span>(geo,<span class="st">&quot;SE&quot;</span>))</span></code></pre></div>
<p>str.detect(geo, “SE”)はgeo変数が “SE”という文字列を含む場合,真TRUEを返します.これにfilter()を適用することによって,str.detect()関数がTRUEを返す行を抽出します.
データは2009年と2010年のみですが,ここでは2010年を採用します.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="マクロデータ.html#cb79-1" tabindex="-1"></a>    <span class="fu">filter</span>(Date <span class="sc">==</span> <span class="st">&quot;2010-01-01&quot;</span>)</span></code></pre></div>
<p>以上,必要な行の抽出が終わりです.これまでのスクリプトをまとめると,以下のようになります.抽出結果をcrime_sweという名前をつけたオブジェクトに容れてあります.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="マクロデータ.html#cb80-1" tabindex="-1"></a>crime_swe <span class="ot">&lt;-</span> crime <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="マクロデータ.html#cb80-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(geo, <span class="st">&quot;SE&quot;</span>), time <span class="sc">==</span> <span class="st">&quot;2009-01-01&quot;</span>) </span></code></pre></div>
<p>次に,NUTSレベル３のデータをダウンロードし,shp3という名前のオブジェクトに容れます</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="マクロデータ.html#cb81-1" tabindex="-1"></a>shp3 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">3</span>, <span class="at">year =</span> <span class="dv">2016</span>) </span>
<span id="cb81-2"><a href="マクロデータ.html#cb81-2" tabindex="-1"></a><span class="co"># NUTS分類のレベル3で地図情報を取得し,オブジェクトshp3に容れる</span></span></code></pre></div>
<p>それでは,crime_sweとNUTSレベル3のシェイプファイルをinner_join()関数を使って結合します.そして結合したファイルをshp3_crime_sweという名前のオブジェクトに容れます.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="マクロデータ.html#cb82-1" tabindex="-1"></a>shp3_crime_swe <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp3,crime_swe, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;NUTS_ID&quot;</span><span class="ot">=</span><span class="st">&quot;geo&quot;</span>)) </span></code></pre></div>
<p>by = “キー変数”の部分がこれまでと異なります.２つのファイルを結合するさいに,異なる変数を利用する場合,上述のように<strong>by = c(“NUTS_ID”=“geo”)</strong>とします.NUTS_IDはshp_2の中の変数,geoはcrime_sweの中の変数です.</p>
<p>これで地図を作成するデータが出来上がりました.あとはggplot２を利用するだけです.スクリプトは次のようになります.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="マクロデータ.html#cb83-1" tabindex="-1"></a><span class="fu">ggplot</span>(shp3_crime_swe) <span class="sc">+</span></span>
<span id="cb83-2"><a href="マクロデータ.html#cb83-2" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">&quot;white&quot;</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb83-3"><a href="マクロデータ.html#cb83-3" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb83-4"><a href="マクロデータ.html#cb83-4" tabindex="-1"></a>    <span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">&quot;Classic Gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb83-5"><a href="マクロデータ.html#cb83-5" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Crimes recorded by the police,2010&quot;</span>,</span>
<span id="cb83-6"><a href="マクロデータ.html#cb83-6" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">&quot;% the number of </span><span class="sc">\n</span><span class="st">crimes recorded by the police&quot;</span>)<span class="sc">+</span> </span>
<span id="cb83-7"><a href="マクロデータ.html#cb83-7" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/fig3_10.png" style="width:70.0%" alt="スウェーデンにおける犯罪記録件数, 2010" />
<div class="figcaption">スウェーデンにおける犯罪記録件数, 2010</div>
</div>
<p>ここでは単純に犯罪件数を表示させているだけですから,スウェーデンの中でも大都市圏―Stockholms県,Västra Götalands県やSkåne県等―で犯罪件数が多いことが理解されます.またグラフから理解されるように,犯罪件数には地理的な関連があるかもしれません.犯罪が多発する県の隣接する県でも多そうです.これは空間的なデータが相関していることを示唆しており,空間情報を分析するさいに注意を要する点です.</p>
<p><strong>参考文献</strong> Chris Brunsdon, Lex Comber著(湯谷啓明・工藤和奏・市川太祐訳)『Rによる地理空間データ解析入門』共立出版, 2018年.</p>
</div>
</div>
<div id="OECD" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> 経済協力開発機構 - OECD<a href="マクロデータ.html#OECD" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>OECDが提供するデータは、もちろん、OECDのサイト<a href="https://stats.oecd.org">OECD.Stat</a> からも取得できます。同
サイトに入ると、左側のウィンドウにテーマ別データ一覧が表示されており、ここから目的のデータを探すことができます。ウ
ィンドウ上部にある検索ウィンドウからキーワード検索も可能です.</p>
<p>しかし、この方法ではRから離れブラウザでデータを検索し、データをダウンロードすることになります。こ
れは煩わしい作業であることは言うまでもなく、データ分析のための再現性も難しくなるかもしれません。こ
うした問題に対処するために、RパッケージOECDを利用することが推奨されます。こ
のパッケージによってOECDのAPIから動的で再現性の高い方法でデータをダウンロードすることができます.</p>
<div id="rパッケージoecdの利用方法" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> RパッケージOECDの利用方法<a href="マクロデータ.html#rパッケージoecdの利用方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>それでは同パッケージをインストールしましょう。コ
ンソール画面に次のように入力し、エンターキーを押してください。</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="マクロデータ.html#cb84-1" tabindex="-1"></a><span class="co"># RパッケージOECDのインストール</span></span>
<span id="cb84-2"><a href="マクロデータ.html#cb84-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;OECD&quot;</span>)</span></code></pre></div>
<p>パッケージを利用するにはlibrary()で呼び出しておく必要があります。ス
クリプト画面に次のように入力し、実行しておきます。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="マクロデータ.html#cb85-1" tabindex="-1"></a><span class="co"># RパッケージOECDの呼び出し</span></span>
<span id="cb85-2"><a href="マクロデータ.html#cb85-2" tabindex="-1"></a><span class="fu">library</span>(OECD)</span></code></pre></div>
<div id="データを探す---get_datasets-search_dataset" class="section level4 hasAnchor" number="2.4.1.1">
<h4><span class="header-section-number">2.4.1.1</span> データを探す - get_datasets(), search_dataset()<a href="マクロデータ.html#データを探す---get_datasets-search_dataset" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>OECDのデータをダウンロードするにはデータ系列のidコードが必要となります。し
かし、ほとんどの場合、正確なidコード情報を事前に保有していることは少ないと思います。そ
こで最初に、利用可能なデータセットとその説明を含むデータフレームをダウンロードし、その上で検索を始めるのがベストの方法です。こ
れは<strong>get_datasets()</strong>関数で実行できます。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="マクロデータ.html#cb86-1" tabindex="-1"></a><span class="co"># OECDのデータフレームのリストを取得</span></span>
<span id="cb86-2"><a href="マクロデータ.html#cb86-2" tabindex="-1"></a>  <span class="fu">get_datasets</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-3"><a href="マクロデータ.html#cb86-3" tabindex="-1"></a><span class="co"># head()関数でデータフレームの冒頭部分を表示</span></span>
<span id="cb86-4"><a href="マクロデータ.html#cb86-4" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<p>head()関数によって最初の６行を表示させています。全
体で1,392行×2列のデータフレームが取得されます。１
列目はデータセットのid、２列目titleはデータセットのタイトル名です。こ
れによってOECDにおいて、どのようなデータセットが利用可能かが分かります。</p>
<p>データセットの検索方法としては<strong>search_dataset()</strong>関数を使ってキーワードで検索する方法もあります。た
とえば、失業”unemployment”をキーワードに検索してみましょう。こ
れを実行すると、コンソール画面に”unemployment”を含んだデータ等の一覧が表示されます.デフォルトでは大文字小文字を区別しません。</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="マクロデータ.html#cb87-1" tabindex="-1"></a><span class="fu">search_dataset</span>(<span class="st">&quot;unemployment&quot;</span>)</span></code></pre></div>
</div>
<div id="データセットのダウンロード---get_dataset" class="section level4 hasAnchor" number="2.4.1.2">
<h4><span class="header-section-number">2.4.1.2</span> データセットのダウンロード - get_dataset()<a href="マクロデータ.html#データセットのダウンロード---get_dataset" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>それでは最初のデータセット<strong>DUR_I―Incidence of unemployment by duration</strong> (期間別の失業者発生比率％)―をダウンロードしてみましょう.データのダウンロードには<strong>get_dataset()</strong>関数を使います.基本的な使い方は次のようになります,</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="マクロデータ.html#cb88-1" tabindex="-1"></a><span class="fu">get_dataset</span>(<span class="st">&quot;dataset&quot;</span>, <span class="at">filter =</span> <span class="cn">NULL</span>, <span class="at">start_time =</span> <span class="cn">NULL</span>, <span class="at">end_time =</span> <span class="cn">NULL</span>,</span>
<span id="cb88-2"><a href="マクロデータ.html#cb88-2" tabindex="-1"></a>        <span class="at">pre_formatted =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>この関数がとる主要な引数は以下のとおりです.</p>
<ul>
<li>dataset : ダウンロードするデータセットのidを入力します.</li>
<li>filter= : NULLの場合、すべてダウンロードします.</li>
<li>start_time = : データの開始時点.</li>
<li>end_time = : データの終了時点.</li>
</ul>
<p>この関数を使ってDUR_Iデータを取得し、それをunempというオブジェクトに容れるとします.もっとも簡単なコードは次のとおりです.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="マクロデータ.html#cb89-1" tabindex="-1"></a>unemp<span class="ot">&lt;-</span> <span class="fu">get_dataset</span>(<span class="st">&quot;DUR_I&quot;</span>)</span></code></pre></div>
<p>str(unemp)でデータフレームの中をみると、8変数、155,924の観察値のデータセットがダウンロードされたことが分かります.str()関数はデータフレームの変数（列）や観測値（行）についての情報を出力させる関数です.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="マクロデータ.html#cb90-1" tabindex="-1"></a><span class="fu">str</span>(unemp)</span></code></pre></div>
<p>引数を指定した形でデータをダウンロードしてみましょう.<strong>引数filter</strong>を使って日本とドイツのデータ、引数start_tim,end_timeで期間を1990年から2019年のデータをダウンロードするとします.このためにはスクリプトに次のように入力するだけです.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="マクロデータ.html#cb91-1" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">get_dataset</span>(<span class="st">&quot;DUR_I&quot;</span>,<span class="at">filter=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;JPN&quot;</span>,<span class="st">&quot;DEU&quot;</span>)),</span>
<span id="cb91-2"><a href="マクロデータ.html#cb91-2" tabindex="-1"></a>          <span class="at">start_time =</span> <span class="dv">1990</span>,<span class="at">end_time =</span> <span class="dv">2019</span>)</span></code></pre></div>
<p>また、たとえば、filter = “age”のように、変数についてもfilterを適用できます.</p>
</div>
<div id="データ構造を調べる---get_data_structure" class="section level4 hasAnchor" number="2.4.1.3">
<h4><span class="header-section-number">2.4.1.3</span> データ構造を調べる - get_data_structure()<a href="マクロデータ.html#データ構造を調べる---get_data_structure" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ダウンロードしたデータの内容は、上述のように、str()関数やView()関数を利用して確認することができます.しかし、これだけではそれぞれの変数が何を意味するのか分からない場合があります.たとえば、<strong>DURATION変数</strong>が「（失業）期間」を表現していることは分かりますが、しかし、その変数がとる <strong>“UN1”, “UN3”</strong>といった値が何を意味しているかは分かりません.このためデータ構造をチェックする必要があります.</p>
<p>データ構造のチェックには<strong>get_data_structure()</strong>関数を利用します.同関数は指定したデータシリーズの変数名とその説明を返します.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="マクロデータ.html#cb92-1" tabindex="-1"></a><span class="co"># DUR_Iのデータ構造の説明を取得、data_strに容れます.</span></span>
<span id="cb92-2"><a href="マクロデータ.html#cb92-2" tabindex="-1"></a>data_str<span class="ot">&lt;-</span><span class="fu">get_data_structure</span>(<span class="st">&quot;DUR_I&quot;</span>)</span>
<span id="cb92-3"><a href="マクロデータ.html#cb92-3" tabindex="-1"></a></span>
<span id="cb92-4"><a href="マクロデータ.html#cb92-4" tabindex="-1"></a><span class="co"># str()関数でdata_strの中を見ます.</span></span>
<span id="cb92-5"><a href="マクロデータ.html#cb92-5" tabindex="-1"></a><span class="fu">str</span>(data_str,<span class="at">max.level =</span> <span class="dv">1</span>)  </span></code></pre></div>
<p>このさい、表示レベルをmax.level = 1を使い、１に指定しています.max.level=を利用せずに、str(data_str)と入力しても、類似した情報が得られますが、出力画面が煩雑になるので、この例ではmax.level=1に抑えています.</p>
<p>コンソール画面に上のように入力し、エンターキーを押すと、図のような出力結果が得られます.DUR_Iの説明を見ると、VAR_DESCを初めとし、あわせて12の変数があることが分かります.ここでDURATION変数の詳細を確認してみましょう.コンソール画面に<code>data_str$DURATION</code>と入力し、エンターキーを押してみてください.
<code>$</code>記号はデータフレームの中の変数を指定する方法です.つまり、data_str$DURATIONは「データフレームdata_strの中の変数DURATIONを指定」を意味します.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="マクロデータ.html#cb93-1" tabindex="-1"></a><span class="co">#データフレームdata_strの中の変数DURATIONを指定.</span></span>
<span id="cb93-2"><a href="マクロデータ.html#cb93-2" tabindex="-1"></a>data_str<span class="sc">$</span>DURATION       </span></code></pre></div>
<p>これにより変数DURATIONのとる値が何を意味しているかを示した一覧が出力されます.これをみると、変数DURATIONの値”UN1”は１月未満,“UN2”は１月以上３ヶ月未満の失業期間を示すことが分かります.</p>
<p>続けて変数AGEのデータ構造も確認しておきましょう.コンソール画面にdata_str$AGEと入力し、エンターキーを押します.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="マクロデータ.html#cb94-1" tabindex="-1"></a><span class="co">#データフレームdata_strの中の変数AGEを指定.</span></span>
<span id="cb94-2"><a href="マクロデータ.html#cb94-2" tabindex="-1"></a>data_str<span class="sc">$</span>AGE     </span></code></pre></div>
<p>このように、AGE変数はid列に記載されているように1519や1524など７つの値をとります.そしてlabelに示されているように、それぞれ年齢階層に対応しています.たとえば、6599という値は65+と表示されていますので、65歳以上ということが分かります.つまり、65歳以上の失業者数です.年齢に関係ない総数は900000という数値で表現されています.</p>
<p>さらに、失業者の性別を表現する変数SEXをチェックしておきましょう.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="マクロデータ.html#cb95-1" tabindex="-1"></a><span class="co"># データフレームdata_strの中の変数SEXを指定</span></span>
<span id="cb95-2"><a href="マクロデータ.html#cb95-2" tabindex="-1"></a>data_str<span class="sc">$</span>SEX            </span></code></pre></div>
<p>変数SEXは３つの値をとることが分かります.MEN(男性)、WOMAN(女性)およびMW(両者の合計)です.</p>
</div>
</div>
<div id="応用例長期失業者推移の可視化" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> 応用例―長期失業者推移の可視化<a href="マクロデータ.html#応用例長期失業者推移の可視化" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>上でチェックしたデータ構造を利用し、失業問題でとりわけ問題となる長期失業者の推移を調べてみましょう.この例では最初にドイツ、フランス、日本およびアメリカの長期失業者の推移を比較します.その上で日本経済の長期失業に焦点を当てて考察します.作業手順は以下のようになります.</p>
<ul>
<li>手順1 長期失業者の抽出 ― filter(), select()</li>
<li>手順2 文字列型から整数型へのデータの型の変更 ― as.integer()</li>
<li>手順3 長期失業者のプロット―ggplot2による可視化</li>
</ul>
<p><strong>手順1 長期失業者の抽出 ― filter(), select()</strong> 最初に、フランス、ドイツ、日本およびアメリカのデータをダウンロードします.そしてそれをunempというオブジェクトに格納します.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="マクロデータ.html#cb96-1" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">get_dataset</span>(<span class="st">&quot;DUR_I&quot;</span>, <span class="at">filter =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;DEU&quot;</span>,<span class="st">&quot;FRA&quot;</span>,<span class="st">&quot;JPN&quot;</span>,<span class="st">&quot;USA&quot;</span>)),</span>
<span id="cb96-2"><a href="マクロデータ.html#cb96-2" tabindex="-1"></a><span class="at">start_time =</span> <span class="dv">1990</span>,<span class="at">end_time =</span> <span class="dv">2019</span>)</span></code></pre></div>
<p>次に、変数DURATIONを使って失業者に占める長期失業者のシェア（%)だけを抽出します.前掲のように長期失業者（１年以上）は”UN5”の値をとります.また、ここでは年齢別は無視します.年齢階層を無視した場合、変数AGEは”900000”の値をとります.さらに、男女合計の失業者を利用しますので変数SEXは”MW”の値をとるものを選択します.結果をlong_unempと名付けたオブジェクトに容れます.なお、DURATION, AGE,SEX変数の値は文字列ですので,““を付けて指定する必要があります.条件にあった行（観察値）の抽出には<strong>dplyr</strong>の<strong>filter()</strong>関数を利用します.
この関数の書き方は<strong>filter(データフレーム名,抽出条件)</strong>です.ここではパイプ(%&gt;%)でデータフレーム名をfilter()関数に渡しますので、filter()関数の引数は抽出条件だけを入力します.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="マクロデータ.html#cb97-1" tabindex="-1"></a>long_unemp <span class="ot">&lt;-</span> unemp <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="マクロデータ.html#cb97-2" tabindex="-1"></a><span class="co"># filter()関数を使ってDURATIONの値がUN5（失業期間１年以上）, AGEの値が900000（総数）、SEXの値がMW（男女計）を指定</span></span>
<span id="cb97-3"><a href="マクロデータ.html#cb97-3" tabindex="-1"></a>   <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>, AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>, SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>)　</span></code></pre></div>
<p>これで長期失業者数データを取得できます.View(long_unemp)でデータフレームlong_unempを表示できます.ここでは長期失業者の推移を検討するだけですので、必要な変数は国名変数COUNTRY, 観察時点変数obsTIME,および観察値変数ovsValueの３つだけです.<strong>select()</strong>関数を使って３つの変数だけを取り出します.上述のコードにさらにselect()関数をパイプ(%&gt;%)でつなげて３つの変数だけを選択します.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="マクロデータ.html#cb98-1" tabindex="-1"></a>long_unemp <span class="ot">&lt;-</span> unemp <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="マクロデータ.html#cb98-2" tabindex="-1"></a>         <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>, AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>, SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb98-3"><a href="マクロデータ.html#cb98-3" tabindex="-1"></a>  <span class="fu">select</span>(COUNTRY, obsTime, obsValue)</span></code></pre></div>
<p>select()関数では変数名の変更も可能です.obsTimeをyear、obsValueをvalueという変数名に変更しておきます.これを加えて上のコードを書き直すと次のようになります.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="マクロデータ.html#cb99-1" tabindex="-1"></a>long_unemp <span class="ot">&lt;-</span> unemp <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="マクロデータ.html#cb99-2" tabindex="-1"></a>        <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>, AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>, SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="マクロデータ.html#cb99-3" tabindex="-1"></a>         <span class="fu">select</span>(COUNTRY, <span class="at">year =</span> obsTime, <span class="at">value =</span> obsValue)</span></code></pre></div>
<p>なお、変数名の変更はrename()関数を使ってもできます.rename（）関数の使い方は</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="マクロデータ.html#cb100-1" tabindex="-1"></a><span class="fu">rename</span>(新しい変数名 <span class="ot">=</span> 古い変数名)</span></code></pre></div>
<p>上のコードにパイプ（%&gt;%）でつなげてrename()関数を使うと、次のように書くことができます.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="マクロデータ.html#cb101-1" tabindex="-1"></a>long_unemp <span class="ot">&lt;-</span> unemp <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="マクロデータ.html#cb101-2" tabindex="-1"></a>        <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>, AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>, SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-3"><a href="マクロデータ.html#cb101-3" tabindex="-1"></a>        <span class="fu">select</span>(COUNTRY,obsTime,obsValue)  <span class="sc">%&gt;%</span> </span>
<span id="cb101-4"><a href="マクロデータ.html#cb101-4" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">year =</span> obsTime, <span class="at">value =</span> obsValue)</span></code></pre></div>
<p><strong>手順2 文字列型から整数型へのデータの型の変更 ― as.integer()</strong></p>
<p>これで３つの変数―COUNTRY, year, value―を持つ、データフレームlong_unempが出来上がりました.このデータフレームをstr(long_unemp)でみると、国を表現するCOUNTRY変数と暦年を表現するyearが文字列データであることが分かります.<code>$ COUNTRY: chr</code>, <code>$year: chr</code>となっていることに気づくと思います.「chr」はcharacterの略で文字列データであることを示しています.つまり、yearは1990, 1991といった数値ですが、Rはこれを文字として理解しています.また、文字列型のデータは”“で囲まれた形で表記されます.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="マクロデータ.html#cb102-1" tabindex="-1"></a><span class="fu">str</span>(long_unemp)</span></code></pre></div>
<p>文字列データのままでは以下の処理が難しくなりますので、これを数値データ―整数データ―に変換します.データの型を整数に変換するには<strong>as.integer()</strong>関数を利用します.この関数の引数に、データフレームlong_unempの中のyearを指定します.データフレームの中の特定の変数列を指定するには<strong>「データフレーム名$変数列名」</strong>です.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="マクロデータ.html#cb103-1" tabindex="-1"></a><span class="co"># year変数のデータの型を文字列型から整数型に変換.</span></span>
<span id="cb103-2"><a href="マクロデータ.html#cb103-2" tabindex="-1"></a><span class="fu">as.integer</span>(long_unemp<span class="sc">$</span>year)  </span></code></pre></div>
<p>さらに、この型を変換したデータyearをもとのデータフレームに容れます.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="マクロデータ.html#cb104-1" tabindex="-1"></a>  long_unemp<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(long_unemp<span class="sc">$</span>year)</span></code></pre></div>
<p>これは次のような処理を行っています.as.interger（）関数を使ってデータフレームlong_unempの中のyear変数を整数型に変換し、その結果を割当演算子（←）を使ってデータフレームlong_unempの中のyear変数に割り当てます（置き換えます）.コンソール画面でstr(long_unemp)と入力し、エンターキーを押してみてください.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="マクロデータ.html#cb105-1" tabindex="-1"></a><span class="fu">str</span>(long_unemp)</span></code></pre></div>
<p>“$year : int”において理解されるように、変数yearは文字列型chrから整数型intに変わっています.intはintenger（整数）の略です.また文字列型の変数だったときには年数はすべて”“で囲まれていましたが、変数の型を変更した結果,”“も消えています.</p>
<p><strong>手順3 長期失業者のプロット―ggplot2による可視化</strong></p>
<p>それでは４カ国の長期失業者のシェアの推移のグラフを描き、比較してみましょう.グラフの作成にあたってはRパッケージggplot2を利用します.</p>
<p>ggplot2でのグラフの作成方法は,レイヤーをプラス記号（＋）で重ねて行くということがポイントです.最初のレイヤーはもっとも基本的なもので、グラフを描画するための座標平面を作成します.ここでは引数に、利用するデータフレーム名、aes()の中にx軸、y軸に採用するデータを指定します.長期失業者の推移を描くことが目的ですので、x軸の変数にはyear,y軸の変数には長期失業者のシェアvalueを指定します.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="マクロデータ.html#cb106-1" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> long_unemp, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> value))</span></code></pre></div>
<p>これにデータを線で描画するために、geom_line()のレイヤーを重ねます.そのさい国ごとに異なった線種を使うために<strong>lty =</strong>を利用し、lty = COUNTRYと指定します.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="マクロデータ.html#cb107-1" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">lty =</span> COUNTRY))</span></code></pre></div>
<p>さらに、横軸、縦軸ラベルやタイトルを指定するためにlabs()レイヤーを重ねます.この例ではlabs()によってy軸のタイトル(y=)、サブタイトル（subtitle=）を指定しています.そして最後に、背景の種類を指定し、重ねています.背景はシンプルな白黒背景利用するためにtheme_bw()を使っています.すべてのコードをまとめると、以下のようになります.
これを実行すると,グラフが描かれます.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="マクロデータ.html#cb108-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> long_unemp,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb108-2"><a href="マクロデータ.html#cb108-2" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">lty =</span> COUNTRY))<span class="sc">+</span></span>
<span id="cb108-3"><a href="マクロデータ.html#cb108-3" tabindex="-1"></a>     <span class="fu">labs</span>(</span>
<span id="cb108-4"><a href="マクロデータ.html#cb108-4" tabindex="-1"></a>         <span class="at">y=</span><span class="st">&quot;long-term unemployment (%)&quot;</span>,</span>
<span id="cb108-5"><a href="マクロデータ.html#cb108-5" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;Share of long-term unemployment ( % of total ) &quot;</span></span>
<span id="cb108-6"><a href="マクロデータ.html#cb108-6" tabindex="-1"></a>        )<span class="sc">+</span></span>
<span id="cb108-7"><a href="マクロデータ.html#cb108-7" tabindex="-1"></a>     <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>このグラフから理解されるように、2000以前にはヨーロッパでは長期失業が高水準にあり、対照的に、日本とアメリカでは長期失業の水準は低い水準にあったことが分かります.しかし、この構図は1990年後半以降、変化しています.日本経済では長期失業者の割合が急速に高まり、ヨーロッパ水準に近づきつつあります.リーマンショックの影響でアメリカでも一時的に長期失業者が急増しますが、その後は急速に減少して行きます.しかし、日本では高止まりしていることが見て分かります.</p>
<p>現在では、日本でもフランスやドイツのように、職を探し続けても１年以上仕事が見つからない人が３割～４割に達しています.そこで日本経済だけに注目し、さらに詳しくみて行くことにしましょう.長期失業者がどの年齢階層で増加しているのか、また男女別で相違はあるのか、という２つの問題を考えてみます.この問題に答えるために、以下のような３つのグラフ-パネル(a)(b((c)-を作成します.</p>
<p>グラフのパネル(b)を見ると、長期失業者比率の動きには男女別でそれほど大きな違いは見られないようです.男女ともに長期失業者が1990年台中頃から上昇していきますが、男性失業者は40パーセント台、女性失業者は20パーセント台で止まりつつあるようです.したがってこうした長期的な動向は男女に共通の要因―たとえば、政策の変化―が影響していると想像されます.しかし、両者の水準は大きく異なり,失業者に占める長期失業者の比率は男性労働者が女性労働者を大きく上回ります.これには男女間の求職意欲の相違、雇用形態の違い、産業別の男女別就業比率等、さまざまな性差に特有の要因が影響としていると思われます.</p>
<p>パネル(c)は年齢別の推移を描いています.特徴的なのは65歳以上の高齢者層（6599）が他の年齢層に比べ一貫して高い水準にあったにもかかわらず、2020年に近づくにつれて減少してきたという点です.これと対照的に、1990年代から中核的な労働力層―<code>25~54歳（2554）,55~64歳（5564）</code>―の長期失業者比率が上昇してきています.失業の長期化は労働者の技能を引き下げると言われています.今後、この中核労働者層の失業が長期化すれば、労働者の技能の陳腐化ひいては生産性の停滞のいっそうの悪化へといたるかもしれません.</p>
<p>パネル(a)(b)(c)のグラフの作成スクリプトを紹介しておきましょう.</p>
<p><strong>パネル(a)</strong></p>
<p>最初に、get_data()関数を利用し、日本経済の期間別失業者比率をダウンロードします.ここでは日本一カ国ですので、filter = list()の中に日本の国別コードJPNを指定するだけです.また、結果をunemp_jpというオブジェクトに格納します.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="マクロデータ.html#cb109-1" tabindex="-1"></a>unemp_jp <span class="ot">&lt;-</span> <span class="fu">get_dataset</span>(<span class="st">&quot;DUR_I&quot;</span>, <span class="at">filter =</span> <span class="fu">list</span>(<span class="st">&quot;JPN&quot;</span>),<span class="at">start_time =</span> <span class="dv">1990</span>,<span class="at">end_time =</span> <span class="dv">2019</span>)</span></code></pre></div>
<p>unemp_jpが基本のデータセットになります.最初に、性別、年齢別に関係のなく全体の長期失業者を抽出します.このため、filter()関数により長期失業者を指定します.これはDURATION変数の値が”UN5”と一致するものを選択します.次に、性別は全体ですので、SEX変数において両性の合計を示す”MW”を指定します.最後に、同じく年齢階層に関係なく全体を指定します.このためにAGE変数において値が”900000”のものを選択します.</p>
<p>次に、select()関数によって必要な変数を取り出します.必要な変数はAGE, SEX, obsTime, obsValueの４つです.この４変数の名前をselect()関数の中に入力します.このさい、obsTime, obsValueの名前を、それぞれyear, valueという短い名前に変更しています.これはselect()関数の中で”新しい変数名 = 古い変数名”で変更できます.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="マクロデータ.html#cb110-1" tabindex="-1"></a>long_unemp_jp_totl <span class="ot">&lt;-</span> unemp_jp <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="マクロデータ.html#cb110-2" tabindex="-1"></a>        <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>,SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>,AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb110-3"><a href="マクロデータ.html#cb110-3" tabindex="-1"></a>        <span class="fu">select</span>(AGE,SEX,<span class="at">year =</span> obsTime, <span class="at">value =</span> obsValue) </span></code></pre></div>
<p>最後に、以上の結果をlong_unemp_jp_totlというオブジェクトに格納します.しかし、１つだけ困ったことがあります.str(long_unemp_jp_totl)で確認できるように、year変数は数値データではなく、文字列データとなっています.そこでas.integer()関数を利用し、整数型に変更し、もとのyearに容れます.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="マクロデータ.html#cb111-1" tabindex="-1"></a>    long_unemp_jp_totl<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(long_unemp_jp_totl<span class="sc">$</span>year)</span></code></pre></div>
<p><code>long_unemp_jp_totl$year</code>はデータフレームlong_unemp_jp_totlの中のyearを指定しています.<code>$</code>はデータフレームの中の特定の変数を指定するさいに利用する記号です.</p>
<p>これでパネル(a)のグラフを描くためのデータセットが出来上がりました.グラフを描くためにはRパッケージggplot2を利用します.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="マクロデータ.html#cb112-1" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(long_unemp_jp_totl,<span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y=</span> value))<span class="sc">+</span></span>
<span id="cb112-2"><a href="マクロデータ.html#cb112-2" tabindex="-1"></a> </span>
<span id="cb112-3"><a href="マクロデータ.html#cb112-3" tabindex="-1"></a><span class="co">#　データの描画を線に指定  </span></span>
<span id="cb112-4"><a href="マクロデータ.html#cb112-4" tabindex="-1"></a>   <span class="fu">geom_line</span>()<span class="sc">+</span>     </span>
<span id="cb112-5"><a href="マクロデータ.html#cb112-5" tabindex="-1"></a></span>
<span id="cb112-6"><a href="マクロデータ.html#cb112-6" tabindex="-1"></a><span class="co">#  データの点の形をshape=によって描画する点の形を指定(2は三角形を意味する).</span></span>
<span id="cb112-7"><a href="マクロデータ.html#cb112-7" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">2</span>)<span class="sc">+</span>     </span>
<span id="cb112-8"><a href="マクロデータ.html#cb112-8" tabindex="-1"></a></span>
<span id="cb112-9"><a href="マクロデータ.html#cb112-9" tabindex="-1"></a>     <span class="fu">labs</span>(</span>
<span id="cb112-10"><a href="マクロデータ.html#cb112-10" tabindex="-1"></a>         <span class="at">y=</span><span class="st">&quot;long-term unemployment (%)&quot;</span>,</span>
<span id="cb112-11"><a href="マクロデータ.html#cb112-11" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="st">&quot;(a) Total &quot;</span></span>
<span id="cb112-12"><a href="マクロデータ.html#cb112-12" tabindex="-1"></a>        )<span class="sc">+</span></span>
<span id="cb112-13"><a href="マクロデータ.html#cb112-13" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>ここではggplot2を利用して描いたグラフを”total &lt;- “によって、totalという名前をつけたオブジェクトに格納しています.グラフをtotalというオブジェクトに入れましたのですぐにはグラフは出力されません.グラフを表示させるにはコンソール画面にグラフのオブジェクト名totalと入力し、エンターキーを押すか、スクリプト画面に同じようにtotalと入力し、実行[Run]する必要があります.</p>
<p><strong>パネル(b)</strong></p>
<p>パネル(b)は性別の長期失業者比率を描きます.このためfilter()関数によって長期失業者を抽出し、両性の合計を除外し、また年齢別も無関係ですので総数の値（行）だけを抽出します.</p>
<p>長期失業者の抽出にはDURATION変数で”UN5”の値を指定します.次に性別が重要ですので、両方の性の合計を示す”MW”をSEX変数から除外します.このためには「SEX == “MW”」の前に「!」（論理演算子の否定）をつけておきます.これによってSEX変数から両性の合計を示すの値（行）が除外されます.最後に、AGE変数のうち総数を示す値”900000”を指定します.この結果filter()関数の引数は以下のようになります.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="マクロデータ.html#cb113-1" tabindex="-1"></a><span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>,<span class="sc">!</span>SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>,AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>)</span></code></pre></div>
<p>次に、select()関数によってグラフ作成に必要な変数だけを選択します.そのさいあわせて変数の名前も変更しておきます.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="マクロデータ.html#cb114-1" tabindex="-1"></a><span class="fu">select</span>(AGE,SEX,<span class="at">year =</span> obsTime, <span class="at">value =</span> obsValue）</span></code></pre></div>
<p>以上をパイプ(%)でつなげて全体を書くと次のようになります.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="マクロデータ.html#cb115-1" tabindex="-1"></a>long_unemp_jp_sex <span class="ot">&lt;-</span> unemp_jp <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="マクロデータ.html#cb115-2" tabindex="-1"></a>        <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>,<span class="sc">!</span>SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>,AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="マクロデータ.html#cb115-3" tabindex="-1"></a>        <span class="fu">select</span>(AGE,SEX,<span class="at">year =</span> obsTime,<span class="at">value =</span> obsValue) </span></code></pre></div>
<p>ここでもyear変数の型は文字列となっています.そこでas.integer()関数を利用し、整数型に変更し、もとのyearに容れます.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="マクロデータ.html#cb116-1" tabindex="-1"></a>    long_unemp_jp_sex<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(long_unemp_jp_sex<span class="sc">$</span>year)</span></code></pre></div>
<p>これでパネル（b）のグラフ作成に必要なデータフレームlong_unemp_jp_sexが出来上がりました.残りの作業はパネル(a)の作成と同じように、ggplot2を利用し作成します.ここでは出来上がったグラフをsexというオブジェクトに容れます.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="マクロデータ.html#cb117-1" tabindex="-1"></a>sex<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> long_unemp_jp_sex,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y=</span> value))<span class="sc">+</span></span>
<span id="cb117-2"><a href="マクロデータ.html#cb117-2" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">lty =</span> SEX))<span class="sc">+</span></span>
<span id="cb117-3"><a href="マクロデータ.html#cb117-3" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb117-4"><a href="マクロデータ.html#cb117-4" tabindex="-1"></a>                <span class="at">y=</span><span class="st">&quot;long-term unemployment (%)&quot;</span>,</span>
<span id="cb117-5"><a href="マクロデータ.html#cb117-5" tabindex="-1"></a>                <span class="at">subtitle =</span> <span class="st">&quot;(b) by Sex &quot;</span></span>
<span id="cb117-6"><a href="マクロデータ.html#cb117-6" tabindex="-1"></a>                         )<span class="sc">+</span></span>
<span id="cb117-7"><a href="マクロデータ.html#cb117-7" tabindex="-1"></a>        <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><strong>パネル(c)</strong></p>
<p>パネル(c)は年齢階層別の長期失業者比率を描きます.このためfilter()関数によってDURATION変数のうち長期失業者の値・行（“UN5”）、両性の合計を示す値・行（“MW”）を抽出します.ここで年齢階層が重要ですので、AGE変数のうち総数を示す値・行（“900000”）を除外します.これを実行するfilter（）関数は次のようになります.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="マクロデータ.html#cb118-1" tabindex="-1"></a><span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>,SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>,<span class="sc">!</span>AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>)</span></code></pre></div>
<p>残りのスクリプトはパネル(a)(b)と同じです.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="マクロデータ.html#cb119-1" tabindex="-1"></a>long_unemp_jp_age <span class="ot">&lt;-</span> unemp_jp <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="マクロデータ.html#cb119-2" tabindex="-1"></a>        <span class="fu">filter</span>(DURATION <span class="sc">==</span> <span class="st">&quot;UN5&quot;</span>,SEX <span class="sc">==</span> <span class="st">&quot;MW&quot;</span>,<span class="sc">!</span>AGE <span class="sc">==</span> <span class="st">&quot;900000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-3"><a href="マクロデータ.html#cb119-3" tabindex="-1"></a>        <span class="fu">select</span>(AGE,SEX,<span class="at">year =</span> obsTime, <span class="at">value =</span> obsValue) </span>
<span id="cb119-4"><a href="マクロデータ.html#cb119-4" tabindex="-1"></a> </span>
<span id="cb119-5"><a href="マクロデータ.html#cb119-5" tabindex="-1"></a>long_unemp_jp_age<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(long_unemp_jp_age<span class="sc">$</span>year)</span></code></pre></div>
<p>グラフ作成のためのスクリプトも同じです.ここではggplot2作成されたグラフはageというオブジェクトに格納されています.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="マクロデータ.html#cb120-1" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> long_unemp_jp_age,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb120-2"><a href="マクロデータ.html#cb120-2" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">lty =</span> AGE))<span class="sc">+</span></span>
<span id="cb120-3"><a href="マクロデータ.html#cb120-3" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> AGE))<span class="sc">+</span></span>
<span id="cb120-4"><a href="マクロデータ.html#cb120-4" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb120-5"><a href="マクロデータ.html#cb120-5" tabindex="-1"></a>                <span class="at">y=</span><span class="st">&quot;long-term unemployment (%)&quot;</span>,</span>
<span id="cb120-6"><a href="マクロデータ.html#cb120-6" tabindex="-1"></a>                <span class="at">subtitle =</span> <span class="st">&quot;(c) by Age &quot;</span></span>
<span id="cb120-7"><a href="マクロデータ.html#cb120-7" tabindex="-1"></a>                             )<span class="sc">+</span></span>
<span id="cb120-8"><a href="マクロデータ.html#cb120-8" tabindex="-1"></a>        <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><strong>３つのグラフのレイアウト- patchwork</strong></p>
<p>３つのグラフはそれぞれtotal, sex, ageというオブジェクトに入っています.コンソール画面もしくはスクリプト画面にグラフを格納したオブジェクト名を入力し、エンターキーを押すか、実行[Run]すれば、plotウインドウにグラフが出力されます.</p>
<p>３つのグラフのレイアウトを整えるために、ここではRパッケージpatchwork を利用しています.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="マクロデータ.html#cb121-1" tabindex="-1"></a><span class="co"># patchworkのインストール</span></span>
<span id="cb121-2"><a href="マクロデータ.html#cb121-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;patchwork&quot;</span>) </span>
<span id="cb121-3"><a href="マクロデータ.html#cb121-3" tabindex="-1"></a><span class="co"># patchworkの呼び出し</span></span>
<span id="cb121-4"><a href="マクロデータ.html#cb121-4" tabindex="-1"></a><span class="fu">library</span>(patchwork)            </span></code></pre></div>
<p>使い方はとても簡単です.グラフを２つ横に並べて描きたい場合にはグラフのオブジェクト名をプラス記号（＋）でつなげるだけです.たとえば、sex+ageと入力し、実行[Run]します.積み重ねたい場合は割り算記号（/）を使います.また、横に配置したい場合はパイプライン記号（｜）を使います.次のように入力することでレイアウトを決定しています.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="マクロデータ.html#cb122-1" tabindex="-1"></a>total<span class="sc">|</span>sex<span class="sc">/</span>age</span></code></pre></div>
</div>
<div id="応用例時系列データの分析" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> 応用例―時系列データの分析<a href="マクロデータ.html#応用例時系列データの分析" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次に日本経済の為替レートデータを使って簡単な時系列分析を行ってみましょう.</p>
<p><strong><em>(1)為替レートデータの取得</em></strong></p>
<p>最初に、get_dataset()関数を使って日本円の為替レート（1ドルの円表記）データをダウンロードします.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="マクロデータ.html#cb123-1" tabindex="-1"></a>exchangeRate <span class="ot">&lt;-</span>  <span class="fu">get_dataset</span>(<span class="st">&quot;REFSERIES_MSIT&quot;</span>,<span class="at">filter =</span> <span class="fu">list</span>(<span class="st">&quot;JPN&quot;</span>), </span>
<span id="cb123-2"><a href="マクロデータ.html#cb123-2" tabindex="-1"></a><span class="at">start_time =</span> <span class="dv">1990</span>, <span class="at">end_time =</span> <span class="dv">2018</span>)</span></code></pre></div>
<p>head()関数でデータフレームexchangeRateの内容を表示させると、４つの変数の存在が分かりますが、ここで必要なのは観察時点と観察値だけです.そこでselect()関数を使って２つの変数だけを選択します.また、観察時点は、年次、４半期および月次が混在しているようです.そこでfilter()関数を使って月次データだけを取り出すことにします.filter()関数を適用するさいに、注意しないといけないのはobsTime変数が文字列型だということです.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="マクロデータ.html#cb124-1" tabindex="-1"></a><span class="fu">head</span>(exchangeRate)</span></code></pre></div>
<p>以下のスクリプトではselect()関数で２つの変数列―obsTimeとobsValue―選択し、さらにfilter()関数で月次データの行だけを取り出しています.この結果はhead(exchangeRate_jpn)で確認できます.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="マクロデータ.html#cb125-1" tabindex="-1"></a>exchangeRate_jpn <span class="ot">&lt;-</span> exchangeRate <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="マクロデータ.html#cb125-2" tabindex="-1"></a>        <span class="fu">select</span>(obsTime, obsValue) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="マクロデータ.html#cb125-3" tabindex="-1"></a>         <span class="fu">filter</span>(<span class="fu">str_detect</span>(obsTime,<span class="st">&quot;-&quot;</span>),<span class="sc">!</span><span class="fu">str_detect</span>(obsTime,<span class="st">&quot;Q&quot;</span>)) </span></code></pre></div>
<p>このコードでは、最初にselect(obsTime,obsValue)を使って２つの変数列―obsTime, obsValue―を抽出しています.次に、filter()関数によって月次データの行だけを抽出しています.</p>
<p>filter()関数では2つの抽出条件を入力しています.月次データは”1990-01”のようにハイフンをもったデータです.最初の条件はそこに注目し、obsTime変数のうちハイフン記号（“-”）を持つ値（行）だけを抽出しています.ここで特定の文字列を探す<strong>str_detect()</strong>関数を利用しています.関数の書式は<strong>str_detect(対象となる変数名,“探す文字列”)</strong>ですので、str_detect(obsTime, “-”)としています.しかし、この抽出条件だけでは”-Q3”といったようなハイフン記号つき四半期データも抽出されてしまいます.そこで第２の抽出条件str_detect(obsTime,“Q”)によってobsTime変数の値（行）のうち”Q”を有するデータを抽出し、その前に否定を意味する<strong>“!”</strong>を付けることによって四半期データを示すデータ―Q1,Q2,Q3,Q4つきデータ―の値（行）を除外しています.</p>
<p>一連の処理はパイプ（%&gt;%）でつなげてあり、最終的に、結果をexchangeRate_jpnというオブジェクトに格納しています.str()でこの結果を表示してみましょう.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="マクロデータ.html#cb126-1" tabindex="-1"></a><span class="fu">str</span>(exchangeRate_jpn)</span></code></pre></div>
<p>データセットは288行×2列からなることが分かります.</p>
<p><strong><em>(２)　クラスの変更―data.frameクラスからtsクラスへ</em></strong></p>
<p>コンソール画面にclass(exchangeRate_jpn)と入力し、エンターキーを押してみてください.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="マクロデータ.html#cb127-1" tabindex="-1"></a><span class="fu">class</span>(exchangeRate_jpn)</span></code></pre></div>
<p>class()関数はオブジェクトexchangeRate_jpnがどのクラスに属するかを表示します.出力結果―[1] “tbl_df”, “tbl”, “data.frame”― はこのexchangeRate_jpnがデータフレームのクラスに属することを示しています.</p>
<p>オブジェクトはクラスという属性を持ちます.Rの統計関数の多くはジェネリック型generictと呼ばれる関数です.クラスはこのジェネリック関数を使うさいに利用されます.summary()やplot()といった頻繁に利用される関数もジェネリック関数です.ジェネリック関数summary()は要約作成関数ですが、たとえば、hist()の出力に対してsummary()関数を使うと、それに合わせた要約を作成し、回帰関数lm()の出力に対してsummary()を呼び出すと、lm()に適した要約を作成します.つまり、Rはオブジェクトのクラスを基礎に、そのクラスに適した形でジェネリック関数をオブジェクトに適用します.plot()関数もジェネリック関数ですので、ほぼすべてのRオブジェクトに使うことができます.Rはオブジェクトのクラスを基礎に適切なプロット関数を見つけ出します.Rがオブジェクト指向言語と呼ばれる所以です.</p>
<p>この例でのオブジェクトexchangeRate_jpnは、上の出力結果が示すように、データフレームに属するクラスです.時系列データを扱うにはデータフレームクラスよりもts(もしくはxts)というクラスが便利です.そこでexchangeRate_jpnのクラスを変更することにします.時系列オブジェクトを作成するには関数<strong>ts()</strong>を用います.
この関数の基本的な用法は次のようになります.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="マクロデータ.html#cb128-1" tabindex="-1"></a>    <span class="fu">ts</span>(<span class="at">data =</span> , <span class="at">start =</span> , <span class="at">end =</span> , <span class="at">frequency =</span> )</span></code></pre></div>
<p>基本的な引数は次の３つです.</p>
<ul>
<li>data = 観測された時系列値のベクトルまたは行列を指定．</li>
<li>start = 最初の観測の時刻を指定します. end = startと同じ方法で指定された最後の観測時刻.</li>
<li>frequency = 単位時間あたりの観察値の数</li>
</ul>
<p>為替レートの値(exchagneRate_jpnの中のobsValue)をtsクラスに変換し,その結果をyen_exchangeRateに容れます.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="マクロデータ.html#cb129-1" tabindex="-1"></a>yen_exchangeRate <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="at">data =</span> exchangeRate_jpn<span class="sc">$</span>obsValue, <span class="at">start =</span> <span class="dv">1990</span>, <span class="at">end =</span> <span class="dv">2019</span>, <span class="at">frequency =</span><span class="dv">12</span>)</span></code></pre></div>
<p>これで時系列データが作成されました.class(yen_exchangeRate)で確認すると、オブジェクトyen_exchangeRateがtsクラスに属することが分かります.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="マクロデータ.html#cb130-1" tabindex="-1"></a><span class="fu">class</span>(yen_exchangeRate)</span></code></pre></div>
<p><strong>(3)RパッケージTSstudioを利用した時系列データ分析</strong></p>
<p>それでは日本経済の為替レートの時系列データyen_exchangeRateを分析してみましょう.そのために時系列データ分析用RパッケージTSstudioを利用することにします.最初に、このパッケージをインストールします.コンソール画面に次のように入力し、エンターキーを押してください.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="マクロデータ.html#cb131-1" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;TSstudio&quot;</span>)  </span></code></pre></div>
<p>さらに、library()関数を使い呼び出します.スクリプト画面に次のように入力し、実行[Run]します.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="マクロデータ.html#cb132-1" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span></code></pre></div>
<p>これでTSstudioに用意されているさまざまな時系列データ分析ツールが利用できるようになりました.最初に、為替レートの時系列データyen_exchangeRateの情報を取得してみましょう.このためにはts_info()関数を用い、引数に時系列データ名を入力するだけです.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="マクロデータ.html#cb133-1" tabindex="-1"></a>    <span class="fu">ts_info</span>(yen_exchangeRate)</span></code></pre></div>
<p>この結果、上のように時系列データに関する情報がコンソール画面に出力されます.</p>
<p>次に、為替レートをプロットしてみましょう.この処理はts_plot()関数を利用するだけです.用法は通常のplot()関数と同じです.このコードを実行することにより、プロット画面にグラフが出力されます.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="マクロデータ.html#cb134-1" tabindex="-1"></a>  <span class="fu">ts_plot</span>(yen_exchangeRate)</span></code></pre></div>
<p>為替レートの推移をみると、2010年台後半より急激にドルに対して円が低下してきていることが分かります.時期的には、第2次安倍政権の誕生(2012年12月)の時期に一致しています.同内閣が採用した異次元の金融緩和政策が功を奏した結果と思われます.</p>
<p>時系列データの分析の目的には、たとえば、季節パタンがあるか、トレンドはどのようになっているか、構造変化は発生しているか、といった問題に答えることがあげられます.こうした問題に答えるために、時系列データを分解してみましょう.このために<strong>ts_decompose()</strong>関数を利用します.この関数は時系列データを、トレンド成分、季節成分、およびランダム成分に分解し、各成分を可視化します.基本的なコードは以下のとおりです.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="マクロデータ.html#cb135-1" tabindex="-1"></a><span class="fu">ts_decompose</span>(ts.obj, <span class="at">type =</span> “”, <span class="at">showline =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>この関数は３つの引数を取ります.</p>
<ul>
<li>ts.objの箇所には時系列データ名を入力します.ただし、ここにはtsクラスに属するオブジェクトでなければなりません.オブジェクトのクラスを変更したのはこのためです.</li>
<li>typ = ““は季節成分のタイプを設定します.”additive（加法）“,”multiplicative（乗法）“,”both（両者）“のいずれかを選択できます.デフォルト（既定値）はadditive（加法）です.</li>
<li>showline = は論理値をとり、プロット間に分離線を追加します（デフォルト（既定値）はTRUEです）.</li>
</ul>
<p>ここでは引数は時系列データの指定以外、既定値を利用し、次のように入力します.すると、以下のグラフを得ることができます.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="マクロデータ.html#cb136-1" tabindex="-1"></a><span class="fu">ts_decompose</span>(yen_exchangeRate)</span></code></pre></div>
<p>為替レートの変動はトレンドを見ると、1990年台前半には低下傾向を示し、その後2000年台半ばまで上昇し、安定しているようです.しかし、2000年台半ばから低下傾向に入り、2010年台初頭に急激に上昇していることが理解されます.為替レートの変動はトレンドによって説明されるようです.また、当然ですが、季節に特有のパタンを見出すことも難しいようです.つまり、年を超えて、同一の季節変動パタンは存在しないようです.この点を確認するために、時系列の季節パタンと時系列推移のグラフを描いてみましょう.</p>
<p>以下の図は<strong>ts_surface()</strong>関数を利用して描いたグラフです.この図はx軸に年、y軸に月、z軸に為替レートを描いた図です.ここにおいて理解されるように、1990年から2019年をつうじて類似した季節変動パタンは存在しないようです.</p>
<p>ts_surface()関数の利用法は次のようになります.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="マクロデータ.html#cb137-1" tabindex="-1"></a><span class="fu">ts_surface</span>(tsクラスのオブジェクト)</span></code></pre></div>
<p>関数の引数ts.objに時系列データ名を入力するだけです.ただし、この場合も時系列データはtsクラスのオブジェクトでなければなりません.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="マクロデータ.html#cb138-1" tabindex="-1"></a><span class="fu">ts_surface</span>(yen_exchangeRate)</span></code></pre></div>
<p>通常のデータの基本的な特徴を表す統計量として分散や相関があります.これと同じように時系列データの特徴を捉える自己相関と自己共分散と呼ばれる統計量があります.</p>
<p>自己相関(autocorrelation)とは、異なる時点での同一変数（時系列データ）の相関係数です.たとえば、今月の為替レートは１月前の為替レートと関連しているかどうか、ということを自己相関は示します.したがって今月の為替レートと先月のそれとの間に大きな正の自己相関が観察されれば、１月前の為替レートが高いとき、今月の為替レートも高くなることが理解できます.</p>
<p>TSstudioには自己相関係数をグラフ化する<strong>ts_cor()</strong>が用意されています.ts_cor()関数を実行すると、縦軸に自己相関係数、横軸にラグ―１ヶ月前、２ヶ月前、３ヶ月前…― をとったいわゆるコレログラムCorrelogramと呼ばれるグラフが出力されます.ts_cor()関数の基本的な書き方は次のようになります.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="マクロデータ.html#cb139-1" tabindex="-1"></a><span class="fu">ts_cor</span>(ts.obj, <span class="at">type =</span> <span class="st">&quot;both&quot;</span>, <span class="at">seasonal =</span> <span class="cn">TRUE</span>, <span class="at">ci =</span> <span class="fl">0.95</span>,</span>
<span id="cb139-2"><a href="マクロデータ.html#cb139-2" tabindex="-1"></a>  <span class="at">lag.max =</span> <span class="cn">NULL</span>, <span class="at">seasonal_lags =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<ul>
<li>ts.ob この引数にはtsクラスの時系列データを指定します.</li>
<li>type = ““:”“にacf,pacf,あるいはbothの文字列を入力します.これによって出力させるグラフを指定します</li>
<li>acfはACF（自己相関係数）,　pacfはPACF（偏自己相関係数）をプロットします.両者をプロットさせたい場合はboth（デフォルト既定値）を指定します.</li>
<li>seasonal = : =にブール値を入力します.TRUE（デフォルト既定値）の場合、季節ラグを色付けします.</li>
<li>ci =: 推定値の有意水準(0から1の間の数値)を指定します.　デフォルト（既定値）は0.95に設定されています</li>
<li>lag.max = : acfを計算するための最大ラグを指定. デフォルト（既定値）は 10*log10(N/m). ここで N は観察値の数であり，m は系列の数です．系列内の観察値数よりも1つ少ない値に自動的に制限されます.</li>
<li>seasonal_lags =: 整数のベクトルをとり、（系列の主要な季節的ラグの他に）特定の周期的なラグを強調します．たとえば、月次系列（頻度12）の場合、引数を3に設定すると、四半期のラグが強調されます.</li>
</ul>
<p>それではts_cor()関数を利用し、日本経済の為替レートのコレログラムを描いてみましょう.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="マクロデータ.html#cb140-1" tabindex="-1"></a><span class="fu">ts_cor</span>(yen_exchangeRate,<span class="at">type =</span> <span class="st">&quot;acf&quot;</span>)</span></code></pre></div>
<p>ここではtype引数にacfを指定している以外、既定値を利用しています.これを実行すると、グラフが出力されます.</p>
<p>ラグがゼロのときは今月の為替レートと今月の為替レートの相関をとることになりますので、言うまでもなく１になります.コレログラムからわかるように、ある月 の値が大きければ、その１ヶ月後の値も大きくなっています.そのために、連続する ２ヶ月間の自己相関が高いことが分かります.しかし、タイムラグを長くなるにつれて、自己相関は徐々に低下して行きます.</p>
<p>ts_cor()関数の出力結果で観察されるように、為替レート系列は直近の為替レート系列と強い線形関係を持っていることが分かります.系列とそのラグの関係は,系列とそのラグの間の相関関係をグラフ化する<strong>ts_lags()</strong>関数を使うことでより直感的に確認できます.ts_lags()関数の基本的なコードは以下のようになります.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="マクロデータ.html#cb141-1" tabindex="-1"></a><span class="fu">ts_lags</span>(ts.obj, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,<span class="at">n_plots =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>ts.obj にはtsクラスの時系列データを指定します.
lags = ラグの範囲を指定する整数値を入力します.デフォルト（既定値）は12です.
n_plots = 1行あたりのプロット数を指定する整数値を入力します.</p>
<p>それではラグの値を３ヶ月、６ヶ月、12ヶ月、そして24ヶ月に指定し、グラフを描いてみましょう.１から12のラグを連続的に指定するには”1:12”を使うことでできますが、４つのラグを指定する場合にはc（）を使います.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="マクロデータ.html#cb142-1" tabindex="-1"></a><span class="fu">ts_lags</span>(yen_exchangeRate,<span class="at">lags =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">24</span>))</span></code></pre></div>
<p>これを実行すると、為替レートデータ系列とそのラグ―４つのラグ―との相関が出力されます.グラフから理解されるように、lag 3でもlag 6でもかなり強い相関があることが視覚的に理解できます.しかし、lag 12でも相関の存在を見ることができるものの、両者の相関はかなり弱くなっています.lag 24になると、ほとんど相関は観察されません.</p>
<p>本項では時系列データの簡単な分析方法―基本的に記述的分析―を紹介してきました.あわせてR言語におけるクラスという概念も紹介しました.オブジェクトはすべてクラスという属性を持ち、それがジェネリック関数の利用にあたって重要な役割を果たすことも理解できたと思います.</p>
<p><strong>参考文献</strong></p>
<ul>
<li>北川源四郎『Rによる時系列モデリング入門』岩波書店, 2020年.</li>
<li>村尾博『Rで学ぶVAR実証分析 – 時系列分析の基礎から予測まで』オーム社, 2019年.</li>
</ul>
</div>
</div>
<div id="金融データを取得する-imf-bis" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> 金融データを取得する ― IMF &amp; BIS<a href="マクロデータ.html#金融データを取得する-imf-bis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="IMF" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> 国際通貨基金(IMF) - imfr<a href="マクロデータ.html#IMF" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>国際通貨基金<a href="https://www.imf.org/external/np/ds/matrix.htm">IFM</a>は金融データを中心に多くのデータを公開しています.Rにはそうしたデータを取得するために便利なRパッケージimfrが開発されています.最初にインストールします.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="マクロデータ.html#cb143-1" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;imfr&quot;</span>)</span></code></pre></div>
<p>続けて、library()関数で呼び出します.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="マクロデータ.html#cb144-1" tabindex="-1"></a>  <span class="fu">library</span>(imfr)</span></code></pre></div>
<p>これでRパッケージimfrが利用可能となります。I
MFがAPIをつうじて公開するデータをダウンロードするには関数<strong>imf_data()</strong>を利用します.このimf_data()は以下の引数をとります.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="マクロデータ.html#cb145-1" tabindex="-1"></a>    <span class="fu">imf_data</span>(</span>
<span id="cb145-2"><a href="マクロデータ.html#cb145-2" tabindex="-1"></a>         <span class="at">database_id =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb145-3"><a href="マクロデータ.html#cb145-3" tabindex="-1"></a>         <span class="at">indicator =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb145-4"><a href="マクロデータ.html#cb145-4" tabindex="-1"></a>         <span class="at">country =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb145-5"><a href="マクロデータ.html#cb145-5" tabindex="-1"></a>         <span class="at">start =</span> <span class="dv">2000</span>,</span>
<span id="cb145-6"><a href="マクロデータ.html#cb145-6" tabindex="-1"></a>        <span class="at">end =</span> <span class="fu">current_year</span>(),</span>
<span id="cb145-7"><a href="マクロデータ.html#cb145-7" tabindex="-1"></a>        )</span></code></pre></div>
<ul>
<li><p>database_id = ““: ダウンロードしようとする特定のデータベースのIDを指定します.</p></li>
<li><p>indicator = ““: ダウンロードしようとするIMFの指標IDを指定します.　</p></li>
<li><p>country = ““: ISOの２桁コードを使って国を指定します.
country = ’all’とした場合、利用可能な国すべてのデータがダウンロードされます.</p></li>
<li><p>start =, end = : データの開始年と終わりの年を指定します.</p></li>
<li><p>freq: 年次データ(A)、四半期データ(Q)および月次データ(M)かを指定します.
たとえば、年次データを取得する場合には、<code>freq = "A"</code>と指定します.</p>
<p>それではimfrを利用し、IMFからデータをダンロードしてみましょう.ここでの例では、アメリカ、中国および日本の実効為替レートデータをダウンロードし、exch_rateというオブジェクトに容れます.</p></li>
</ul>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="マクロデータ.html#cb146-1" tabindex="-1"></a>exch_rate <span class="ot">&lt;-</span> <span class="fu">imf_data</span>(<span class="at">database_id =</span> <span class="st">&quot;IFS&quot;</span>,</span>
<span id="cb146-2"><a href="マクロデータ.html#cb146-2" tabindex="-1"></a>                   <span class="at">indicator =</span> <span class="st">&quot;EREER_IX&quot;</span>,</span>
<span id="cb146-3"><a href="マクロデータ.html#cb146-3" tabindex="-1"></a>                   <span class="at">country =</span> <span class="fu">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;JP&quot;</span>),</span>
<span id="cb146-4"><a href="マクロデータ.html#cb146-4" tabindex="-1"></a>                   <span class="at">freq =</span><span class="st">&quot;A&quot;</span>)</span></code></pre></div>
<p>上のスクリプトを実行することでアメリカ、中国および日本の実効為替レートがダウンロードされます.この実効為替レートは消費者物価にもとづく指数です.ダウンロードされたデータはデータフレーム形式で保存されます.str(exch_rate)でデータの構造・内容を確認してみます.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="マクロデータ.html#cb147-1" tabindex="-1"></a>  <span class="fu">str</span>(exch_rate)</span></code></pre></div>
<div id="imfrの利用方法" class="section level4 hasAnchor" number="2.5.1.1">
<h4><span class="header-section-number">2.5.1.1</span> imfrの利用方法<a href="マクロデータ.html#imfrの利用方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>上の例で理解されるように、データをダウンロードするためには、database_id = ““に入力する<strong>データベースID</strong>、およびindicator =”“に入力する<strong>指標ID</strong>の情報を取得しておく必要があります.このために３つの手順をとります.</p>
<ul>
<li>手順1 データベースを探す― imf_ids( )</li>
<li>手順2 特定のデータベースのコードリストを取得する - imf_codelist()</li>
<li>手順3 指標IDを取得する - imf_codes()0</li>
</ul>
<p>以下の例では、データベース<strong>International Financial Statistics(IFS)</strong>から<strong>実効為替レート</strong>をダウンロードすることを想定した手順を紹介します.</p>
<p><strong>手順1 どのようなデータベースがあるのか ― imf_ids( )</strong>*</p>
<p>データベースのIDを取得するための関数<code>imf_ids（）</code>を利用します.これを実行した結果をdbIDという名前をつけたオブジェクトに容れるとします.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="マクロデータ.html#cb148-1" tabindex="-1"></a>   dbID <span class="ot">&lt;-</span>  <span class="fu">imf_ids</span>(<span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><code>imf_ids()</code>は２つの引数を取ります.</p>
<ul>
<li>引数return_rawは論理値すなわちTRUEかFALSEを取ります.上の例のように、<code>return_raw = FALSE</code>と指定した場合、IDとその説明が入ったデータフレームが返されます.<code>return_raw = TRUE</code>の場合には、生のデータフローのリストが返されます.</li>
<li>timesは要求の最大回数を指定します.</li>
</ul>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="マクロデータ.html#cb149-1" tabindex="-1"></a>    <span class="fu">View</span>(dbID)</span></code></pre></div>
<p>View()関数によってdbIDの内容を見てみましょう.次のようなデータベース一覧が出力されます.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/IMF_DB.png" style="width:70.0%" alt="IMFデータベース一覧" />
<div class="figcaption">IMFデータベース一覧</div>
</div>
<p>imf_ids()の結果を容れたオブジェクトdbIDの中には260行×２列のデータフレームが入っています.つまり、260のデータベースIDが表示されます.<code>View(dbID)</code>によってデータフレームdbIDを内容を見てください.２列の変数すなわちデータベースIDとその説明が表示されます.これを下にスクロールしていくと、IFSというデータベースIDとその説明 ―International Financial Statistics―が見つかります.この<code>IFS</code>が、データをダウンロードするさい、imf_data()関数の引数database_id = ““に入力するデータベースIDとなります.</p>
<p><strong>手順2 IFSデータセットの中の指標名を探す ― imf_codelist()</strong></p>
<p>次に、個別のIMFデータベース―この例では”IFS”―からコードリストを取得します.基本的なスクリプトの書き方は次のようになります.
　</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="マクロデータ.html#cb150-1" tabindex="-1"></a>        <span class="fu">imf_codelist</span>(database_id, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">time =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>これを使って手順１で取得したdatabase_id ―“IFS”― を利用し、データセットの中のcodeリストを取得します.ここではその結果をcodeListという名前をつけたオブジェクトに容れます.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="マクロデータ.html#cb151-1" tabindex="-1"></a>codeList <span class="ot">&lt;-</span> <span class="fu">imf_codelist</span>(<span class="at">database_id =</span> <span class="st">&quot;IFS&quot;</span>, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>imf_codelist()関数は個別IMFデータベースのコードリストを取得しますが、この関数は次の３つの引数をとります.</p>
<ul>
<li>database_id: imf_ids()で取得したデータベースID（文字列）を入力します.</li>
<li>return_raw: TRUEかFALSEかの論理値をとります。TRUEを指定した場合、もとのデータ構造リストを返し、FALSEを指定した場合、コードリストのコードと説明の入ったデータフレームを返します.</li>
<li>times: 要求回数を入力します.</li>
</ul>
<p>これによってデータベースIFSが持つコードリストが取得されます.View(codeList)で中身をみると、次のような一覧が表示されます.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/IMFcodelist.png" style="width:50.0%" alt="コードリスト" />
<div class="figcaption">コードリスト</div>
</div>
<p>このコードリストのdescription(説明)から理解されるように、指標IDは４行目のcode <strong>CL_INDICATOR_IFS</strong>に入っていることがわかります.</p>
<p><strong>手順3. 指標IDを取得する ― imf_codes( )</strong></p>
<p>最後に、“CL_INDICATOR_IFS”を使って指標IDを取得します.このためにはifm_codes()関数を利用します。こ
の書式はつぎのようになります.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="マクロデータ.html#cb152-1" tabindex="-1"></a>  <span class="fu">imf_codes</span>(<span class="at">codelist =</span> <span class="st">&quot;&quot;</span>, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>これによってimf_data()関数の引数<code>indicator = ""</code>に指定する指標コードを取得することができます.この関数を利用し、IFSの中の指標コードを取得してみましょう.関数imd_codes()は個別のデータベースのコードを取得しますが、この関数もimf_codelist()と同様の引数をとります.ただし引数codelist = ““にはimf_codelist()によって取得したコード名を入力します.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="マクロデータ.html#cb153-1" tabindex="-1"></a>indicatorID <span class="ot">&lt;-</span> <span class="fu">imf_codes</span>(<span class="at">codelist =</span> <span class="st">&quot;CL_INDICATOR_IFS&quot;</span>, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>これによって1679行×２列のデータフレームが得られます.View(indicatorID)によって内容を表示すると、指標コード名とその説明の一覧をみることができます.これによってimf_data()を使ってデータをダウンロードするさいに必要な情報、すなわち引数indicator =　““に入力する指標コードの情報が得られます.２列目の指標の説明を下にスクロールさせ、<strong>Exchange Rates, Nominal Effective Exchange Rate, Index</strong>を見つけてください.これに対応する１列目の指標コード<strong>ENEER_IX</strong>が入力する情報です.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/IMFind_code.png" style="width:70.0%" alt="指標コード一覧" />
<div class="figcaption">指標コード一覧</div>
</div>
<p>以上の情報にもとづいてデータそのものがダウンロードできます.再度、スクリプトを表示しておきます.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="マクロデータ.html#cb154-1" tabindex="-1"></a>    exch_rate <span class="ot">&lt;-</span> <span class="fu">imf_data</span>(<span class="at">database_id =</span> <span class="st">&quot;IFS&quot;</span>,</span>
<span id="cb154-2"><a href="マクロデータ.html#cb154-2" tabindex="-1"></a>                   <span class="at">indicator =</span> <span class="st">&quot;ENEER_IX&quot;</span>,</span>
<span id="cb154-3"><a href="マクロデータ.html#cb154-3" tabindex="-1"></a>                   <span class="at">country =</span> <span class="fu">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;JP&quot;</span>),</span>
<span id="cb154-4"><a href="マクロデータ.html#cb154-4" tabindex="-1"></a>                   <span class="at">freq =</span><span class="st">&quot;A&quot;</span>)</span></code></pre></div>
<p>ダウンロードした情報をもとにggplot2を利用して描いたグラフを描いてみましょう.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="マクロデータ.html#cb155-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> exch_rate, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span> year, <span class="at">y =</span> ENEER_IX, <span class="at">group =</span> iso2c))<span class="sc">+</span></span>
<span id="cb155-2"><a href="マクロデータ.html#cb155-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">lty =</span> iso2c))<span class="sc">+</span></span>
<span id="cb155-3"><a href="マクロデータ.html#cb155-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>2000年台初頭、３カ国とも実効為替レートは低下傾向にありますが、2000年台半ばより、まず最初に中国、そして日本の為替レートが上昇し始めます.その後、アメリカと中国の実効為替レートは上昇し続けますが、日本は両国に比べ大きく低下し、明確に異なった為替レートの軌跡を描きます.</p>
<p>2011年に東日本大震災が発生し、日本経済はリーマンショックを超える大幅な落ち込みを見せ、不況に突入しました.2012年末に発足した第2次安倍政権は、デフレ経済からの脱却を目指し、大胆な金融緩和を実行しましたが、その結果が実効為替レートの低下に反映されたと考えられます.「日本株」はお買い得となり、海外からの投資が増加し、日経平均株が上昇します.同時に、円安は輸出を刺激し、輸出に牽引され日本経済は回復に向かいます.</p>
</div>
</div>
<div id="BIS" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> 国際決済銀行(BIS) - BIS<a href="マクロデータ.html#BIS" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="bisパッケージのインストール方法" class="section level4 hasAnchor" number="2.5.2.1">
<h4><span class="header-section-number">2.5.2.1</span> BISパッケージのインストール方法<a href="マクロデータ.html#bisパッケージのインストール方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="https://www.bis.org">BIS(Bank for International Settlements)</a>が提供するデータにアクセスするためにBISというRパッケージが開発されています.このパッケージをインストルールし、呼び出します.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="マクロデータ.html#cb156-1" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BIS&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="マクロデータ.html#cb157-1" tabindex="-1"></a>    <span class="fu">library</span>(BIS)</span></code></pre></div>
</div>
<div id="利用可能なデータセットリスト情報を取得する-get_dataset" class="section level4 hasAnchor" number="2.5.2.2">
<h4><span class="header-section-number">2.5.2.2</span> 利用可能なデータセットリスト情報を取得する ― get_dataset<a href="マクロデータ.html#利用可能なデータセットリスト情報を取得する-get_dataset" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>どのようなデータが利用可能かはBISのホームページでも調べることもできますが、RパッケージBISを利用すれば、簡単に情報を取得することができます.このためにはget_dataset()関数を利用します.以下の例ではデータセットのリストをオブジェクトdatasetListに容れます.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="マクロデータ.html#cb158-1" tabindex="-1"></a>      datasetList <span class="ot">&lt;-</span> <span class="fu">get_datasets</span>()</span></code></pre></div>
<p><code>View()</code>を利用し、データを確認してみましょう.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="マクロデータ.html#cb159-1" tabindex="-1"></a>       <span class="fu">View</span>(datasetList)</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/BISlistavailable.png" style="width:70.0%" alt="BIS-利用可能なデータセット" />
<div class="figcaption">BIS-利用可能なデータセット</div>
</div>
<p>図は<code>View()</code>関数を利用し、dataListの中を表示させたものです.オブジェクトdatasetListの中には24行×2列のデータフレームが格納されています.１列目はデータセットの名前です.２列目はそのURLです.</p>
</div>
<div id="データをダウンロードする-get_bis" class="section level4 hasAnchor" number="2.5.2.3">
<h4><span class="header-section-number">2.5.2.3</span> データをダウンロードする ― get_bis()<a href="マクロデータ.html#データをダウンロードする-get_bis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>BISデータをダウンロードするためには、関数get_bis()を利用しますが、<code>get_bis()</code>関数は<code>get_datasets()</code>によって得たデータリストのurlを引数にとります.</p>
<p>たとえば、図に表示されているdataListの５行目のCredit-to-GDP gapsのデータをダウンロードしてみましょう.dataListはデータフレーム形式ですので、url変数指定は<code>dataList$url</code>でできます.さらに、この変数列の５行目を指定するには<code>dataList$url[5]</code>と入力します.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="マクロデータ.html#cb160-1" tabindex="-1"></a>    creditGDP <span class="ot">&lt;-</span> <span class="fu">get_bis</span>(datasetList<span class="sc">$</span>url[<span class="dv">5</span>])</span></code></pre></div>
<p>この例ではダウンロードしたデータをcreditGDPという名前をつけたオブジェクトに格納しています.これにより、21,848行×12列のデータセットがダウンロードできました.</p>
<p>上の例では５行めを[5]で指定しましたが、データセットの名前name変数でも取得することができます.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="マクロデータ.html#cb161-1" tabindex="-1"></a>    creditGDP <span class="ot">&lt;-</span> <span class="fu">get_bis</span>(datasetList<span class="sc">$</span>url [dataetLIst<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Credit-to-GDP gaps&quot;</span>])</span></code></pre></div>
<p>この例では[]の中で比較演算子”==“がマッチするデータを抽出しています.つまり、<code>datasetLIst$name == "変数の名前"</code>が真である場合データを取得する、という命令です。</p>
<p>BISは中央銀行の利子率データを長期にわたり蓄積しています.次に、この中央銀行の政策利子率をダウンロードしてみましょう.<code>get_dataset()</code> を使って取得したdatasetListの中をみると、22行目に<code>policy rates (monthly)</code>を見つけることができます.<code>get_bis()</code>関数を使ってダウンロードし、オブジェクトpolicyrateに容れます.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="マクロデータ.html#cb162-1" tabindex="-1"></a>    policyrate <span class="ot">&lt;-</span> <span class="fu">get_bis</span>(datasetList<span class="sc">$</span>url [datasetList<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Policy rates (monthly)&quot;</span>])</span></code></pre></div>
<p>ダウンロードされたデータは月次利子率データであり、時系列データです.ここで注意しないといけないのは、時系列データであるにもかかわらず、時間を表現する変数dateは文字列データ型です.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="マクロデータ.html#cb163-1" tabindex="-1"></a>    <span class="fu">class</span>(policyrate<span class="sc">$</span>date)</span></code></pre></div>
<p>このように<code>class(policyrate$date)</code>を実行すると、<code>"character"</code>が出力され、date変数が文字列型であることが分かります.このため利子率データの時間的推移を視覚化するためには適していません.そこでdate変数を文字列型から日付/時刻型に変換しておきましょう.</p>
<p>Rで日付や時刻を扱うにはlubridateパッケージが便利です.このパッケージを利用するためにインストールしておきます.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="マクロデータ.html#cb164-1" tabindex="-1"></a>    <span class="fu">install.packages</span> (<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<p>インストールした後、library()で呼び出します.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="マクロデータ.html#cb165-1" tabindex="-1"></a>    <span class="fu">library</span> (lubridate)</span></code></pre></div>
<p>ダウンロードしたデータのdate変数は文字列型です.これを lubridateを使って日付・時刻の型 ―Date型― に変換します.lubridateを利用した日付の年、月および日はそれぞれ<code>"y","m","d"</code>で表します.データセットpolicyrateの中のdate変数の日付は「1946-03」のように年と月によって表現されています.そこでこの変数をDate型に変換するためには<code>ym(date)</code>と入力します。さ
らに、これをもとの文字列で表現されていたdate変数と置き換えるために次のように入力します.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="マクロデータ.html#cb166-1" tabindex="-1"></a>      policyrate<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">ym</span>(policyrate<span class="sc">$</span>date)</span></code></pre></div>
<p>割当演算子<code>&lt;-</code>の右側はデータフレームの中のdate変数に<code>ym()</code>関数を適用し、文字列型であったものを日付型に変換しています.そしてそのデータ型を変換したdateを、文字列型であったdate変数に割り当てています（置き換えています）.ふたたび、<code>class()</code>で確認すると、</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="マクロデータ.html#cb167-1" tabindex="-1"></a>  <span class="fu">class</span>(policyrate<span class="sc">$</span>date)</span></code></pre></div>
<p>このように日付型―Date型―に変換されていることが分かります.</p>
<p>ダウンロードしたデータをもとに、日本、アメリカ、スウェーデンの長期の政策利子率の動向を観察してみます.</p>
<p>日本（JP)の政策利子率は他の２ヵ国と比較すると、変動が小さく低い水準にあることが分かります.さらに、バブル崩壊後一貫して低金利にあることが分かります.スウェーデン(SE)では1980年台後半に資産価格が上昇していましたが、インフレ懸念から金利が1990年秋に大幅に上昇しました.しかし、その後、マイナス金利がつくほど低下します.アメリカ経済(US)は1980年に大幅に政策金利が上昇していることが理解されます.これは1979年にFRB議長に就任したヴォルカー議長が厳格な金融引き締め政策をとったことに端を発しています.しかし、その後の幾たびかの不況に起因し、政策金利は長期的に低下して行きます.</p>
<p>図を描くスクリプトは次のようになります.最初に、filter()関数を使い、３カ国のデータだけを抽出します.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="マクロデータ.html#cb168-1" tabindex="-1"></a>  policyrate3 <span class="ot">&lt;-</span> policyrate <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="マクロデータ.html#cb168-2" tabindex="-1"></a>      <span class="fu">filter</span>(ref_area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;JP&quot;</span>,<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;US&quot;</span>))</span></code></pre></div>
<p>次に、policyrate3に格納されたデータにggplot()を適用します。</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="マクロデータ.html#cb169-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> policyrate3, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span> date, <span class="at">y=</span>obs_value))<span class="sc">+</span></span>
<span id="cb169-2"><a href="マクロデータ.html#cb169-2" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb169-3"><a href="マクロデータ.html#cb169-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(ref_area))<span class="sc">+</span></span>
<span id="cb169-4"><a href="マクロデータ.html#cb169-4" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb169-5"><a href="マクロデータ.html#cb169-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb169-6"><a href="マクロデータ.html#cb169-6" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb169-7"><a href="マクロデータ.html#cb169-7" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb169-8"><a href="マクロデータ.html#cb169-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>このスクリプトでは、facet_wrap()関数を利用し、国別の複数のグラフを作成しています.facet_wrap()は使い方は次のようになります.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="マクロデータ.html#cb170-1" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(分類する基準となる変数))</span></code></pre></div>
</div>
</div>
<div id="Quandl" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Quandl - GetQuandlData<a href="マクロデータ.html#Quandl" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Quandlは一連の無料および有料のデータへのアクセスを提供する包括的なプラットフォームです.いくつかの中央銀行や研究機関が、このプラットフォームで経済・金融情報を無料で提供しています.<a href="https://www.quandl.com">Quandlのウェブサイト</a>から利用可能な一覧を見ることができます.</p>
<p>Quandlが、同社が提供する公式のRパッケージであり、CRANで利用可能です.しかし、このパッケージにはいくつかの問題があるようです.これに代わるRパッケージとしてGetQuandlDataが開発されています.本資料ではQuandlからデータを取得するにあたり、このパッケージを紹介します.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="マクロデータ.html#cb171-1" tabindex="-1"></a><span class="co"># Githubからインストール</span></span>
<span id="cb171-2"><a href="マクロデータ.html#cb171-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;msperlin/GetQuandlData&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="マクロデータ.html#cb172-1" tabindex="-1"></a> <span class="fu">library</span>(GetQuandlData)</span></code></pre></div>
</div>
</div>
<div id="DB" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> オープンデータポータル - DBnomics<a href="マクロデータ.html#DB" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>フランスの数理経済計画予測研究所(CEPREMAP)</strong>のマクロ経済分析チーム「マクロ経済観測所」に所属するCEPREMAPモデリングチームは、広範囲な経済モデルを扱うためのソフトウェアDynareの開発と同時に、国内外の公開された経済データを集約した<a href="https://db.nomics.world">オープンデータポータルDBnomics</a>を運営しています.</p>
<p>DBnomicsは世界の経済データを一箇所に集め、しかも無料で一般に公開することを目的としたオープンソースプロジェクトです.具体的には、国内機関や国際機関 ― Eurostat, World Bank, IMF, ECB等、87のデータ提供組織・機関 ― から収集された何百万ものデータ系列が提供されています.すでにこれまでに紹介したEurostat, OECD, IMF, BISおよびPenn World Tableも提供されています.</p>
<p>たとえば、2-5でダウンロードしたデータはDBnomicsにおいても取得できます.imfrを使って得た実行為替レートは次のように入力することで得ることできます.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="マクロデータ.html#cb173-1" tabindex="-1"></a>exch_rate_3c <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">&quot;IMF/IFS/A.CN.ENEER_IX&quot;</span>,<span class="st">&quot;IMF/IFS/A.JP.ENEER_IX&quot;</span>,<span class="st">&quot;IMF/IFS/A.US.ENEER_IX&quot;</span>))</span></code></pre></div>
<p>BISによって取得した長期政策利子率を取得するためには次のように入力します.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="マクロデータ.html#cb174-1" tabindex="-1"></a>policyrate3c <span class="ot">&lt;-</span><span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(“BIS<span class="sc">/</span>cbpol<span class="sc">/</span>M.JP”, “BIS<span class="sc">/</span>cbpol<span class="sc">/</span>M.SE”, “BIS<span class="sc">/</span>cbpol<span class="sc">/</span>M.US”))</span></code></pre></div>
<div id="rパッケージ---rdbnomics" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Rパッケージ - rdbnomics<a href="マクロデータ.html#rパッケージ---rdbnomics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>このデータの利用を容易にするために<code>rdbnomics</code>と呼ばれるRパッケージが開発されています.rdbnomicsパッケージは、DBnomics データシリーズへのアクセスを提供します.
ダウンロードするデータ系列の指定にあたっては統一的な方法が採用されています.後で示すように、データの取得にあたってはrdb()関数の<code>idb =</code> 引数で指定しますが、そのさい、データ提供組織名/データセット名/データ系列名という形で指定します.たとえば、<code>rdb = WHO/WHS6/WHS6_102.DEU.A</code>は、データを提供する組織がWHO, データセット名がWHS６、データ系列名はWHS6_102.DEU.Aです.また系列名の末尾のDEUはドイツを示す３文字の国コード、Aは年次データであることを示しています.</p>
<div id="rdbnomicsのインストール" class="section level4 hasAnchor" number="2.6.1.1">
<h4><span class="header-section-number">2.6.1.1</span> rdbnomicsのインストール<a href="マクロデータ.html#rdbnomicsのインストール" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>RパッケージDBnomicsをインストールするには他のRパッケージと同様に次のように入力します。</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="マクロデータ.html#cb175-1" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;rdbnomics&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="マクロデータ.html#cb176-1" tabindex="-1"></a>  <span class="fu">library</span>(rdbnomics)</span></code></pre></div>
</div>
</div>
<div id="rdbnomicsの利用方法" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> rdbnomicsの利用方法<a href="マクロデータ.html#rdbnomicsの利用方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="rdb関数を利用したデータ系列の取得" class="section level4 hasAnchor" number="2.6.2.1">
<h4><span class="header-section-number">2.6.2.1</span> rdb()関数を利用したデータ系列の取得<a href="マクロデータ.html#rdb関数を利用したデータ系列の取得" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>データをダウンロードするためには、<code>rdb()</code>関数を利用します。こ
の関数の利用にあたっては３つの情報が必要となります.</p>
<ul>
<li><p>データの提供機関のコードprovider_code</p></li>
<li><p>データセット・コードdataset_code</p></li>
<li><p>データ系列コードseries_code</p>
<p>この３つの情報を<code>rdb()</code>関数の引数<code>ids =</code> において指定します.ids引数の書き方は次のようになります.</p></li>
</ul>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="マクロデータ.html#cb177-1" tabindex="-1"></a>    ids <span class="ot">=</span> 提供機関コード<span class="sc">/</span>データセット・コード<span class="sc">/</span>データ系列コード</span></code></pre></div>
<p>実際に世界保健機構WHOが提供するドイツの「病床数（人口１万人あたり）」データを取得してみましょう.このためには上の３つの情報が必要となります.データ提供機関コードはWHO, データセット・コードはWHS6, データ系列コードはWHS6_102.DEU.Aです.取得したドイツ病床数データをbeds_deuというオブジェクトに容れるとすると、次のようなスクリプトでダウンロードすることができます.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="マクロデータ.html#cb178-1" tabindex="-1"></a>  beds_deu <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="st">&quot;WHO/WHS6/WHS6_102.DEU.A&quot;</span>)</span></code></pre></div>
<p>結果を<code>str()</code>関数を使い、beds_deuの変数を確認してみましょう。</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="マクロデータ.html#cb179-1" tabindex="-1"></a>  <span class="fu">str</span>(beds_deu)</span></code></pre></div>
<p>21の変数（列）がbeds_deuに格納されていることが分かります.<code>ids()</code>関数を利用し、データを取得すると、少なくとも次の10の変数を得ることができます.</p>
<ul>
<li>dataset_code</li>
<li>provider_code</li>
<li>dataset_name</li>
<li>series_code</li>
<li>original_period</li>
<li>period</li>
<li>original_value</li>
<li>value</li>
<li><span class="citation">@frequency</span></li>
</ul>
<p>データベースごとに異なりますが、上記以外に単位unit、地理情報geo、年次、四半期別等の情報freqを取得することもできます.</p>
<p>以下のグラフはデータフレームbeds_deuのデータををもとggplotを利用し、ドイツの病床の時系列変化のグラフを描いたものです.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="マクロデータ.html#cb180-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> beds_deu, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period,<span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb180-2"><a href="マクロデータ.html#cb180-2" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb180-3"><a href="マクロデータ.html#cb180-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb180-4"><a href="マクロデータ.html#cb180-4" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;per 10000 pupulation&quot;</span>,</span>
<span id="cb180-5"><a href="マクロデータ.html#cb180-5" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Hospital beds (per 10 000 population) in German&quot;</span>)<span class="sc">+</span></span>
<span id="cb180-6"><a href="マクロデータ.html#cb180-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/bedsDEU.png" alt="ドイツにおける病床数" />
<div class="figcaption">ドイツにおける病床数</div>
</div>
<p>繰り返しになりますが、上述のように、データ系列を取得するためは３つの情報が必要となります.そこで３つの情報を取得するための方法を順番に紹介して行きましょう.</p>
<ol style="list-style-type: decimal">
<li>データを提供する機関のコード名</li>
<li>その機関の提供するデータセットのコード名</li>
<li>データ系列のコード名</li>
</ol>
<p><strong>1. 機関のコード名の取得</strong></p>
<p>機関コード名はrdb_providers()関数を利用することで取得できます.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="マクロデータ.html#cb181-1" tabindex="-1"></a>  <span class="fu">rdb_providers</span>(<span class="at">code =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><code>code =</code> 引数はTRUEかFALSEの論理値をとり、既定値はFALSEです.上のように、<code>code = TRUE</code>とした場合、提供機関のコード名が表示されます.既定値FALSEにした場合、機関コード名の他に機関名nama、カバー地域region、ホームページアドレスweb site等が表示されます.</p>
<p><strong>2. データセットコードの取得</strong></p>
<p>このコードの取得のためには<code>rdb_datasets()</code>関数を使います.この関数では特定の機関を指定せずに、すべてのデータセットのリストをダウンロードすることもできますが、<code>rdb_providers()</code>で取得した機関コード指定した方が効率的です.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="マクロデータ.html#cb182-1" tabindex="-1"></a>    <span class="fu">rdb_datasets</span>(<span class="at">provider_code =</span> <span class="st">&quot;IMF&quot;</span>)</span></code></pre></div>
<p>これでIMFの提供するデータセット一覧を取得できます.</p>
<p><strong>3. データ系列リストの取得</strong></p>
<p>次に、提供機関IMFのデータセットIFSに、どのようなデータ系列が保存されているかをみます.このためには<code>rdb_series()</code>関数を利用します.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="マクロデータ.html#cb183-1" tabindex="-1"></a>    <span class="fu">rdb_series</span>(<span class="at">provider_code =</span> <span class="st">&quot;IMF&quot;</span>, <span class="at">dataset_code =</span> <span class="st">&quot;IFS&quot;</span>)</span></code></pre></div>
<p>以上の手順1 ~3は<a href="https://db.nomics.world">DBnomicsのホームページ</a>においても行うことができます.ホームページにおいて下の方にスクロールすると、[DBnomics providers]一覧が掲載されています.[IMF]International Monetary Fund選択すると、データセットの一覧を見ることができます.さらに、ここでデータセットInternational Financial statistics (IFS) [IMF/IFS]を選択すると、IFSが有するデータ系列を選択し、ダウンロードすることができるようになっています.</p>
<p>以上でDBnomicsの基本的な利用法の説明は終了です.続けていくつかの利用パタンを紹介しましょう。</p>
</div>
<div id="同一のデータセットから複数のデータ系列を取得する" class="section level4 hasAnchor" number="2.6.2.2">
<h4><span class="header-section-number">2.6.2.2</span> 同一のデータセットから複数のデータ系列を取得する<a href="マクロデータ.html#同一のデータセットから複数のデータ系列を取得する" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>次に、複数のデータ系列をダウンロードする方法を紹介しましょう.これは<code>c( )</code>を使い、その中にデータ系列名を並べて書くことで簡単にダウンロードできます.以下のスクリプトがその例です.ダウンロードした結果は、beds3cというオブジェクトに格納されています.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="マクロデータ.html#cb184-1" tabindex="-1"></a>  beds3c <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">&quot;WHO/WHS6/WHS6_102.DEU.A&quot;</span>, <span class="st">&quot;WHO/WHS6/WHS6_102.JPN.A&quot;</span>, <span class="st">&quot;WHO/WHS6/WHS6_102.USA.A&quot;</span>))</span></code></pre></div>
<p>ここでは、WHOのWorld Health Statistics[WHS6]からドイツ、日本およびアメリカの病床データ -―WHS6_102.DEU.A、WHS6_102.JPN.A、WHS6_102.USA.A ―-をダウンロードし、オブジェクトbeds3cに容れています.</p>
<p>beds3cのデータをもとに３カ国のプロットを描くと、ドイツの病床の水準は日本とアメリカの中間にあるようです.一般的に言われているように、日本の病床数は多く、アメリカの病床数は低い水準にあることが分かります.また、いずれの国も傾向的には病床数は減少しているようです.</p>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/beds_JPDEUUSA.png" alt="ドイツ,日本およびUSAにおける病床数" />
<div class="figcaption">ドイツ,日本およびUSAにおける病床数</div>
</div>
<p>このグラフは次のスクリプトによって描くことができます.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="マクロデータ.html#cb185-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> beds3c, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb185-2"><a href="マクロデータ.html#cb185-2" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb185-3"><a href="マクロデータ.html#cb185-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Country)<span class="sc">+</span></span>
<span id="cb185-4"><a href="マクロデータ.html#cb185-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb185-5"><a href="マクロデータ.html#cb185-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>このスクリプトでも、facet_wrap()関数を利用し、国別の複数のグラフを作成しています.facet_wrap()は使い方は次のようになります.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="マクロデータ.html#cb186-1" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(分類する基準となる変数))</span></code></pre></div>
<p>また、テーマはtheme_minimal()を利用し、シンプルなテーマを選択しています.表示文字のサイズはbase_size = を利用し、９ポイントに指定しています.</p>
<p>この例ではWHOのWorld Health Statistics[WHS6]というデータセットを利用しました.この他にWHOからは次の４つのデータセットが提供されています.International Health Regulations (2005) monitoring network, Sustainable development goals, Health workforceおよびRoad Safetyです。</p>
</div>
<div id="異なったデータセットから異なったデータ系列の取得" class="section level4 hasAnchor" number="2.6.2.3">
<h4><span class="header-section-number">2.6.2.3</span> 異なったデータセットから異なったデータ系列の取得<a href="マクロデータ.html#異なったデータセットから異なったデータ系列の取得" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>次に異なったデータセットから異なったデータ系列をダンロードしてみましょう.同じWHOの中にHealth workforce[WHO/HWV]というデータセットがあり、その中に「医師数（人口１万人あたり）」のデータが提供されています.病床数と一緒に、このデータも取得してみましょう.いずれも日本のデータです.この例では結果をbed_mdというオブジェクトに容れます.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="マクロデータ.html#cb187-1" tabindex="-1"></a>  beds_md <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">&quot;WHO/WHS6/WHS6_102.JPN.A&quot;</span>,<span class="st">&quot;WHO/HWF/HWF_0001.JPN.A&quot;</span>))</span></code></pre></div>
<p>names()関数を利用し、beds_mdが持つ変数一覧を表示させてみましょう.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="マクロデータ.html#cb188-1" tabindex="-1"></a>  <span class="fu">names</span>(beds_md)</span></code></pre></div>
<p>データフレームbeds_mdが25変数（列）を持っていることが分かります.変数（列）はDBnomicsでは統一されています、つまり病床数データと医師数データは同一の変数の中にあります（異なる場合、変数列が追加されます）.このため病床数データの行が終了すると、医師数データの行が追加されてます.</p>
<p>このためデータを処理するさい、INDICATORもしくはseries_code変数によって識別する必要があります.</p>
<p><strong>データフレーム名$変数名</strong>を使ってデータフレームの変数を指定し、INDICATORを表示させると、19行めまではWHS6_102ですが、20行めからはHWF_0001であることが分かります.つまり19行めまではベッド数データ、20行めからは医師数のデータであることが分かります.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="マクロデータ.html#cb189-1" tabindex="-1"></a>  beds_md<span class="sc">$</span>INDICATOR</span></code></pre></div>
<p>次に、このデータを使って医師数とベッド数の推移のグラフを描いていみましょう.</p>
<p>最初に、このINDICATORをもとにベッド数と医師数データをそれぞれ別のデータフレーム―beds_jpn, doctor_jpn―に容れます.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="マクロデータ.html#cb190-1" tabindex="-1"></a>  beds_jpn <span class="ot">&lt;-</span> beds_md <span class="sc">%&gt;%</span> <span class="fu">filter</span>(INDICATOR <span class="sc">==</span> <span class="st">&quot;WHS6_102&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="マクロデータ.html#cb191-1" tabindex="-1"></a>  doctor_jpn <span class="ot">&lt;-</span> beds_md <span class="sc">%&gt;%</span> <span class="fu">filter</span>(INDICATOR <span class="sc">==</span> <span class="st">&quot;HWF_0001&quot;</span>)</span></code></pre></div>
<p>いずれもfilter()関数を使ってベッド数のデータの入っている行（もしくは医師数のデータの入っている行）を抽出しています.なお、filter()関数の書き方は</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="マクロデータ.html#cb192-1" tabindex="-1"></a>  <span class="fu">filter</span>(データフレーム名、抽出条件)</span></code></pre></div>
<p>です.ただし、この例ではパイプ%&gt;%で連結していますので、データフレーム名は省略しています。抽
出条件は<code>INDICATOR == "WHS6_102"</code>です。こ
れはINDICATOR変数が文字列”WHS6_102”に等しい行だけを抽出しなさいということを意味します。</p>
<p>最後に、抽出した結果つまりデータフレームを<code>ggplot()</code>に渡します。そ
してggplot2を使って描いたグラフをオブジェクトbeds_figに容れます。</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="マクロデータ.html#cb193-1" tabindex="-1"></a>beds_fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> beds_jpn, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> original_period, <span class="at">y =</span> value, <span class="at">group =</span> INDICATOR)) <span class="sc">+</span></span>
<span id="cb193-2"><a href="マクロデータ.html#cb193-2" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb193-3"><a href="マクロデータ.html#cb193-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb193-4"><a href="マクロデータ.html#cb193-4" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Hospital beds (per 10 000 population)&quot;</span>,</span>
<span id="cb193-5"><a href="マクロデータ.html#cb193-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb193-6"><a href="マクロデータ.html#cb193-6" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb193-7"><a href="マクロデータ.html#cb193-7" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2019</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb193-8"><a href="マクロデータ.html#cb193-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>beds_figの作成にあたっては<strong>scale_x_discrete()</strong>を利用し、x軸のラベルを変更しています.x軸の変数’orignal_period’は見た目では連続変数ですが、じっさいには文字列変数です.データフレームbeds_jpnの中のoriginal_period変数にclass()を適用すると、</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="マクロデータ.html#cb194-1" tabindex="-1"></a><span class="fu">class</span>(beds_jpn<span class="sc">$</span>original_period)</span></code></pre></div>
<p>’orignal_period’変数が文字列であることが分かります。変
数の型を変換しても良いのですが、ここではそのまま文字列として扱い、x軸のラベルを変更します。こ
のためにscale_x_discrete()を利用します.
discreteは離散変数を意味し、x軸を離散変数として扱うことを示しています.
引数<strong>breaks =</strong>によってラベルの表示範囲を指定します.
<strong>seq(2000, 2019, 5)</strong>は開始年を2000年とし、最後の年を2019とし、5年おきにラベルをつけるということを指示しています.</p>
<p>さらに、<strong>annotate()</strong>関数を使い、注釈をグラフに入れてあります.annotate(“text”, x = 12, y = 145, label = ““)が示しているように、annotate()関数を使ってテキスト注釈を挿入する場合は、”text”,そしてテキストの位置をx軸とy軸の座標で指定します。そ
の上で挿入する注釈を<code>label = ""</code>に記入します。</p>
<p>同様に、医師数データを表示するスクリプトは次のようになります</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="マクロデータ.html#cb195-1" tabindex="-1"></a>  doctor_fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> doctor_jpn, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> original_period, <span class="at">y =</span> value, <span class="at">group =</span> INDICATOR))<span class="sc">+</span></span>
<span id="cb195-2"><a href="マクロデータ.html#cb195-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb195-3"><a href="マクロデータ.html#cb195-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb195-4"><a href="マクロデータ.html#cb195-4" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Medical doctors (per 10,000)&quot;</span>,</span>
<span id="cb195-5"><a href="マクロデータ.html#cb195-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb195-6"><a href="マクロデータ.html#cb195-6" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb195-7"><a href="マクロデータ.html#cb195-7" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2019</span>, <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb195-8"><a href="マクロデータ.html#cb195-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>以上の2つのグラフ – beds_figとdoctor_fig – を表示させますが、そのさい、グラフのレイアウトを調整するRパッケージ’patchwork’を使い、2つのグラフを縦に並べています.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="マクロデータ.html#cb196-1" tabindex="-1"></a> beds_fig<span class="sc">/</span>doctor_fig</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/beds_doctors.png" alt="日本における病床数と医師数" />
<div class="figcaption">日本における病床数と医師数</div>
</div>
</div>
<div id="異なったデータ提供機関および異なったデータセットからデータ系列を取得する" class="section level4 hasAnchor" number="2.6.2.4">
<h4><span class="header-section-number">2.6.2.4</span> 異なったデータ提供機関および異なったデータセットからデータ系列を取得する<a href="マクロデータ.html#異なったデータ提供機関および異なったデータセットからデータ系列を取得する" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>これまではWHOという同一の機関からデータを取得してきましたが、最後に、異なった機関からのデータを取得する方法を紹介しておきましょう.</p>
<p>たとえば、アメリカにおける2000年台以降の失業率と自殺率の関連を知りたいとします.このためにWDIからは自殺率、ILOから失業率をダウンロードするとします.各種の機関・組織からデータを収集しているDBnomicsではデータベース横断的なデータの取得がとても簡単です.上で紹介した方法と同様に、<code>rdb()</code>関数を利用し、引数<code>ids =</code>にWDIとILOのデータを指定するだけです.</p>
<p>WDIの提供するアメリカの自殺率データのDBnomics形式の指標名は次のとおりです.ここでは性別の２種類のデータが指定されています.<strong>“WB/WDI/SH.STA.SUIC.MA.P5-US”</strong>と<strong>“WB/WDI/SH.STA.SUIC.FE.P5-US”</strong>です.</p>
<p>ダウンロードには上述のように<code>rdb(ids = "")</code>を利用します.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="マクロデータ.html#cb197-1" tabindex="-1"></a>suicide <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">&quot;WB/WDI/SH.STA.SUIC.MA.P5-US&quot;</span>,<span class="st">&quot;WB/WDI/SH.STA.SUIC.FE.P5-US&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="マクロデータ.html#cb198-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> suicide, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.integer</span>(original_period), <span class="at">y =</span> value,<span class="at">group =</span> series_name ))<span class="sc">+</span></span>
<span id="cb198-2"><a href="マクロデータ.html#cb198-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> series_name))<span class="sc">+</span></span>
<span id="cb198-3"><a href="マクロデータ.html#cb198-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb198-4"><a href="マクロデータ.html#cb198-4" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Suicide mortality rate (per 100,000 female population)&quot;</span>,</span>
<span id="cb198-5"><a href="マクロデータ.html#cb198-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb198-6"><a href="マクロデータ.html#cb198-6" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb198-7"><a href="マクロデータ.html#cb198-7" tabindex="-1"></a>  <span class="fu">scale_color_hue</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>))<span class="sc">+</span></span>
<span id="cb198-8"><a href="マクロデータ.html#cb198-8" tabindex="-1"></a>  <span class="fu">xlim</span> (<span class="dv">2000</span>,<span class="dv">2020</span>)<span class="sc">+</span></span>
<span id="cb198-9"><a href="マクロデータ.html#cb198-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p>このグラフは自殺率データをもとに描いたグラフです.グラフのx軸にはoriginal_period変数が利用されています.この変数original_periodは文字列型です.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="マクロデータ.html#cb199-1" tabindex="-1"></a>  <span class="fu">class</span>(suicide<span class="sc">$</span>original_period)</span></code></pre></div>
<p>グラフのx軸にするにはこのデータ型は扱いづらいのでグラフ作成にあたっては<em>as.integer()</em>関数によって整数型に変化しています.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="マクロデータ.html#cb200-1" tabindex="-1"></a> <span class="fu">class</span>(<span class="fu">as.integer</span>(suicide<span class="sc">$</span>original_period))</span></code></pre></div>
<p>ケース・ディートン著『絶望死のアメリカ―資本主義がめざすべきもの』は、おもにアメリカ疾病予防管理センター（CDC）のデータをもとに1990年台から低学歴白人アメリカ人中年男性の自殺率だけが急増している事実を報告しています.グラフは学歴別ではありませんが、男性の自殺率が、女性に比べ、高い水準にあり、とりわけリーマンショック後に急増していることが伺えます.</p>
<p>また、失業率データは45-54歳年齢の男性データを利用します.これは学歴別の失業率データです.</p>
<ul>
<li>“ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_3.SEX_M.A”</li>
<li>“ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_6.SEX_M.A”</li>
</ul>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="マクロデータ.html#cb201-1" tabindex="-1"></a>  unemp <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span><span class="fu">c</span>( <span class="st">&quot;ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_3.SEX_M.A&quot;</span>,<span class="st">&quot;ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_6.SEX_M.A&quot;</span>))</span></code></pre></div>
<p>学歴別の中年(45-54歳)男性の失業率の推移を見てみましょう.期待どおりですが、低学歴グループが高い失業率を示しています.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="マクロデータ.html#cb202-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> unemp, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> original_period, <span class="at">y =</span> value,<span class="at">group =</span> classif2))<span class="sc">+</span></span>
<span id="cb202-2"><a href="マクロデータ.html#cb202-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> classif2))<span class="sc">+</span></span>
<span id="cb202-3"><a href="マクロデータ.html#cb202-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb202-4"><a href="マクロデータ.html#cb202-4" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Male unemployment rate, by education level&quot;</span>,</span>
<span id="cb202-5"><a href="マクロデータ.html#cb202-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb202-6"><a href="マクロデータ.html#cb202-6" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb202-7"><a href="マクロデータ.html#cb202-7" tabindex="-1"></a>  <span class="fu">scale_color_hue</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Upper secondary </span><span class="sc">\n</span><span class="st">education&quot;</span>, <span class="st">&quot;Bachelor&#39;s </span><span class="sc">\n</span><span class="st">or equivalent level&quot;</span>))<span class="sc">+</span></span>
<span id="cb202-8"><a href="マクロデータ.html#cb202-8" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2019</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb202-9"><a href="マクロデータ.html#cb202-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/unemp_by_ed.png" alt="学歴別失業率" />
<div class="figcaption">学歴別失業率</div>
</div>
<p>グラフから理解されるように、あきらかに低学歴グループの失業率が、学士卒のグループよりも高いことが分かります.つまり、このデータは労働市場のショックが不均等に低学歴グループに影響を与えることを示しています.</p>
<p>最後に、こうした低学歴失業率と自殺率の単純な相関を観察してみます.このために次の4つの手順を踏みます.</p>
<ol style="list-style-type: decimal">
<li>自殺率データから男性の自殺率だけを抽出する</li>
<li>失業率のデータから低学歴男性の失業率を抽出する</li>
<li>上の２つのデータを結合する</li>
<li>必要な変数のみ取り出し、ggplot2によって散布図を描く</li>
</ol>
<p><strong>1. 自殺率データから男性の自殺率だけを抽出する</strong></p>
<p>データフレームsuicideにfilter()関数を適用し、series_code が “WB/WDI/SH.STA.SUIC.MA.P5-US” に一致する行を取り出します.そしてその結果をsuicide_maleという名前のオブジェクトに容れます.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="マクロデータ.html#cb203-1" tabindex="-1"></a>suicide_male <span class="ot">&lt;-</span> suicide <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="マクロデータ.html#cb203-2" tabindex="-1"></a>  <span class="fu">filter</span>(series_code <span class="sc">==</span> <span class="st">&quot;WB/WDI/SH.STA.SUIC.MA.P5-US&quot;</span> )</span></code></pre></div>
<p><strong>2. 失業率のデータから低学歴男性の失業率を抽出する</strong></p>
<p>　　同様に、filter()関数を使い、データフレームsuicideから低学歴中年男性の失業率を抽出します.具体的には、classif2が”EDU_ISCED11_3”に一致する行を取り出します.ここでは抽出された結果はunemp_low_edというオブジェクトに容れます.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="マクロデータ.html#cb204-1" tabindex="-1"></a>   unemp_low_ed <span class="ot">&lt;-</span> unemp <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="マクロデータ.html#cb204-2" tabindex="-1"></a>  <span class="fu">filter</span>( classif2 <span class="sc">==</span> <span class="st">&quot;EDU_ISCED11_3&quot;</span>)</span></code></pre></div>
<p><strong>3. 上の２つのデータを結合する</strong></p>
<p>　上で抽出した２つのデータフレームを結合します.このためにはinner_join()関数を利用します.たとえば、A,Bという２つのデータフレームを結合するとします.この場合、inner_join()は次のように書きます.
　</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="マクロデータ.html#cb205-1" tabindex="-1"></a><span class="fu">inner_join</span>(データフレームA、データフレームB, <span class="at">by =</span> <span class="st">&quot;結合の基準となる変数名&quot;</span>)</span></code></pre></div>
<p>それではこの関数を使い、２つのデータフレーム — suicide_maleとunemp_low_ed — を結合します.結合にあたっての共通の変数は<strong>original_period</strong>になります.結合されたデータフレームは<strong>suicide_unemployment</strong>というオブジェクトに容れます.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="マクロデータ.html#cb206-1" tabindex="-1"></a>suicide_unemployment <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(suicide_male,unemp_low_ed,<span class="at">by =</span> <span class="st">&quot;original_period&quot;</span>)</span></code></pre></div>
<p><strong>4　必要な変数のみ取り出し、ggplot2によって散布図を描く</strong></p>
<p>次に、select()関数を利用し、必要な変数を取り出します.その際、変数名も変更しておきます.select()関数は引数に抽出する変数名を入力するだけですが、変数名を変更する場合は<code>新しい変数名 = 古い変数名</code>と入力します.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="マクロデータ.html#cb207-1" tabindex="-1"></a>su <span class="ot">&lt;-</span> suicide_unemployment <span class="sc">%&gt;%</span> </span>
<span id="cb207-2"><a href="マクロデータ.html#cb207-2" tabindex="-1"></a>  <span class="fu">select</span>(original_period,<span class="at">suicide_rate =</span> value.x, <span class="at">unemp_rate =</span> value.y)</span></code></pre></div>
<p>この例では結果を<code>su</code>というオブジェクトに格納しています.このデータフレームを利用し、最後に、ggplot2で自殺率と失業率の散布図を描くとします.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="マクロデータ.html#cb208-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> su, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> unemp_rate, <span class="at">y =</span> suicide_rate))<span class="sc">+</span></span>
<span id="cb208-2"><a href="マクロデータ.html#cb208-2" tabindex="-1"></a></span>
<span id="cb208-3"><a href="マクロデータ.html#cb208-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> su, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> unemp_rate, <span class="at">y =</span> suicide_rate))<span class="sc">+</span></span>
<span id="cb208-4"><a href="マクロデータ.html#cb208-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb208-5"><a href="マクロデータ.html#cb208-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>,<span class="at">size =</span> <span class="dv">1</span>,<span class="at">color =</span> <span class="st">&quot;gray&quot;</span>)<span class="sc">+</span></span>
<span id="cb208-6"><a href="マクロデータ.html#cb208-6" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb208-7"><a href="マクロデータ.html#cb208-7" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb208-8"><a href="マクロデータ.html#cb208-8" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb208-9"><a href="マクロデータ.html#cb208-9" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb208-10"><a href="マクロデータ.html#cb208-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb208-11"><a href="マクロデータ.html#cb208-11" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Male unemployment rate (45-54), </span><span class="sc">\n</span><span class="st">upper secondary education &quot;</span>, <span class="at">y =</span> <span class="st">&quot;Male suicide mortality rate </span><span class="sc">\n</span><span class="st">(per 100,000)&quot;</span></span>
<span id="cb208-12"><a href="マクロデータ.html#cb208-12" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb208-13"><a href="マクロデータ.html#cb208-13" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span></code></pre></div>
<div class="float">
<img src="/Users/office1/Library/Mobile%20Documents/com~apple~CloudDocs/3_Ongoing/EconData/EconData/figures/suicide_unemp.png" alt="男性自殺率vs.低学歴中年労働者失業率" />
<div class="figcaption">男性自殺率vs.低学歴中年労働者失業率</div>
</div>
<p>グラフ作成にあたって利用されたデータがそれほど適切なものではないため、とくに男性失業率の年齢階層別データを利用していないために、失業率と自殺率の間に何らかの関連を見出すことはできませんでした。</p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>詳細については，<a href="http://www.ggdc.net/pwt/" class="uri">http://www.ggdc.net/pwt/</a> で提供されている Feenstra, Inklaar, and Timmer (2016, 2015) を参照してください．<a href="マクロデータ.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Rにはdiff()という差分をとる関数がありますが，diff()は差分計算できない最初の値を除いた値を返すため，mutate()で変数を追加しようとすると，エラーになります．<a href="マクロデータ.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>スティーグ・ラーソン著『ミレニアム』（早川文庫）シリーズの主人公.<a href="マクロデータ.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>ヴァルランダーシリーズ,ヘニング・マンケル著『リガの犬たち』（創元社）.<a href="マクロデータ.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rstudioのproject管理とさまざまなデータ形式の読み込み方法.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="民主主義国家データ.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["EconData.pdf", "EconData.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
