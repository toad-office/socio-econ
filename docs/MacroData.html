<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-05-24">

<title>R &amp; Socio Econ</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R &amp; Socio Econ</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Rで社会経済データの取得[^index-1] (Work in progress)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./introduction.html"> 
<span class="menu-text">1. RStudioを使う</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./MacroData.html" aria-current="page"> 
<span class="menu-text">2. マクロ・データ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./micro.html"> 
<span class="menu-text">3 ミクロ・データ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DemState.html"> 
<span class="menu-text">4 民主主義・国家データ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./industry.html"> 
<span class="menu-text">5 産業データ</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#マクロデータ" id="toc-マクロデータ" class="nav-link active" data-scroll-target="#マクロデータ">2. マクロ・データ</a></li>
  <li><a href="#groningen-growth-and-development-centre" id="toc-groningen-growth-and-development-centre" class="nav-link" data-scroll-target="#groningen-growth-and-development-centre">2.1 Groningen Growth and Development Centre</a>
  <ul class="collapse">
  <li><a href="#penn-world-table-pwt10" id="toc-penn-world-table-pwt10" class="nav-link" data-scroll-target="#penn-world-table-pwt10">2.1.1 Penn World Table ― pwt10</a></li>
  <li><a href="#the-maddison-project-database-maddison" id="toc-the-maddison-project-database-maddison" class="nav-link" data-scroll-target="#the-maddison-project-database-maddison">2.1.2 The Maddison Project Database ― maddison</a></li>
  </ul></li>
  <li><a href="#世界銀行world-bank-wdi" id="toc-世界銀行world-bank-wdi" class="nav-link" data-scroll-target="#世界銀行world-bank-wdi">2.2 世界銀行World Bank ― WDI</a>
  <ul class="collapse">
  <li><a href="#インストール方法" id="toc-インストール方法" class="nav-link" data-scroll-target="#インストール方法">2.2.1 インストール方法</a></li>
  <li><a href="#データを探す--wdisearch" id="toc-データを探す--wdisearch" class="nav-link" data-scroll-target="#データを探す--wdisearch">2.2.2 データを探す- WDISearch()</a></li>
  <li><a href="#データをダウンロードする--wdi" id="toc-データをダウンロードする--wdi" class="nav-link" data-scroll-target="#データをダウンロードする--wdi">2.2.3 データをダウンロードする- WDI()</a></li>
  </ul></li>
  <li><a href="#eu統計局eurostat---eurostat" id="toc-eu統計局eurostat---eurostat" class="nav-link" data-scroll-target="#eu統計局eurostat---eurostat">2.3 EU統計局Eurostat - eurostat</a>
  <ul class="collapse">
  <li><a href="#rパッケージeurostatの利用法" id="toc-rパッケージeurostatの利用法" class="nav-link" data-scroll-target="#rパッケージeurostatの利用法">2.3.1 Rパッケージeurostatの利用法</a></li>
  <li><a href="#eurostatの応用例-地理空間情報の利用" id="toc-eurostatの応用例-地理空間情報の利用" class="nav-link" data-scroll-target="#eurostatの応用例-地理空間情報の利用">2.3.2 Eurostatの応用例 ― 地理空間情報の利用</a></li>
  </ul></li>
  <li><a href="#european-commision-annual-macro-eocnomicデータベースameco---ameco" id="toc-european-commision-annual-macro-eocnomicデータベースameco---ameco" class="nav-link" data-scroll-target="#european-commision-annual-macro-eocnomicデータベースameco---ameco"><strong>2.4 European Commision Annual macro-eocnomicデータベース(AMECO) - ameco</strong></a>
  <ul class="collapse">
  <li><a href="#amecoのインストールと読み込み" id="toc-amecoのインストールと読み込み" class="nav-link" data-scroll-target="#amecoのインストールと読み込み">2.4.1 amecoのインストールと読み込み</a></li>
  </ul></li>
  <li><a href="#経済協力開発機構---oecd" id="toc-経済協力開発機構---oecd" class="nav-link" data-scroll-target="#経済協力開発機構---oecd">2.5 経済協力開発機構 - OECD</a>
  <ul class="collapse">
  <li><a href="#rパッケージoecdの利用方法" id="toc-rパッケージoecdの利用方法" class="nav-link" data-scroll-target="#rパッケージoecdの利用方法">2.5.1 RパッケージOECDの利用方法</a></li>
  </ul></li>
  <li><a href="#金融データを取得する-imf" id="toc-金融データを取得する-imf" class="nav-link" data-scroll-target="#金融データを取得する-imf">2.6 金融データを取得する ― IMF</a>
  <ul class="collapse">
  <li><a href="#国際通貨基金imf---imfr" id="toc-国際通貨基金imf---imfr" class="nav-link" data-scroll-target="#国際通貨基金imf---imfr">2.6.1 国際通貨基金(IMF) - imfr</a></li>
  <li><a href="#imfrの利用方法" id="toc-imfrの利用方法" class="nav-link" data-scroll-target="#imfrの利用方法">2.6.2 imfrの利用方法</a></li>
  </ul></li>
  <li><a href="#iloデータベース---riolstat" id="toc-iloデータベース---riolstat" class="nav-link" data-scroll-target="#iloデータベース---riolstat">2.7 ILOデータベース - Riolstat</a>
  <ul class="collapse">
  <li><a href="#データを探す" id="toc-データを探す" class="nav-link" data-scroll-target="#データを探す">2.7.1　データを探す</a></li>
  <li><a href="#データをダウンロードする" id="toc-データをダウンロードする" class="nav-link" data-scroll-target="#データをダウンロードする">2.7.2 データをダウンロードする</a></li>
  </ul></li>
  <li><a href="#オープンデータポータル---dbnomics" id="toc-オープンデータポータル---dbnomics" class="nav-link" data-scroll-target="#オープンデータポータル---dbnomics">2.8 オープンデータポータル - DBnomics</a>
  <ul class="collapse">
  <li><a href="#rパッケージ---rdbnomics" id="toc-rパッケージ---rdbnomics" class="nav-link" data-scroll-target="#rパッケージ---rdbnomics">2.6.1 Rパッケージ - rdbnomics</a></li>
  <li><a href="#rdbnomicsの利用方法" id="toc-rdbnomicsの利用方法" class="nav-link" data-scroll-target="#rdbnomicsの利用方法">2.6.2 rdbnomicsの利用方法</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 24, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="マクロデータ" class="level2">
<h2 class="anchored" data-anchor-id="マクロデータ">2. マクロ・データ</h2>
<p>今では国際機関，政府,研究組織によって多くのデータが提供されています。そ うしたデータを取得するには，その機関・組織のサイトにアクセスし，csv,EXCEL等のファイルを直接ダウンロードすることによっても，もちろん可能です。し かし，すでに述べたように，Rには，国際機関，研究組織等の提供するデータベースからデータを取得するパッケージが多く開発されています。そうしたパッケージを利用すれば，シームレスかつ再現可能な形でのデータの読み込みが可能となります。本資料では最初に，以下のマクロ経済統計データベースをとりあげます．</p>
<table class="table">
<colgroup>
<col style="width: 38%">
<col style="width: 36%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>DB提供機関</th>
<th>マクロデータ概要</th>
<th>対応する節</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>フローニンゲン大学成長・発展センター</td>
<td>所得，経済発展データ等</td>
<td>2.1</td>
</tr>
<tr class="even">
<td>世界銀行</td>
<td>世界開発指標</td>
<td>2.2</td>
</tr>
<tr class="odd">
<td>EU統計局</td>
<td>EUデータ（人口，経済，インフラ等）</td>
<td>2.3</td>
</tr>
<tr class="even">
<td>European Commission’s Directorate General for Economic and Financial Affairs</td>
<td>AMECO マクロ経済データ</td>
<td>2.4</td>
</tr>
<tr class="odd">
<td>OECD</td>
<td>OECDデータ</td>
<td>2.5</td>
</tr>
<tr class="even">
<td>IMF</td>
<td>国際金融等のデータ</td>
<td>2.6</td>
</tr>
<tr class="odd">
<td>ILO</td>
<td>労働統計</td>
<td>2.7</td>
</tr>
<tr class="even">
<td>DBnomics</td>
<td>データベース集</td>
<td>2.8</td>
</tr>
</tbody>
</table>
</section>
<section id="groningen-growth-and-development-centre" class="level2">
<h2 class="anchored" data-anchor-id="groningen-growth-and-development-centre">2.1 Groningen Growth and Development Centre</h2>
<p>1992年にフローニンゲン大学の経済学部内に設立された<a href="https://www.rug.nl/ggdc/?lang=en">Groningen Growth and Development Centre（GGDC）</a>は,現在ではグローバリゼーション、テクノロジー、制度的変化の相互作用と、それが長期的な経済成長、構造変化、生産性、不平等に与える影響を研究する研究センターとなっています。同センターは次のようなデータベースを公開しています。</p>
<table class="table">
<colgroup>
<col style="width: 37%">
<col style="width: 37%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>データベース名</th>
<th>提供データ</th>
<th>Rパッケージ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Penn World Table</td>
<td>所得，産出高，投入および生産性</td>
<td>pwt10.0</td>
</tr>
<tr class="even">
<td>10 Sector Database</td>
<td>セクター別産出，投入，生産性</td>
<td></td>
</tr>
<tr class="odd">
<td>World Input-Output Database</td>
<td>グローバル・バリューチェーン</td>
<td></td>
</tr>
<tr class="even">
<td>The Maddison Project Database</td>
<td>歴史的発展</td>
<td>maddison</td>
</tr>
</tbody>
</table>
<p>このうちRパッケージが開発されている２つのデータベース-Penn World TableとThe Maddison Project Database-を紹介しましょう。</p>
<section id="penn-world-table-pwt10" class="level3">
<h3 class="anchored" data-anchor-id="penn-world-table-pwt10">2.1.1 Penn World Table ― pwt10</h3>
<p><a href="https://www.rug.nl/ggdc/productivity/pwt/?lang=en">Penn World Table</a>は経済研究においてもっとも頻繁に利用されているデータベースの１つと言えるでしょう。これは所得，産出高，投入および生産性に関する情報を提供するデータベースです。1950年から2017年の182ヵ国をカバーしています（基準年は2011年）<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。 pwt10.01はデータパッケージです。country（国名），isocode（3桁の国コード）, year（年）, currency（各国の通貨単位）の変数の他に，rgdpe（支出面の実質GDP），rgdpo（生産面の実質GDP）,hc(1人あたり人的資本指数)などを含む48の時系列データが提供されています。それではinstall.packages()を使ってRにインストールしましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rパッケージpwtのインストール</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"pwt10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rパッケージptw10はデータだけのパッケージです。library()，data()関数で読み込みます。ス クリプトに次のように入力し，[Run]をクリックしてください。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pwt10の読み込み</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pwt10)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data</span>(<span class="st">"pwt10.01"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pwt10.1のデータを表示させる</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    pwt10<span class="fl">.01</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pwtデータの変数名を表示させる</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glimpse</span>(pwt10<span class="fl">.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>データ自体は更新され，現在，バージョン10.01となっています。glimplse(pwt10.01)を実行することにより，12,810の観察値×52の変数のデータが確認されます。データセットの最終数行を表示させるtail()関数を使ってこのデータセットの最後の部分を見てみましょう。ちなみにtail()関数と反対の結果を出力するのがhead()関数です。head()関数はデータフレームの冒頭部分を表示させます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">tail</span>(pwt10<span class="fl">.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/tail(pwt10.01).png" class="img-fluid"></p>
<p>ここでpwt10データを使ってジンバブエ経済を観察してみましょう。そ のためにジンバブエ経済だけ取り出し，zweというオブジェクトに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ジンバブエデータを取り出す。</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> pwt10<span class="fl">.01</span> <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(isocode <span class="sc">==</span> <span class="st">"ZWE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ここではfilter()関数を利用し、isocodeが”ZWE”に一致する行だけを抽出しています。つまりジンバブエの行を取り出しています。filter()関数の使い方はすでに説明したように次のようになります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(データフレーム名, 抽出条件)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ジンバブエデータの取り出しには，パイプ(|&gt;)をつかって”pwt10.01”をfilter()関数に渡しています。こ のためデータフレーム名が省略されています。</p>
<p>ジンバブエのマクロ状態―GDP，雇用，価格の成長率・上昇率―をグラフにし観察してみましょう。そ れぞれの変数名はrgdpe（実質GDP）, emp（就業者数）, pl_c（家計消費の価格水準）です。グラフ作成までの手順は次のようになります．</p>
<ol type="1">
<li><p>３つの変数の時系列的推移を描くために，zweからこの３つの変数とyear変数を取り出します．</p></li>
<li><p>３つの変数を成長率に変換します．</p></li>
<li><p>最後に，３つの変数を表示するグラフを作成します．</p></li>
</ol>
<p><strong>手順1：特定の変数(列)の取出し – select()関数</strong></p>
<p>select()関数を使ってyearと３つの変数―rgdpe（実質GDP）,emp（就業者数）,pl_c（家計消費の価格水準）―を抽出します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> zwe <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(year, rgdpe, emp, pl_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>手順2：成長率の計算</strong></p>
<p>成長率の計算にあたっては対数差分を利用します。変 数を対数に変換するにはlog()を使います。た とえば，log(rgdpe)と入力し，実行すれば（[Run]をクリックすると），Rはrgdpeの対数を返します。さ らに，１期前の対数の値との差をとる必要があります。１期前に変換するためにlag()関数 を利用します。 lag(rgdpe)で１期前の実質GDPの値を指定できます。以上を利用すると，対数差分の計算式は以下のように表現されます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 成長率の計算</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(rgdpe) <span class="sc">-</span> <span class="fu">log</span>(<span class="fu">lag</span>(rgdpe))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この計算式を利用し，<strong>mutate()</strong>関数を使って成長率変数を作成します．mutate()は既存の変数（列）に関数を適用し，新たな変数を作成する関数です。新 たな変数の名前はこの例では既存の変数の冒頭にg_をつけたものにしています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> zwe <span class="sc">|&gt;</span>  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_rgdpe =</span> <span class="fu">log</span>(rgdpe) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(rgdpe)),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">g_emp =</span> <span class="fu">log</span>(emp) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(emp)),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">g_pl_c =</span>  <span class="fu">log</span>(pl_c) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(pl_c))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上をまとめてスクリプトに書くとつぎのようになります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>zwe <span class="ot">&lt;-</span> pwt10 <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(isocode <span class="sc">==</span> <span class="st">"ZWE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, rgdpe, emp, pl_c)  <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_rgdpe =</span> <span class="fu">log</span>(rgdpe) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(rgdpe)),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">g_emp =</span> <span class="fu">log</span>(emp) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(emp)),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">g_pl_c =</span>  <span class="fu">log</span>(pl_c) <span class="sc">-</span><span class="fu">log</span>(<span class="fu">lag</span>(pl_c))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これを実行すると，３つの変数とその成長率変数をもつジンバブエデータが作成されます。V iew()関数で確認してみてください。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(zwe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>手順3：グラフの作成 - ggplot2</strong></p>
<p>グラフの作成にはggplot2パッケージを利用します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GDP成長率のグラフ作成</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>zwe_growth <span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> zwe) <span class="sc">+</span>           </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span>year, <span class="at">y =</span> g_rgdpe))<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> g_rgdpe))<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"year"</span>, <span class="at">y=</span> <span class="st">"Growth rate"</span>)<span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ここではGDP成長率のグラフを作成し，グラフをzwe_growthと名前をつけたオブジェクトに容れています。ちなみに，コンソール画面にzwe_growthと入力してみてください。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>zwe_growth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>次のようなジンバブエの対前年比GDP成長率が表示されるはずです。</p>
<p><img src="figs/zwe_growth.png" class="img-fluid"></p>
<p>同じようして，インフレ率と雇用成長率のグラフを作成してみましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># インフレ（価格上昇率）のグラフ作成</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>zwe_inflation <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> zwe) <span class="sc">+</span>　</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> g_pl_c))<span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> g_pl_c))<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"year"</span>,<span class="at">y=</span><span class="st">"Inflation"</span>)<span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 雇用成長率のグラフ作成</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>zwe_emp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> zwe) <span class="sc">+</span>        </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> g_emp))<span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> g_emp),<span class="at">lty=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"year"</span>,<span class="at">y=</span><span class="st">"Employment"</span>)<span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>patchworkパッケージはグラフのレイアウトを操作します。操作対象の図を足し算記号（＋）や割り算記号（/）等を使って配置します。詳 細について<a href="https://cran.r-project.org/web/packages/patchwork/vignettes/patchwork.html">patchworkパッケージサイト</a>を参照してください。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"patchwork"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>library(patchwork)</code>で呼び出したのちに，次のように入力することで3つのグラフを縦に配置します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> zwe_growth<span class="sc">/</span>zwe_inflation<span class="sc">/</span>zwe_emp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/patchwork_zwe.png" class="img-fluid"></p>
</section>
<section id="the-maddison-project-database-maddison" class="level3">
<h3 class="anchored" data-anchor-id="the-maddison-project-database-maddison">2.1.2 The Maddison Project Database ― maddison</h3>
<p>Maddisonプロジェクトは，世界のあらゆる地域の長期的な経済パフォーマンスを初めて定量化した故Angus Maddisonの業績を引き継ぐものです。Maddisonは世界のすべての地域の長期的な経済パフォーマンスを、一貫した枠組みで定量化した著名な経済学者です。</p>
<p>Maddison Project Databaseはローマ時代から現在までの世界の国々の所得の推定値を提供しています。このデータベースのおかげで成長のダイナミクスや長期的な経済成長の要因を調べることができます。</p>
<section id="maddisonのインストール" class="level5">
<h5 class="anchored" data-anchor-id="maddisonのインストール">2.1.2.0.1 maddisonのインストール</h5>
<p>次のように入力し、<code>maddison</code>をインストールし、library()でロードします。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># maddisonのインストール</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"maddison"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># maddisonの呼び出し</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(maddison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このパッケージは1人あたりGDPとともにマディソンプロジェクトのデータを含むデータパッケージです。str()でデータフレームの内容をみると,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(maddison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>19,873の行（観察値）と12列（変数）を持つことが分かります。主要な変数は次のとおりです。</p>
<table class="table">
<thead>
<tr class="header">
<th>変数</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gdp_pc</td>
<td>１人あたり実質GDP</td>
</tr>
<tr class="even">
<td>iso3c</td>
<td>国コード</td>
</tr>
<tr class="odd">
<td>continent</td>
<td>大陸別</td>
</tr>
</tbody>
</table>
<p>Maddisonの1人あたり実質GDPをもとに主要経済の長期歴史的推移を確認してみましょう。データフレームmaddisonからfilter()を使ってサンプル国5カ国を取り出します。またデータは17世紀以降にしています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sample5c <span class="ot">&lt;-</span> maddison <span class="sc">|&gt;</span>  </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(iso3c <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FRA"</span>,<span class="st">"JPN"</span>,<span class="st">"GBR"</span>,<span class="st">"DEU"</span>,<span class="st">"USA"</span>), year <span class="sc">&gt;</span> <span class="dv">1800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>取り出した日本、アメリカ、イギリス、ドイツおよびフランスの長期的な成長率をグラフにしてみましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sample5c, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> gdp_pc, <span class="at">group =</span> country))<span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"GDP per capita"</span>)<span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/maddison_5c.png" class="img-fluid"></p>
<p>推移を見ると、私たちの生活が豊かになり始めたのが20世紀に入ってからだということ,とくに第２次大戦以後だということが分かります。データが得られる範囲内では、それまでのおよそ2世紀にわたり持続的な成長は観察されません。</p>
</section>
</section>
</section>
<section id="世界銀行world-bank-wdi" class="level2">
<h2 class="anchored" data-anchor-id="世界銀行world-bank-wdi">2.2 世界銀行World Bank ― WDI</h2>
<p>世界銀行が提供する<strong>世界開発指標WDI（World Development Indicators）</strong>は,グローバルな開発状況と貧困について国際的に比較可能な統計をまとめたものです。こ のデータベースには，217の経済と40以上の国グループの1,600の時系列指標が収録されています。ま たその多くの指標のデータは50年以上前までさかのぼることができます。</p>
<p>WDIデータは，さまざまな方法で取得できるようにされています。詳 しくは<a href="http://datatopics.worldbank.org/world-development-indicators/">世銀ホームページ</a>を参照してください。フ ァイルが大きいためダウンロードに多少時間がかかりますが，すべてのデータ（ExcelおよびCSV形式ファイル）をまとめてダウンロードすることも可能です。</p>
<p>このWDIデータを利用するためのRパッケージWDIが開発されています 。これ以外にも<a href="https://github.com/gshs-ornl/wbstats">wbstats</a>というパッケージもありますが，ここでは<strong>WDI</strong>を紹介します。RパッケージWDIは，世界銀行によって運営される40以上のデータベースからデータを検索・ダウンロードすることを可能にしています。そ うしたデータベースには世界開発指標(WDI）はもちろんのこと，国際債務統計，Doing Business,人的資本指数，サブナショナルな貧困指標も含まれます。</p>
<section id="インストール方法" class="level3">
<h3 class="anchored" data-anchor-id="インストール方法">2.2.1 インストール方法</h3>
<p>RパッケージWDIはCRAN上で公開されていますのでインストールにはinstall.packages()を利用します．コ ンソール画面に次のように入力し，エンターキーを押してください．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># WDIのインストール</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">install.packages</span>(<span class="st">"WDI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>WDIを利用するために，スクリプト画面にlibrary(WDI)と入力し，実行しておきます．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># WDIのロード</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(WDI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="データを探す--wdisearch" class="level3">
<h3 class="anchored" data-anchor-id="データを探す--wdisearch">2.2.2 データを探す- WDISearch()</h3>
<p>データを探すためにはWDIパッケージに用意されたWDIsearch()関数を使います。こ の関数は利用可能なWDIデータ系列のコード名，名前，説明，およびデータソースからなる行列を返します。基本的な書式は以下の通りです。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WDIsearch</span>(<span class="at">string =</span> <span class="st">"検索語"</span>, <span class="at">field =</span> <span class="st">"name"</span>, <span class="at">short =</span> <span class="cn">TRUE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>それぞれの引数を説明しましょう．</p>
<ul>
<li><p>string = ” “に検索語（文字列）を入力します。WDIsearchは文字列マッチング関数grepを使い，”検索語”を探します。またcaseを無視します（igunore.case=TRUE）ので，正規表現―簡単に言えば，通常の文字―が利用可能です。</p></li>
<li><p>field = ” “に検索するフィールドを指定します。利用可能なフィールドは”indicator”, “name”, “description”, “sourceDatabase”, “sourceOrganization”です。たとえば “name” と入力すれば，データのnameの中を検索します．</p></li>
<li><p>short = 既定値はshort=TRUEです。この場合，指標コードと名前だけを返します。short=FALSEの場合，指標コード，名前，説明およびデータソースを返します．</p></li>
<li><p>cache: WDIcache関数によって作成されるデータリストを返します。省略された場合（あるいはNULLの場合），WDIseachはデータ系列のローカルリストを探します．</p></li>
</ul>
<pre><code>たとえば，GDPに関するデータを探すとしましょう．こ の例では検索文字列を"gdp"とし，探すフィールドを"name"にしています。ま た詳しい説明を得るためにshort=FALSEと設定しています。検索結果をオブジェクトgdpに格納します。</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>gdp <span class="ot">&lt;-</span> <span class="fu">WDIsearch</span>(<span class="at">string =</span> <span class="st">"gdp"</span>,<span class="at">field =</span> <span class="st">"name"</span>,<span class="at">short =</span> <span class="cn">FALSE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この結果をView(gdp)でみると，539×5の行列が返されます。こ こで重要なのは<strong>indicator変数</strong>です．こ れは指標コードであり，ダウンロードのさいに利用されます。</p>
<p>絞り込みが不十分なため，539行のデータ系列が表示されてしまっていますが，スクロールダウンして行くと，448行めにGDP(constant 2010 US$)が見つかります。そ のindicator名は<strong>NY.GDP.MKTP.KD</strong>です。以下の例においては，これをダウンロードします．</p>
</section>
<section id="データをダウンロードする--wdi" class="level3">
<h3 class="anchored" data-anchor-id="データをダウンロードする--wdi">2.2.3 データをダウンロードする- WDI()</h3>
<p>データをダウンロードするためにはWDI()関数を利用しますが，利用方法は次のようになります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WDI</span>(<span class="at">country =</span> <span class="st">"all"</span>,<span class="at">indicator =</span> <span class="st">"NY.GDP.MKTP.KD"</span>,<span class="at">start =</span> <span class="dv">1960</span>, <span class="at">end =</span> <span class="dv">2020</span>, <span class="at">extra =</span> <span class="cn">FALSE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この関数は６つの引数をとります．そ れぞれを簡単に説明しましょう.</p>
<ul>
<li><p>country = ” ” : ” “の中にダウンロード対象の国名（ISO-2文字コードで表現された国名）を入力します。たとえば，”US”,“CA”,“JP”です。複数の国を指定したい場合，c()を利用します。 country = c(“US”,“CA”,“JP”) と入力します。なお，“all”と入力すると，すべての利用な国のデータがダウンロードされます。</p></li>
<li><p>indicator = 指標のコード名を入力します。これは上の表のindicator列に表示されているものになります。</p></li>
<li><p>start = データの開始年です。通常整数フォーマットの年です（ただし，1960以上）。</p></li>
<li><p>end = データの終了年です。言うまでもなく，start引数に指定した値より大きくなければなりません。</p></li>
<li><p>extra = :TRUEの場合，地域，iso3コード，所得水準といった追加的な変数を返します。</p></li>
<li><p>WDIcache()によって作成されるリストで，extra = TRUEのとき利用されます。</p></li>
</ul>
<p>それではWDI()関数を使って，アメリカ経済のGDP(constant 2010 US$)をダウンロードしてみます。こ のGDPデータのindicatorコードは，上述のとおり，<strong>NY.GDP.MKTP.KD</strong>です。ダ ウンロードしたデータはgdp_usという名前をつけたオブジェクトに格納します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>gdp_us <span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">country =</span> <span class="st">"US"</span>, <span class="at">indicator =</span> <span class="st">"NY.GDP.MKTP.KD"</span>, <span class="at">start =</span> <span class="dv">1990</span>, <span class="at">end =</span> <span class="dv">2019</span>, <span class="at">extra =</span> <span class="cn">FALSE</span>, <span class="at">cache =</span> <span class="cn">NULL</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>head()やView()関数を使ってダウンロードしたデータを確認してみてください．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">head</span>(gdp_us)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>最後に，ダウンロードしたGDPデータをggplot2を使ってグラフにしてみましょう．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gdp_us, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> NY.GDP.MKTP.KD))<span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"gray"</span>)<span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">"purple"</span>,<span class="at">size =</span> <span class="fl">2.5</span>)<span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2020</span>, <span class="at">by =</span> <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"USA GDP, constant 2010 US$"</span>, <span class="at">y =</span> <span class="st">"GDP"</span>,<span class="at">x =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これを実行すると，[Plots]ウィンドウに上のグラフが表示されます。</p>
<p><img src="figs/usa_gdp_growth.png" class="img-fluid"></p>
</section>
</section>
<section id="eu統計局eurostat---eurostat" class="level2">
<h2 class="anchored" data-anchor-id="eu統計局eurostat---eurostat">2.3 EU統計局Eurostat - eurostat</h2>
<p>欧州委員会の統計局である<a href="https://ec.europa.eu/eurostat">Eurostat</a>は,オープンデータサービスを通じてヨーロッパの人口統計，経済，健康，インフラ，交通などに関する数千ものデータセットを提供しています。Rパッケージeurostatはそうした欧州統計局のオープンデータ取得のためのパッケージです。ヨーロッパ経済を実証分析の対象とする場合,とても有益なパッケージです。</p>
<section id="rパッケージeurostatの利用法" class="level3">
<h3 class="anchored" data-anchor-id="rパッケージeurostatの利用法">2.3.1 Rパッケージeurostatの利用法</h3>
<section id="パッケージeurostatのインストール" class="level4">
<h4 class="anchored" data-anchor-id="パッケージeurostatのインストール">2.3.1.1 パッケージeurostatのインストール</h4>
<p>最初に，次のようにコンソール画面に入力しエンターキーを押し，eurostatをインストールします。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># eurostatのインストール</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"eurostat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>さらにlibrary()でパッケージeurostatを呼び出し，利用できるようにしておきます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># eurostatの呼び出し</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(eurostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="データを探すget_eurostat_toc-search_eurostat" class="level4">
<h4 class="anchored" data-anchor-id="データを探すget_eurostat_toc-search_eurostat">2.3.1.2 データを探す―get_eurostat_toc(), search_eurostat()</h4>
<p><strong>get_eurostat_toc()</strong> 　関数get_eurostat_toc()はeurostatのデータセットの目次をダウンロードする関数です。最初に，この関数を使って目次をダウンロードしてみましょう。ここではダウンロードした目次をオブジェクト―euという名前にしています―に容れます. 　</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># eurostatの目次取得し,オブジェクトeuに格納</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>eu <span class="ot">&lt;-</span> <span class="fu">get_eurostat_toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>スクリプト画面にView(eu)と入力し，[Run]をクリックすると，オブジェクトeuの内容が表示されます。これは10,004行×8列のデータフレームです。１列目のtitleはデータセット名，２列目のcodeはデータセットのコード番号です。このcode列の値が，選択されたデータセットをダウンロードするために使用されます。次のtype列はデータセットかフォルダかどうかを示しています。last update of data列はデータの最新の更新日，last table structure changeはテーブル構造の最新の変更時点，そして次の2つの列はデータの開始時期と終了時期を示しています。</p>
<p><img src="figs/fig3_1.png" class="img-fluid"></p>
<p><strong>search_eurostat()</strong></p>
<p>特定の検索ワードを指定し,データを探すためにはsearch_eurostat()関数を使用します。たとえば,search_eurostat()関数の引数に “unemployment”と入力し，失業に関連したデータセットを探してみましょう。ここではその結果をパイプ(|&gt;)でView()関数につなげてViewウィンドウで表示させています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "unemployment"の検索</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">search_eurostat</span>(<span class="st">"unemployment"</span>) <span class="sc">|&gt;</span>  <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/fig3_2.png" class="img-fluid"></p>
<p>search_eurostat()関数の基本的な書き方は以下のとおりです。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search_eurostat</span>(<span class="at">pattern=</span><span class="st">"検索語"</span>, <span class="at">type =</span> <span class="st">"dataset"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このように引数にpattern,type,fixedの３つをとります。</p>
<ul>
<li><p>pattern=” “,” “の部分に探したいデータに関連したキーワードを入力します。これによりtype=引数で指定した内容に応じてデータセットやテーブルが返されます。</p></li>
<li><p>type= ” “にはdataset, folder, table, もしくは以上のすべてを指定するallのいずれかを入力します。これにより対応したEurostatのテーブルが出力されます。デフォルトではdatasetです。</p></li>
<li><p>fixedにはTRUE, FALSEの論理値をとります。TRUEの場合,patternはマッチされる文字列となります。より複雑なregexマッチングが必要とされる場合,FALSEをとります。</p></li>
</ul>
</section>
<section id="データをダウンロードするget_eurostat" class="level4">
<h4 class="anchored" data-anchor-id="データをダウンロードするget_eurostat">2.3.1.3 データをダウンロードする―get_eurostat()</h4>
<p>データをダウンロードするにはget_eurostat()を使います。もっとも基本的な書式は次のようになります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_eurostat</span>(id, <span class="at">time_format =</span> <span class="st">""</span>, <span class="at">filters =</span> <span class="st">""</span>, <span class="at">type =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この関数はおもな引数として次のものをとります.</p>
<ul>
<li><p>id= ” “:” “にデータセットのコード名を指定します。</p></li>
<li><p>time_format= ” “: eurostatフォーマットの時間列をどのタイプに変換するかを指定します。”date”（既定値）と入力した場合,期間の最初のデータによって日付フォーマットDateへと変換されます。“num”を指定すると,数値へと変換されます。テーブルが年次データの場合,デフォルトの日付フォーマットDateを使用するよりも,数値numの時間変数を使用した方が便利です，</p></li>
<li><p>filters = ” “:”none”を指定した場合,データセット全体が取得されます.一部分を取得したい場合,ここにリストを入れます（以下の例を参照してください），</p></li>
<li><p>type= ” “: 変数のタイプを指定します。具体的には”code”（デフォルト）もしくは “label”となります.これは変数の値を知りたいときに便利です（以下の例を参照してください）。</p></li>
</ul>
<p>それでは具体的な例を使ってデータをダウンロードしてみましょう。ここでは EUの「住宅価格」データを探すことにします。最初に，上で説明した<strong>search_eurostat()</strong>関数を使って取得するデータのidを確認します。その上で<strong>get_eurostat()</strong>関数を利用し,イギリス,フランス,スペインの「住宅価格」データを取得してみましょう。</p>
<p>検索結果をオブジェクトhouseに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>house <span class="ot">&lt;-</span> <span class="fu">search_eurostat</span>(<span class="st">"House"</span>,<span class="at">type=</span> <span class="st">"table"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View(house)の結果をみると,13行めに<strong>House price index - annual data</strong>（住宅価格指数,年次データ）が表示されています。これをダウンロードします.</p>
<p><img src="figs/fig3_3.png" class="img-fluid" alt="キーワード”house”の検索結果">キーワード”House”の検索結果</p>
<p>ここではダウンロードしたデータをhouse_priceと名前をつけたオブジェクトに容れます。get_eurostat()の引数id = ” “には、検索結果の<strong>code変数のtipsho20</strong> を利用します。引数time_format=”num”では数値を指定しています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>house_price<span class="ot">&lt;-</span><span class="fu">get_eurostat</span>(<span class="at">id=</span><span class="st">"tipsho20"</span>,<span class="at">time_format =</span> <span class="st">"num"</span>,<span class="at">type =</span> <span class="st">"code"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これにより４つの変数,1,483の観察値がダウンロードされます。結果をstr()で表示してみます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(house_price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_4.png" class="img-fluid figure-img"></p>
<figcaption>house_priceのデータ構造</figcaption>
</figure>
</div>
<p>最初の変数unit（単位），２番目の変数geoは地理情報,３番目の変数timeは年，最後の変数valuesが住宅価格指数を示しています。しかし,実はこれだけではそれぞれの変数がとる値が何を意味しているかは分かりません。少なくとも分かりづらい表示になっています。とりわけ,<strong>unit変数</strong>がコード名で表記されているため, <strong>“INX_A_AVG”</strong>等がわかりません。ダウロードするさいの引数<strong>type = “label”</strong>とした方が良いでしょう。デフォルトではコード名で表示されます（引数type = “code”）。変数の値の意味を知るには変数のラベルを表示させた方がコード名よりも便利です。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>house_price <span class="ot">&lt;-</span> <span class="fu">get_eurostat</span>(<span class="at">id=</span><span class="st">"tipsho20"</span>,<span class="at">time_format =</span> <span class="st">"num"</span>,<span class="at">type =</span> <span class="st">"label"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>type = “label”でダウンロードした上で，次に，以下のように入力し,変数unitがどのような値を持つか確認してみて下さい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>house_price <span class="sc">|&gt;</span> <span class="fu">distinct</span>(unit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>unit変数は1,403行から形成されますが,すべて異なった値をとるわけではありません。<strong>distinct()</strong>関数はデータフレームから()内に指定した変数のうちユニークな,つまり異なった値（行）だけを選択します。つまりユニークな値は―以下のdistinct()関数の結果をみると―３種類だけです。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_5.png" class="img-fluid figure-img" width="450"></p>
<figcaption>distinct()関数の出力結果</figcaption>
</figure>
</div>
<p>以下の例でunit変数の値を抽出条件とすることによって特定の行を抽出します。</p>
</section>
<section id="住宅価格上昇率のグラフを描く" class="level4">
<h4 class="anchored" data-anchor-id="住宅価格上昇率のグラフを描く">2.3.1.4 住宅価格上昇率のグラフを描く</h4>
<p>いくつかのヨーロッパ経済をピックアップし，住宅価格（年平均変化率）の推移と１時点における住宅価格変化率をみてみましょう。このために次のような作業を行います。</p>
<ol type="1">
<li><p>複数の国を指定し,住宅データをダウンロードする.</p></li>
<li><p>unit変数にもとづき年平均変化率を示す値（行）を抽出する.</p></li>
<li><p>ggplot2を利用し,ダウンロードしたデータの時系列グラフを作成する.</p></li>
<li><p>地理情報を利用し,ヨーロッパ地図上に2018年の住宅価格（年平均変化率）を表示させる.</p></li>
</ol>
<p><strong>1.複数の国を指定し，住宅データをダウンロードする</strong></p>
<p>最初に,国コードを容れたベクトルを作成しておきます―isoという名前にします。直接get_eurostat()関数において指定しても良いのですがスクリプトが見づらくなりますので,事前に,この作業を行っておきます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># オブジェクトisoに利用する国を容れる</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FR"</span>,<span class="st">"DE"</span>,<span class="st">"ES"</span>,<span class="st">"IT"</span>,<span class="st">"SE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2. unit変数にもとづき年平均変化率を示す値（行）およびサンプル国を抽出する</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>house_price_eu <span class="ot">&lt;-</span> house_price <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(unit <span class="sc">==</span> <span class="st">"RCH_A_AVG"</span>, geo <span class="sc">%in%</span> iso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>変数unitのとる値のうち年平均変化率を表現するラベルは”RCH_A_AVG”ですのでfilter()関数の中の抽出条件の１つに<strong>unit == “RCH_A_AVG”</strong>を指定しています。また,国を示す変数はgeoですが,このうちベクトルisoに容れた複数の国を選択するため<strong>geo %in% iso</strong>を利用しています。この表記が意味しているのは,「geo変数がisoベクトルの中のいずれかに等しい国コードをとる行を選択しなさい」ということを意味しています。これによりgeo変数のうちisoベクトルの中の国のいずれかに等しい行だけが選択されます。</p>
<p>これで行の抽出条件にマッチする行だけが選択され,house_price_euというオブジェクトに格納されます。View(house_price_eu)やstr(house_price_eu)を利用し,house_price_euの内容を確認してみてください。</p>
<p><strong>3. ggplot2を利用し,ダウンロードしたデータの時系列グラフを作成する</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> house_price_eu, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> values))<span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">shape =</span> geo))<span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 点の形状で国別を示すためにaes()の中でshpae = geoと指定</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">lty=</span>geo))<span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># さらにgeom_line()で線を重ねる</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 線の種類で国別表示するため,aes()の中でlyt=geoと指定</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x=</span><span class="st">"year"</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"Housing price"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Housing price (Annual average rate of change %)"</span>)<span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このスクリプトを実行すると,以下のようなグラフが出力されます.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_6hp.png" class="img-fluid figure-img" width="567"></p>
<figcaption>ヨーロッパ主要経済の住宅価格の推移,2001~2019</figcaption>
</figure>
</div>
<p><strong>4. 地理情報を利用し,ヨーロッパ地図上に2015年の住宅価格（年平均変化率）を表示させる</strong></p>
<p>上のグラフでは各国の住宅価格上昇率の時間的推移を比較しましたが,次に2015年の１時点をとり各国を比較してみましょう。そのさいeurostatの提供する地理空間情報<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>を利用し,2015年の住宅価格をヨーロッパの地図上に描きます。最初に出力されるグラフを示しておきましょう。地理情報の使い方の詳細については2.3.2で説明します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_7.png" class="img-fluid figure-img"></p>
<figcaption>ヨーロッパ経済の住宅価格上昇率,2015年</figcaption>
</figure>
</div>
<p>出力される結果は上のようになります。この図を描くための詳しい説明は2.3.2に譲り,ここではスクリプトだけ示しておきます。手順は４つです。</p>
<ul>
<li><p><strong>手順①</strong> ヨーロッパの地図データの取得</p></li>
<li><p><strong>手順②</strong> 住宅価格データから特定の国と2015年のデータを抽出</p></li>
<li><p><strong>手順③</strong> ２つのデータフレームの結合</p></li>
<li><p><strong>手順④</strong> geom_sf()の利用</p></li>
</ul>
<p><strong>①ヨーロッパの地図データを取得し,そのデータをshp_0という名前をつけたオブジェクトに容れる</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>shp_0 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">0</span>, <span class="at">year =</span> <span class="dv">2016</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>②上で取得した住宅価格データからヨーロッパ諸国と2015年のデータを抽出する</strong></p>
<p>そしてその結果をhousing2015というオブジェクトに容れます。最初に,上記のisoベクトルを次のように書き換え,サンプル国を拡充しておきます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AT"</span>, <span class="st">"BE"</span>, <span class="st">"CY"</span>,<span class="st">"CZ"</span>, <span class="st">"DE"</span>, <span class="st">"DK"</span>, <span class="st">"EL"</span>, <span class="st">"ES"</span>, <span class="st">"FI"</span>, <span class="st">"FR"</span>, <span class="st">"HR"</span>, <span class="st">"IE"</span>, <span class="st">"IT"</span>, <span class="st">"LT"</span>,<span class="st">"LU"</span>, <span class="st">"LV"</span>, <span class="st">"MT"</span>, <span class="st">"NL"</span>, <span class="st">"PT"</span>, <span class="st">"SE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>housing2015 <span class="ot">&lt;-</span> house_price <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span> (unit <span class="sc">==</span> <span class="st">"RCH_A_AVG"</span>, geo <span class="sc">%in%</span> iso, time <span class="sc">==</span> <span class="dv">2015</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>③オブジェクトshp_0とhousing2015を結合する</strong></p>
<p>マージしたデータは地理データと住宅価格データを持つことになります。マージしたデータにはmap_housingというオブジェクト名を与えています。２つのオブジェクトの結合には<strong>inner_join()関数</strong>を使っています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>map_housing <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp_0,housing2015, <span class="at">by =</span> <span class="st">"geo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>④ggplot2―geom_sf()―を利用し,ヨーロッパ地図上に,住宅価格上昇率を描く</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> map_housing) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">"white"</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">70</span>))<span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">"Classic Gray"</span>)<span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span> (</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Housing price (Annual average rate of change), 2015"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">"% Annual average</span><span class="sc">\n</span><span class="st">rate of change"</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>全体のスクリプトをまとめると,次のようになります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ヨーロッパの地理空間データをダウンロード</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>shp_0 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">resolution =</span> <span class="dv">10</span>,<span class="at">nuts_level =</span> <span class="dv">0</span>,<span class="at">year =</span> <span class="dv">2016</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># サンプル国を指定</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AT"</span>, <span class="st">"BE"</span>, <span class="st">"CY"</span>,<span class="st">"CZ"</span>, <span class="st">"DE"</span>, <span class="st">"DK"</span>, <span class="st">"EL"</span>, <span class="st">"ES"</span>, <span class="st">"FI"</span>, <span class="st">"FR"</span>, <span class="st">"HR"</span>, <span class="st">"IE"</span>,<span class="st">"IT"</span>, <span class="st">"LT"</span>,<span class="st">"LU"</span>, <span class="st">"LV"</span>, <span class="st">"MT"</span>, <span class="st">"NL"</span>, <span class="st">"PT"</span>, <span class="st">"SE"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># サンプル国の住宅価格（年平均変化率）データを取得.</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>housing2015 <span class="ot">&lt;-</span> house_price <span class="sc">|&gt;</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span> (unit <span class="sc">==</span> <span class="st">"RCH_A_AVG"</span>, geo <span class="sc">%in%</span> iso), time <span class="sc">==</span> <span class="dv">2015</span><span class="er">)</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 地理空間データと住宅価格データを結合</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>map_housing <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp_0,housing2015, <span class="at">by =</span> <span class="st">"geo"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ヨーロッパの地図上に住宅価格を表示.</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> map_housing) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">"white"</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">70</span>))<span class="sc">+</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">"Classic Gray"</span>)<span class="sc">+</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span> (</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Housing price (Annual average rate of change), 2015"</span>,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">"% Annual average</span><span class="sc">\n</span><span class="st">rate of change"</span>) <span class="sc">+</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このようにRパッケージeurostatを利用することにより,わずか10数行のスクリプトを書くだけで上のグラフを描くことができます。</p>
</section>
</section>
<section id="eurostatの応用例-地理空間情報の利用" class="level3">
<h3 class="anchored" data-anchor-id="eurostatの応用例-地理空間情報の利用">2.3.2 Eurostatの応用例 ― 地理空間情報の利用</h3>
<p>北欧諸国は多くのミステリー小説の傑作を生み出しています。そうした背景には社会経済的要因はもちろんのこと犯罪を身近なものと受け止める社会不安があるのかもしれません。そこで欧州委員会統計局Eurostatが提供する犯罪や暴力に対する不安度を示す指標によって,そうした社会的不安を代理させ観察することにします。そして同指標を視覚的に示すためにEurostatの提供する地理空間情報と結合し,ヨーロッパ地図上に表示します.主な手順は次のようになります,</p>
<ol type="1">
<li><p>地理空間情報(シェイプ・ファイル)をダウンロードし,ヨーロッパ地図を描く.</p></li>
<li><p>犯罪・暴力・破壊行為に対する不安度を示す指標をダンロードする.</p></li>
<li><p>1と2のファイルを結合し,不安度指標を表示した北欧地図を描く.</p></li>
</ol>
<section id="地理空間情報のダウンロードとggplot2による描画sfパッケージ" class="level5">
<h5 class="anchored" data-anchor-id="地理空間情報のダウンロードとggplot2による描画sfパッケージ"><strong>2.3.2.1 地理空間情報のダウンロードとggplot2による描画―sfパッケージ</strong></h5>
<p>地理空間データ分析用のRパッケージとしてsfパッケージがあります。sfパッケージはsimple featuresというGIS(geographic information system)データ規格をRで扱うためのパッケージです。Eurostatの提供する地理空間情報データを扱うために，最初に，このパッケージをインストールしておきます。コンソール画面に次のように入力し,エンターキーを押してください。次いでlibrary( )で呼び出しておきます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># sfパッケージのインストール</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"sf"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># sfパッケージの呼び出し</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このパッケージを利用することによって地理空間データのさまざまな処理が可能となります。</p>
<p>すでに幾度も登場しているggplot2も,バージョン3.0.0以後sfクラスのデータを扱えるようになりました。sfクラスのオブジェクトのプロットには<strong>geom_sf()</strong>という関数を使います.</p>
<p>Eurostatの地理空間情報は,国レベルの情報にとどまらず,それ以上に詳細な行政単位レベルの情報も提供しています。1970年代初頭,Eurostatは欧州連合（EU）の地域統計を作成するために,EUの領土を分割するための統一された,一貫したシステムとしてNUTS (Nomenclature of territorial units)分類を設定しました。イタリアを例にとれば,NUTSレベル0はイタリアという国そのものの（イタリア全土）,NUTSレベル１はNord-Ovest（北西部）, Sud（南部）といった地域です。さらにNUTSレベル２はPiemonte（ピエモンテ）, Liguria（リグーリア）, Lombardia（ロンバルディア）といった州です。さらに細かいレベルのNUTSレベル３はTorino（トリノ）, Genova（ジェノバ）, Milano（ミラノ）等の都市空間を示します。これにより,たとえば,個人世帯の可処分所得の地理的分布を調べたいとき,NUTSレベル2すなわち各国の州レベルまで調べること（グラフで表示すること）も可能です。</p>
<p>それでは最初に,NUTSレベル１と２のヨーロッパ地図を描いてみましょう。地図を描くためにはシェイプファイルshapefileという図形情報と属性情報を入れたファイルをダウンロードする必要があります。RパッケージeurostatはGISGOからヨーロッパの地理情報を取得する関数<strong>get_eurostat_geospatial()</strong>を用意しています.この関数の基本的な用法は次のようになります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_eurostat_geospatial</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_class =</span> <span class="st">"sf"</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resolution =</span> ,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nuts_level =</span> ,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2016</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以下はこの関数がとる引数の概要です.</p>
<ul>
<li><p>output_class　= ” “:” “に sf, df,もしくはspdfのいずれかの文字列を指定することで返されるオブジェクトのクラスを選択します。sfはsimple features,dfは data_frame, spdfはSpatialPolygonDataFrameを表現します。デフォルトは”sf”です。</p></li>
<li><p>resolution = : 地理空間データの解像度を指定します。利用可能な解像度は60（1:6,000万）,20（1:2,000万）,10（1:1,000万）,03（1:3,000万）,01（1:1,000万）のいずれかです。</p></li>
<li><p>nuts_level = : NUTS分類のレベルを指定します。0,1, 2, 3, allのいずれかをとります。</p></li>
<li><p>year = : NUTSのリリース年を指定します。具体的には,2003, 2006, 2010, 2013, 2016 のいずれかを入力します。</p></li>
</ul>
<p>それでは地理空間情報をダウンロードしてみましょう。ここではNUTSレベルの異なる２つのオブジェクトを作成します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NUTS分類のレベル0で地図情報を取得し,オブジェクトshp0に容れる</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>shp0 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">output_class =</span> <span class="st">"sf"</span>, <span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">0</span>, <span class="at">year =</span> <span class="dv">2016</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># NUTS分類のレベル2で地図情報を取得し,オブジェクトshp2に容れる</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a> shp2 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">output_class =</span> <span class="st">"sf"</span>, <span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">2</span>, <span class="at">year =</span> <span class="dv">2016</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>オブジェクト―shp0, shp2―は,引数output_class=“sf”を指定していますからsfクラスです。geom_sf()はsfクラスのオブジェクトを扱いますのでこの指定が必要となります（ただし,デフォルトでもsfクラスですから,指定しなくとも結果はsfクラスのオブジェクトとなります）。</p>
<p>NUTSレベル0は国単位を意味します。NUTSレベル２は,上述のように,イタリアで言えばロンバルディアといった州レベルの行政単位まで描かれます。ヨーロッパの地図情報が取得できましたので,ggplot2を利用しヨーロッパ地図を描いてみましょう。ggplot2にはsfクラスのオブジェクトを描くためにgeom_sf()が開発されています。グラフの作成はこれまで紹介したggplot2の利用方法に同じです。基本は<strong>ggplot(オブジェクト名)+geom_sf()</strong>です。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shp0)<span class="sc">+</span>    <span class="co"># オブジェクト名を入力</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>()        <span class="co"># sfクラスのオブジェクトを指定</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これだけでヨーロッパ地図がプロット画面に出力されます。しかし,かなり広いヨーロッパ地域が表示されてしまいます。そこでx軸,y軸の範囲を限定し,わたしたちが通常目にするヨーロッパを描くとしましょう。そのためにはxlim()を利用し,x軸の範囲を決定します。xlim（c（西に-10度, 東に37度））のように東西の経度を入力します。y軸の範囲も同様に,ylim(c(,))を利用し,緯度を入力します。あるいはggplot2のcoord_map()という関数を使っても良いでしょう。引数xlim=()で経度,ylim=()で緯度の範囲を指定することができます。たとえば,coord_map(xlim = c(-30, 45), ylim = c(30, 75))と入力することによってヨーロッパ地域を指定することができます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>nuts0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(shp0) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">65</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>わずか数行の入力で以下のグラフのようなヨーロッパ地図を描くことができます。あわせてNUTレベル2の地図も描いてみましょう。上述のグラフ作成との違いはggplot()にsfオブジェクト名shp2を指定するだけです。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>nuts2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(shp2) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">37</span>))<span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">65</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_6.png" class="img-fluid figure-img"></p>
<figcaption>異なったNUTSレベルの地理情報</figcaption>
</figure>
</div>
<p>北欧地域だけを描く場合には,x軸範囲とy軸の範囲を以下のように限定すれば,北欧地域だけの地図を描くことができます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>n_euro <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(shp0)<span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">32</span>))<span class="sc">+</span>     <span class="co">#　北欧地域の範囲を経度で指定</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">54</span>,<span class="dv">70</span>))<span class="sc">+</span>    <span class="co">#　北欧地域の範囲を緯度で指定</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="犯罪暴力破壊行為に対する不安度データのダウンロード" class="level5">
<h5 class="anchored" data-anchor-id="犯罪暴力破壊行為に対する不安度データのダウンロード"><strong>2.3.2.2 犯罪・暴力・破壊行為に対する不安度データのダウンロード</strong></h5>
<p>次に,犯罪や暴力に対する不安度データを地図上に表示するために,犯罪に関連するデータを探します。これはすでに紹介したsearch_eurostat()関数を利用します。 “crime（犯罪）”をキーワードにデータを探してみましょう.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search_eurostat</span>(<span class="st">"crime"</span>,<span class="at">type=</span><span class="st">"table"</span>) <span class="sc">|&gt;</span> <span class="fu">Vie</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>上のスクリプトを実行すると,search_eurostat()の結果をView()関数に渡しているため,crimeに関連した検索結果が表示されます。関連するデータテーブルは１つだけで<strong>sdg_16_20</strong>というファイルです。このデータは地域における犯罪・暴力・破壊行為を報告した人の比率を示しています。そうした点では人々の犯罪や暴力に対する不安度を代理する指標として良いでしょう。</p>
<p>次に,データ・テーブルsdg_16_20をダウンロードし,結果をcrimeというオブジェクトに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>crime<span class="ot">&lt;-</span><span class="fu">get_eurostat</span>(<span class="at">id=</span><span class="st">"sdg_16_20"</span>,<span class="at">time_format =</span> <span class="st">"num"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これによりヨーロッパ諸国の犯罪・暴力・破壊行為の報告者比率データを取得できます。ここから第１に,北欧４カ国とバルト３国の７ヵ国だけを抽出します。このために変数のgeoの値が”DK”,“SE”,“NO”,“FI”,“LV”,“EE”,“LT”のどれかをとる行を抽出します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(geo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DK"</span>,<span class="st">"SE"</span>,<span class="st">"NO"</span>,<span class="st">"FI"</span>,<span class="st">"LV"</span>,<span class="st">"EE"</span>,<span class="st">"LT"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ここで”geo %in% c()“は「geo変数がc（国コード）の中のいずれかに等しい国コードをとる行を選択しなさい」を意味しています。また,このデータは,incgrpという変数を持っていますが,これはincome group（所得グループ）を示し，所得階層別情報を提供しています。しかし,ここでは所得階層別情報は使いませんのでincgrp変数のうち値がTOTALの行だけを抽出します。そこで上の抽出条件にくわえて次の抽出条件も入力します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(incgrp <span class="sc">==</span> <span class="st">"TOTAL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>２つの抽出条件をあわせると,次のようになります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(geo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DK"</span>,<span class="st">"SE"</span>,<span class="st">"NO"</span>,<span class="st">"FI"</span>,<span class="st">"LV"</span>,<span class="st">"EE"</span>,<span class="st">"LT"</span>), incgrp <span class="sc">==</span> <span class="st">"TOTAL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>さらに,時間も2017年に指定し ― time == 2017 ―,最終的に次のように入力します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ne_crime <span class="ot">&lt;-</span> crime <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(time <span class="sc">==</span> <span class="dv">2017</span>, geo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DK"</span>,<span class="st">"SE"</span>,<span class="st">"NO"</span>,<span class="st">"FI"</span>,<span class="st">"LV"</span>,<span class="st">"EE"</span>,<span class="st">"LT"</span>), incgrp <span class="sc">==</span> <span class="st">"TOTAL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>filter()の基本コードはfilter(データフレーム名,抽出条件)ですが,ここではパイプ( |&gt;)を利用し,データフレームcrimeを関数filter()に渡していますのでデータフレーム名が省略されています。.最終的に,ne_crimeというオブジェクトに容れます.</p>
<p>以上で,北欧地域の犯罪や暴力に対する不安度を示す指標が取得できました。これを地図上に表示させるために地図情報の入ったshp0と結合します。</p>
<p><strong>3 シェイプファイルshp0と犯罪データファイルne_crimeの結合</strong></p>
<p>ここではヨーロッパの地図情報の入った”shp0”ファイルと,北欧地域の犯罪不安度情報の入った”ne_crime”ファイルを結合します。データフレームの結合にあたっては<strong>inner_join()</strong>関数を使います。ジョイン_join()は２つのデータテーブルの変数を結合します。inner_join()はby= “キー変数”にしたがってキーの値が等しい観察値が結合されます。したがってキー変数にマッチしない観察値は除外されます.</p>
<p>inner_join()のもっとも簡単な書き方は次のようになります.２つのデータフレームa,bがある場合,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(データフレームa,データフレームb, <span class="at">by =</span> <span class="st">"キー変数"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>それではinner_join()を利用し,shp0とne_crimeを,両データフレームに共通のgeo変数を基準に結合します。その上でshp_neというオブジェクトに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>shp_ne <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp_0, ne_crime, <span class="at">by =</span> <span class="st">"geo"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これで不安度指標と地理空間情報の入った,74行×17列のデータフレームが作成されました。残りの作業はggplot2を使って不安度指標を色の濃淡で示した北欧地図を描くだけです。</p>
<p>shp_neはsfクラスのオブジェクトです。このため描画にあたってはgeom_sf()関数に渡すだけです。この場合,何よって色分けするかをaes() で指定します。この例では犯罪・暴力・破壊行為の報告者比率を示すvalues変数の値の大きさで色分けします。このために <strong>fill = values</strong>とします。</p>
<p>具体的には,まず最初に,ggplot()にデータフレーム名を指定します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(shp_ne) <span class="sc">+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>次に,geom_sf()関数を使ってデータを地図に描きますが,変数valuesを地図上の色の濃淡で表現するためにaes(fiill = )で指定します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">"white"</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>values変数は犯罪・暴力・破壊行為の報告者比率です。さらにcolor = ” “でボーダー（国境）をwhite(白)で描き,その線の太さをsize = で指定しています。これで基本的な作業は終わりです。実行すると,犯罪・暴力・破壊行為の報告者比率がデフォルトの色の濃淡によって描かれた北欧地図が出力されます。この例ではさらに,<strong>scale_fill_continuous_tableau()</strong>を使って犯罪・暴力・破壊行為の報告者比率を描く色の濃淡をグレイに変更します。この関数によって連続したカラースケールを指定することができます。引数palett =” “部分に”Blue”, “Red”のように入力します。ここでは白黒印刷にあわせ,グレイの色を採用しています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">"Classic Gray"</span>)<span class="sc">+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>次に,labs()を使ってタイトルをつけます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The share of the population who reported </span><span class="sc">\n</span><span class="st">that they face the problem of crime, violence or vandalism, 2017"</span>,　<span class="at">fill =</span> <span class="st">"% the respondent </span><span class="sc">\n</span><span class="st">feels crime"</span>) <span class="sc">+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>英文タイトルの中のthatの前に<code>"\n"</code>が挿入されていることに気づいたと思います.これはその部分で文書の改行を命令する記号です。またfill = ” “によって色の濃淡を表示するバーのタイトルを指定しています。 最後に,背景のテーマを設定します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上のスクリプトをまとめると,つぎのようになります,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shp_ne) <span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">"white"</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">"Classic Gray"</span>)<span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The share of the population who reported </span><span class="sc">\n</span><span class="st">that they face the problem of crime, violence or vandalism, 2017"</span>,　<span class="at">fill =</span> <span class="st">"% the respondent </span><span class="sc">\n</span><span class="st">feels crime"</span>) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これを実行すると,次のようなグラフが描かれます.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_9.png" class="img-fluid figure-img"></p>
<figcaption>犯罪や暴力,破壊行為の問題に直面していると回答した人の割合（％</figcaption>
</figure>
</div>
<p>見られるように,サンプル経済の中では編集者ミカエル<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>の活躍するスウエーデンがもっとも高く,リガの犬<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>が蠢くラトビア等のバルト３国が続きます。バルト海を挟む諸国において犯罪や暴力,破壊行為の問題に直面している人々が多そうです。こうした社会的不安が犯罪小説の創造に寄与しているのかもしれません 。</p>
</section>
<section id="地理空間情報-nutsレベル3の利用" class="level5">
<h5 class="anchored" data-anchor-id="地理空間情報-nutsレベル3の利用"><strong>2.3.2.3 地理空間情報― NUTSレベル3の利用</strong></h5>
<p>さらに,スウェーデンに注目し,こうした犯罪の背景―犯罪や暴力,破壊行為―を地域レベルでみてみましょう。これまで地理空間をNUTSレベル０としてきました。つまり国単位で情報を扱っていました。次に,北欧社会の中でも,犯罪や暴力,破壊行為の問題にもっとも強く直面しているスウェーデンに注目し,NUTSレベルを3までブレークダウンし,より詳細な犯罪情報を地図上に描いてみます。</p>
<p>上で利用したデータはNUTSレベル２の情報を提供していませんが,犯罪に関連したNUTSレベル２,3のデータとしては<strong>「犯罪記録件数」(Crimes recorded by the police by NUTS 3 regions)</strong>があります。このデータをget_eurostat()を利用し,ダウンロードします。これをcrimeという名前をつけたオブジェクトに容れます。本データの<strong>id</strong>は<strong>crim_gen_reg</strong>です。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> <span class="fu">get_eurostat</span>(<span class="at">id =</span> <span class="st">"crim_gen_reg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>最初に,スウェーデンをピックアップします。このためgeo変数にfilter()をかけます。抽出条件をgeo == “SE”とすると,スウェーデンの国内の行政単位のデータ―たとえば,SE1,SE2という記号で表示―は抽出条件に合致しないため,削除されてしまいます。そこで最初に<strong>str.detect()</strong>関数を使って”SE”という文字列を持つgeo変数の行を探します。そしてそれと一致したgeo変数の行を抽出します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">str.detect</span>(geo,<span class="st">"SE"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>str.detect(geo, “SE”)はgeo変数が “SE”という文字列を含む場合,真TRUEを返します。これにfilter()を適用することによって,str.detect()関数がTRUEを返す行を抽出します。.データは2009年と2010年のみですが,ここでは2010年を採用します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(Date <span class="sc">==</span> <span class="st">"2010-01-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上,必要な行の抽出が終わりです。これまでのスクリプトをまとめると,以下のようになります。抽出結果をcrime_sweという名前をつけたオブジェクトに容れてあります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>crime_swe <span class="ot">&lt;-</span> crime <span class="sc">|&gt;</span>  </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">str_detect</span>(geo, <span class="st">"SE"</span>), time <span class="sc">==</span> <span class="st">"2009-01-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>次に,NUTSレベル３のデータをダウンロードし,shp3という名前のオブジェクトに容れます</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NUTS分類のレベル3で地図情報を取得し,オブジェクトshp3に容れる</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>shp3 <span class="ot">&lt;-</span> <span class="fu">get_eurostat_geospatial</span>(<span class="at">resolution =</span> <span class="dv">10</span>, <span class="at">nuts_level =</span> <span class="dv">3</span>, <span class="at">year =</span> <span class="dv">2016</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>それでは,crime_sweとNUTSレベル3のシェイプファイルをinner_join()関数を使って結合します。そして結合したファイルをshp3_crime_sweという名前のオブジェクトに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>shp3_crime_swe <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(shp3,crime_swe, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUTS_ID"</span><span class="ot">=</span><span class="st">"geo"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>by = “キー変数”の部分がこれまでと異なります。２つのファイルを結合するさいに,異なる変数を利用する場合,上述のように<strong>by = c(“NUTS_ID”=“geo”)</strong>とします。NUTS_IDはshp_2の中の変数,geoはcrime_sweの中の変数です。</p>
<p>これで地図を作成するデータが出来上がりました。あとはggplot２を利用するだけです。スクリプトは次のようになります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shp3_crime_swe) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>values),<span class="at">color =</span> <span class="st">"white"</span>,<span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_fill_continuous_tableau</span>(<span class="at">palette =</span> <span class="st">"Classic Gray"</span>)<span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Crimes recorded by the police,2010"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">"% the number of </span><span class="sc">\n</span><span class="st">crimes recorded by the police"</span>)<span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/fig3_10.png" class="img-fluid figure-img"></p>
<figcaption>スウェーデンにおける犯罪記録件数, 2010</figcaption>
</figure>
</div>
<p>ここでは単純に犯罪件数を表示させているだけですから,スウェーデンの中でも大都市圏―Stockholms県,Västra Götalands県やSkåne県等―で犯罪件数が多いことが理解されます。またグラフから理解されるように,犯罪件数には地理的な関連があるかもしれません。犯罪が多発する県の隣接する県でも多そうです。これは空間的なデータが相関していることを示唆しており,空間情報を分析するさいに注意を要する点です。</p>
</section>
</section>
</section>
<section id="european-commision-annual-macro-eocnomicデータベースameco---ameco" class="level2">
<h2 class="anchored" data-anchor-id="european-commision-annual-macro-eocnomicデータベースameco---ameco"><strong>2.4 European Commision Annual macro-eocnomicデータベース(AMECO) - ameco</strong></h2>
<p><a href="https://economy-finance.ec.europa.eu/economic-research-and-databases/economic-databases/ameco-database_en">AMECO</a>はEUの年次マクロ経済データ集です。EU地域のマクロデータが主ですが，それ以外のOECD諸国も含まれており，40カ国を超える国のマクロデータが提供されています。AMECOサイトからはcsv,xlsx形式等でデータをダンロードすることもできます。</p>
<section id="amecoのインストールと読み込み" class="level3">
<h3 class="anchored" data-anchor-id="amecoのインストールと読み込み">2.4.1 amecoのインストールと読み込み</h3>
<p>amecoはデータパッケージです。インストールし，読み込むと利用可能になります。Rパッケージamecoのインストールはinstall.packages(” “), ロードはlibrary()関数を使います。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># amecoのインストール</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.package</span>(<span class="st">"ameco"</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># amecoのロード</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ameco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これでデータが利用可能になります。glimpse()関数を使ってデータをみると，8変数列×2,018,002行から構成されていることが分かります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データ構造の概観</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ameco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>どのようなデータセットが含まれているかは，sub.chapter変数を見ればわかります。そこで同じデータセットを表示させないように，unique( )関数を利用し，sub.chapterを見てみましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(ameco<span class="sc">$</span>sub.chapter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これによって102のデータのタイトルを確認できます。たとえば，93行目の”02 Factor productivity, total economy”</p>
</section>
</section>
<section id="経済協力開発機構---oecd" class="level2">
<h2 class="anchored" data-anchor-id="経済協力開発機構---oecd">2.5 経済協力開発機構 - OECD</h2>
<p>OECDが提供するデータは，もちろん，OECDのサイト<a href="https://stats.oecd.org">OECD.Stat</a> からも取得できます。同 サイトに入ると，左側のウィンドウにテーマ別データ一覧が表示されており，ここから目的のデータを探すことができます。ウ ィンドウ上部にある検索ウィンドウからキーワード検索も可能です。</p>
<p>しかし、この方法ではRから離れブラウザでデータを検索し，データをダウンロードすることになります。これは煩わしい作業であることは言うまでもなく，データ分析のための再現性も難しくなるかもしれません。こうした問題に対処するために，RパッケージOECDを利用することが推奨されます。こ のパッケージによってOECDのAPIから動的で再現性の高い方法でデータをダウンロードすることができます。</p>
<section id="rパッケージoecdの利用方法" class="level3">
<h3 class="anchored" data-anchor-id="rパッケージoecdの利用方法">2.5.1 RパッケージOECDの利用方法</h3>
<p>それでは同パッケージをインストールしましょう。コ ンソール画面に次のように入力し、エンターキーを押してください。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RパッケージOECDのインストール</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"OECD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>パッケージを利用するにはlibrary()で呼び出しておく必要があります。ス クリプト画面に次のように入力し、実行しておきます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RパッケージOECDの呼び出し</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(OECD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="データを探す---get_datasets-search_dataset" class="level4">
<h4 class="anchored" data-anchor-id="データを探す---get_datasets-search_dataset">2.5.1.1 データを探す - get_datasets(), search_dataset()</h4>
<p>OECDのデータをダウンロードするにはデータ系列のidコードが必要となります。し かし，ほとんどの場合，正確なidコード情報を事前に保有していることは少ないと思います。そ こで最初に，利用可能なデータセットとその説明を含むデータフレームをダウンロードし，その上で検索を始めるのがベストの方法です。こ れは<strong>get_datasets()</strong>関数で実行できます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OECDのデータフレームのリストを取得</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_datasets</span>() <span class="sc">|&gt;</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>().  <span class="co"># head()関数でデータフレームの冒頭部分を表示</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>head()関数によって最初の６行を表示させています。全 体で1,392行×2列のデータフレームが取得されます。１列目はデータセットのid，２列目titleはデータセットのタイトル名です。こ れによってOECDにおいて、どのようなデータセットが利用可能かが分かります。</p>
<p>データセットの検索方法としては<strong>search_dataset()</strong>関数を使ってキーワードで検索する方法もあります。たとえば，失業”unemployment”をキーワードに検索してみましょう。こ れを実行すると，コンソール画面に”unemployment”を含んだデータ等の一覧が表示されます。デフォルトでは大文字小文字を区別しません。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search_dataset</span>(<span class="st">"unemployment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="データセットのダウンロード---get_dataset" class="level4">
<h4 class="anchored" data-anchor-id="データセットのダウンロード---get_dataset">2.5.1.2 データセットのダウンロード - get_dataset()</h4>
<p>それでは最初のデータセット<strong>DUR_I―Incidence of unemployment by duration</strong> (期間別の失業者発生比率％)をダウンロードしてみましょう。データのダウンロードには<strong>get_dataset()</strong>関数を使います。基本的な使い方は次のようになります,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_dataset</span>(<span class="st">"dataset"</span>, <span class="at">filter =</span> <span class="cn">NULL</span>, <span class="at">start_time =</span> <span class="cn">NULL</span>, <span class="at">end_time =</span> <span class="cn">NULL</span>,<span class="at">pre_formatted =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この関数がとる主要な引数は以下のとおりです.</p>
<ul>
<li><p>dataset : ダウンロードするデータセットのidを入力します.</p></li>
<li><p>filter= : NULLの場合、すべてダウンロードします.</p></li>
<li><p>start_time = : データの開始時点.</p></li>
<li><p>end_time = : データの終了時点.</p></li>
</ul>
<p>この関数を使ってDUR_Iデータを取得し，それをunempというオブジェクトに容れるとします。もっとも簡単なコードは次のとおりです.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>unemp<span class="ot">&lt;-</span> <span class="fu">get_dataset</span>(<span class="st">"DUR_I"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>str(unemp)でデータフレームの中をみると，8変数，155,924の観察値のデータセットがダウンロードされたことが分かります。str()関数はデータフレームの変数（列）や観測値（行）についての情報を出力させる関数です.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(unemp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>引数を指定した形でデータをダウンロードしてみましょう。<strong>引数filter</strong>を使って日本とドイツのデータ，引数start_tim,end_timeで期間を1990年から2019年のデータをダウンロードするとします。このためにはスクリプトに次のように入力するだけです，</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">get_dataset</span>(<span class="st">"DUR_I"</span>,<span class="at">filter=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"JPN"</span>,<span class="st">"DEU"</span>)),<span class="at">start_time =</span> <span class="dv">1990</span>,<span class="at">end_time =</span> <span class="dv">2019</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>また，たとえば，filter = “age”のように、変数についてもfilterを適用できます。</p>
</section>
<section id="データ構造を調べる---get_data_structure" class="level4">
<h4 class="anchored" data-anchor-id="データ構造を調べる---get_data_structure">2.5.1.3 データ構造を調べる - get_data_structure()</h4>
<p>ダウンロードしたデータの内容は，上述のように，str()関数やView()関数を利用して確認することができます。しかし，これだけではそれぞれの変数が何を意味するのか分からない場合があります。たとえば、<strong>DURATION変数</strong>が「（失業）期間」を表現していることは分かりますが，しかし，その変数がとる <strong>“UN1”, “UN3”</strong>といった値が何を意味しているかは分かりません。このためデータ構造をチェックする必要があります。</p>
<p>データ構造のチェックには<strong>get_data_structure()</strong>関数を利用します。同関数は指定したデータシリーズの変数名とその説明を返します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DUR_Iのデータ構造の説明を取得、data_strに容れます.</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>data_str<span class="ot">&lt;-</span><span class="fu">get_data_structure</span>(<span class="st">"DUR_I"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># str()関数でdata_strの中を見ます.</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_str,<span class="at">max.level =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このケースでは表示レベルをmax.level = 1を使い，１に指定しています。max.level=を利用せずに，str(data_str)と入力しても，類似した情報が得られますが，出力画面が煩雑になるので，この例ではmax.level=1に抑えています。</p>
<p>コンソール画面に上のように入力し，エンターキーを押すと，図のような出力結果が得られます。DUR_Iの説明を見ると，VAR_DESCをはじめとし，あわせて12の変数があることが分かります。ここでDURATION変数の詳細を確認してみましょう。コンソール画面に<code>data_str$DURATION</code>と入力し，エンターキーを押してみてください。.<code>$</code>記号はデータフレームの中の変数を指定する方法です。つまり、data_str$DURATIONは「データフレームdata_strの中の変数DURATIONを指定」を意味します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データフレームdata_strの中の変数DURATIONを指定.</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>data_str<span class="sc">$</span>DURATION</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これにより変数DURATIONのとる値が何を意味しているかを示した一覧が出力されます。これをみると，変数DURATIONの値”UN1”は１月未満,“UN2”は１月以上３ヶ月未満の失業期間を示すことが分かります。</p>
<p>続けて変数AGEのデータ構造も確認しておきましょう。コンソール画面にdata_str$AGEと入力し、エンターキーを押します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データフレームdata_strの中の変数AGEを指定.</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>data_str<span class="sc">$</span>AGE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このように，AGE変数はid列に記載されているように1519や1524など７つの値をとります。そしてlabelに示されているように，それぞれ年齢階層に対応しています。たとえば、6599という値は65+と表示されていますので，65歳以上ということが分かります。つまり65歳以上の失業者数です。年齢に関係ない総数は900000という数値で表現されています。</p>
<p>さらに失業者の性別を表現する変数SEXをチェックしておきましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データフレームdata_strの中の変数SEXを指定</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>data_str<span class="sc">$</span>SEX</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>変数SEXは３つの値をとることが分かります。MEN(男性)，WOMAN(女性)およびMW(両者の合計)です。</p>
</section>
</section>
</section>
<section id="金融データを取得する-imf" class="level2">
<h2 class="anchored" data-anchor-id="金融データを取得する-imf">2.6 金融データを取得する ― IMF</h2>
<section id="国際通貨基金imf---imfr" class="level3">
<h3 class="anchored" data-anchor-id="国際通貨基金imf---imfr">2.6.1 国際通貨基金(IMF) - imfr</h3>
<p>国際通貨基金<a href="https://www.imf.org/external/np/ds/matrix.htm">IFM</a>は金融データを中心に多くのデータを公開しています。Rにはそうしたデータを取得するために便利なRパッケージimfrが開発されています。最初にインストールします。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"imfr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>続けて、library()関数で呼び出します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imfr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これでRパッケージimfrが利用可能となります。I MFがAPIをつうじて公開するデータをダウンロードするには関数<strong>imf_data()</strong>を利用します.</p>
<p>このimf_data()は以下の引数をとります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imf_data</span>(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="at">database_id =</span> <span class="st">""</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="at">indicator =</span> <span class="st">""</span>,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="at">country =</span> <span class="st">""</span>,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="at">start =</span> <span class="dv">2000</span>,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="at">end =</span> <span class="fu">current_year</span>(),</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>database_id = ” ” :ダウンロードしようとする特定のデータベースのIDを指定します。</p></li>
<li><p>indicator = ” “: ダウンロードしようとするIMFの指標IDを指定します。</p></li>
<li><p>country = ” “: ISOの２桁コードを使って国を指定します。.country = ’all’とした場合、利用可能な国すべてのデータがダウンロードされます。</p></li>
<li><p>start =, end = : データの開始年と終わりの年を指定します。</p></li>
<li><p>freq: 年次データ(A)、四半期データ(Q)および月次データ(M)かを指定します。たとえば、年次データを取得する場合には、<code>freq = "A"</code>と指定します。</p></li>
</ul>
<p>それではimfrを利用し，IMFからデータをダンロードしてみましょう。ここでの例では，アメリカ，中国および日本の実効為替レートデータをダウンロードし，exch_rateというオブジェクトに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>exch_rate <span class="ot">&lt;-</span> <span class="fu">imf_data</span>(<span class="at">database_id =</span> <span class="st">"IFS"</span>,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="at">indicator =</span> <span class="st">"EREER_IX"</span>,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="at">country =</span> <span class="fu">c</span>(<span class="st">"US"</span>, <span class="st">"CN"</span>, <span class="st">"JP"</span>),</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="at">freq =</span><span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>上のスクリプトを実行することでアメリカ，中国および日本の実効為替レートがダウンロードされます。この実効為替レートは消費者物価にもとづく指数です。ダウンロードされたデータはデータフレーム形式で保存されます。str(exch_rate)でデータの構造・内容を確認してみます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(exch_rate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imfrの利用方法" class="level3">
<h3 class="anchored" data-anchor-id="imfrの利用方法">2.6.2 imfrの利用方法</h3>
<p>上の例で理解されるように，データをダウンロードするためにはdatabase_id = ““に入力する<strong>データベースID</strong>、およびindicator =”“に入力する<strong>指標ID</strong>の情報を取得しておく必要があります。このために３つの手順をとります.</p>
<ul>
<li><p>手順1 データベースを探す― imf_ids( )</p></li>
<li><p>手順2 特定のデータベースのコードリストを取得する - imf_codelist()</p></li>
<li><p>手順3 指標IDを取得する - imf_codes()</p></li>
</ul>
<p>以下の例ではデータベース<strong>International Financial Statistics(IFS)</strong>から<strong>実効為替レート</strong>をダウンロードすることを想定した手順を紹介します。</p>
<p><strong>手順1 どのようなデータベースがあるのか ― imf_ids( )</strong>*</p>
<p>データベースのIDを取得するための関数<code>imf_ids（）</code>を利用します。これを実行した結果をdbIDという名前をつけたオブジェクトに容れるとします。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>dbID <span class="ot">&lt;-</span> <span class="fu">imf_ids</span>(<span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>imf_ids()</code>は２つの引数を取ります.</p>
<ul>
<li><p>引数return_rawは論理値すなわちTRUEかFALSEを取ります。上の例のように，<code>return_raw = FALSE</code>と指定した場合，IDとその説明が入ったデータフレームが返されます。<code>return_raw = TRUE</code>の場合には，生のデータフローのリストが返されます.</p></li>
<li><p>timesは要求の最大回数を指定します.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(dbID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View()関数によってdbIDの内容を見てみましょう。次のようなデータベース一覧が出力されます。</p>
<p>IMFデータベース一覧</p>
<p>imf_ids()の結果を容れたオブジェクトdbIDの中には260行×２列のデータフレームが入っています。つまり260のデータベースIDが表示されます。<code>View(dbID)</code>によってデータフレームdbIDを内容を見てください。２列の変数すなわちデータベースIDとその説明が表示されます。これを下にスクロールしていくと，IFSというデータベースIDとその説明 ―International Financial Statistics―が見つかります。この<code>IFS</code>がデータをダウンロードするさいimf_data()関数の引数database_id = ““に入力するデータベースIDとなります。</p>
<p><strong>手順2 IFSデータセットの中の指標名を探す ― imf_codelist()</strong></p>
<p>次に，個別のIMFデータベース―この例では”IFS”―からコードリストを取得します。基本的なスクリプトの書き方は次のようになります. 　</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imf_codelist</span>(database_id, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">time =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これを使って手順１で取得したdatabase_id ―“IFS”― を利用し，データセットの中のcodeリストを取得します。ここではその結果をcodeListという名前をつけたオブジェクトに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>codeList <span class="ot">&lt;-</span> <span class="fu">imf_codelist</span>(<span class="at">database_id =</span> <span class="st">"IFS"</span>, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>imf_codelist()関数は個別IMFデータベースのコードリストを取得しますが，この関数は次の３つの引数をとります.</p>
<ul>
<li><p>database_id: imf_ids()で取得したデータベースID（文字列）を入力します.</p></li>
<li><p>return_raw: TRUEかFALSEかの論理値をとります。TRUEを指定した場合、もとのデータ構造リストを返し、FALSEを指定した場合、コードリストのコードと説明の入ったデータフレームを返します.</p></li>
<li><p>times: 要求回数を入力します.</p></li>
</ul>
<p>これによってデータベースIFSが持つコードリストが取得されます。View(codeList)で中身をみると，次のような一覧が表示されます.</p>
<p>コードリスト</p>
<p>このコードリストのdescription(説明)から理解されるように、指標IDは４行目のcode <strong>CL_INDICATOR_IFS</strong>に入っていることがわかります.</p>
<p><strong>手順3. 指標IDを取得する ― imf_codes( )</strong></p>
<p>最後に、“CL_INDICATOR_IFS”を使って指標IDを取得します.このためにはifm_codes()関数を利用します。こ の書式はつぎのようになります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imf_codes</span>(<span class="at">codelist =</span> <span class="st">""</span>, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これによってimf_data()関数の引数<code>indicator = ""</code>に指定する指標コードを取得することができます.この関数を利用し、IFSの中の指標コードを取得してみましょう.関数imd_codes()は個別のデータベースのコードを取得しますが、この関数もimf_codelist()と同様の引数をとります.ただし引数codelist = ““にはimf_codelist()によって取得したコード名を入力します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>indicatorID <span class="ot">&lt;-</span> <span class="fu">imf_codes</span>(<span class="at">codelist =</span> <span class="st">"CL_INDICATOR_IFS"</span>, <span class="at">return_raw =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これによって1679行×２列のデータフレームが得られます.View(indicatorID)によって内容を表示すると、指標コード名とその説明の一覧をみることができます.これによってimf_data()を使ってデータをダウンロードするさいに必要な情報、すなわち引数indicator =　““に入力する指標コードの情報が得られます.２列目の指標の説明を下にスクロールさせ、<strong>Exchange Rates, Nominal Effective Exchange Rate, Index</strong>を見つけてください.これに対応する１列目の指標コード<strong>ENEER_IX</strong>が入力する情報です.</p>
<p>指標コード一覧</p>
<p>以上の情報にもとづいてデータそのものがダウンロードできます.再度、スクリプトを表示しておきます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>exch_rate <span class="ot">&lt;-</span> <span class="fu">imf_data</span>(<span class="at">database_id =</span> <span class="st">"IFS"</span>,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="at">indicator =</span> <span class="st">"ENEER_IX"</span>,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="at">indicator =</span> <span class="st">"ENEER_IX"</span>,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="at">country =</span> <span class="fu">c</span>(<span class="st">"US"</span>, <span class="st">"CN"</span>, <span class="st">"JP"</span>),</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="at">freq =</span><span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ダウンロードした情報をもとにggplot2を利用して描いたグラフを描いてみましょう.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> exch_rate, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span> year, <span class="at">y =</span> ENEER_IX))<span class="sc">+</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">lty =</span> iso2c))<span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2000年台初頭、３カ国とも実効為替レートは低下傾向にありますが、2000年台半ばより、まず最初に中国、そして日本の為替レートが上昇し始めます.その後、アメリカと中国の実効為替レートは上昇し続けますが、日本は両国に比べ大きく低下し、明確に異なった為替レートの軌跡を描きます.</p>
<p>2011年に東日本大震災が発生し、日本経済はリーマンショックを超える大幅な落ち込みを見せ、不況に突入しました.2012年末に発足した第2次安倍政権は、デフレ経済からの脱却を目指し、大胆な金融緩和を実行しましたが、その結果が実効為替レートの低下に反映されたと考えられます.「日本株」はお買い得となり、海外からの投資が増加し、日経平均株が上昇します.同時に、円安は輸出を刺激し、輸出に牽引され日本経済は回復に向かいます.</p>
</section>
</section>
<section id="iloデータベース---riolstat" class="level2">
<h2 class="anchored" data-anchor-id="iloデータベース---riolstat">2.7 ILOデータベース - Riolstat</h2>
<p>このRパッケージは、ILO統計局のオンラインデータベースである<a href="https://ilostat.ilo.org/">ILOSTAT</a>に含まれるデータにアクセスし、ダウンロードし、操作するためのツールを提供します。ILOSTATのデータと関連するメタデータは、ILOSTATのウェブサイトからも直接入手できます。</p>
<p>ILOのILOSTATは労働市場統計の世界最大のリポジトリです。このデータベースには雇用、失業、賃金、労働時間、労働生産性など、すべての国と地域と幅広い労働関連のトピックをカバーしています。これには、1938年までさかのぼる時系列、年次、四半期、毎月の労働統計、国レベル、地域、世界の推定値等が含まれます。</p>
<p>ILOstat Rパッケージ(<code>'Rilostat'</code>)を利用することで、ILOSTATデータベースにアクセスし、データを検索し、ダウンロードすることができます。さらにはそうしたデータの可視化をすることも可能です。</p>
<p>最初に，Rパッケージilostatをインストールし，ロードしておきましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rilostatのインストール</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">instatll.packages</span>(<span class="st">"Rilostat"</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rilostatの読み込み</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">libarry</span>(Rilostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="データを探す" class="level3">
<h3 class="anchored" data-anchor-id="データを探す">2.7.1　データを探す</h3>
<p>第1のステップはデータを探すことです。このためにはダウンロードしようとするデータの指標コードもしくは参照領域(参照領域 - 国や地域)の情報が必要とります。そうした情報を取得するためにはget_ilostat_toc( )関数を利用します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ILOSTATで利用可能な全指標を表示</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilosta_toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この結果次のような16列×1,670行のデータセットの一覧が表示されます。id 列がデータをダウンロードするさいに利用する指標コードとなります。1,670の指標が提供されていることが理解できます。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/get_iolstat_toc() View().png" class="img-fluid figure-img"></p>
<figcaption>get_ilostat_toc()の出力結果</figcaption>
</figure>
</div>
<p>より絞り込んでデータセットを探すにはget_ilostat_toc()のとる引数を指定します。この関数は5つの引数をとります。</p>
<ul>
<li><p>segment = ” “: 指標を探す場合，”indicator”（デフォルト）を入力，国・地域のデータを探す場合は”ref_area”を指定します。searchでindicatorを探す場合，indicatorがデフォルトですの指定は不要となります。</p></li>
<li><p>lang = ” “: 英語の場合en（デフォルト）, フランス語の場合fr，スペイン語の場合esを入力します。デフォルトで利用すると思いますので，指定しなくとも問題はありません。</p></li>
<li><p>search = ” “:”none”がデフォルトになります。“検索語が入力された場合，その文字列と一致するデータセットが抽出されます。</p></li>
<li><p>filters = ” “: リスト; none(デフォルト)でtoc全体を取得し、フィルタの名前付きリストでテーブルの一部だけを取得します。リストオブジェクトの名前は ilostat toc( ) の変数コード、値は観測コードのベクトル</p></li>
<li><p>fixed = ” “: 真の場合（デフォルト）, より複雑な正規表現のマッチングが必要な場合は FALSE に変更します。</p></li>
</ul>
<p>いくつかの例を示しましょう</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "education"を含むデータセットを探す</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat_toc</span>(<span class="at">search =</span> <span class="st">"education"</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co"># アルバニアのデータセットを探す</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat_toc</span>(<span class="at">segment =</span> <span class="st">"ref_area"</span>, <span class="at">search =</span> <span class="st">"Albania"</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="co"># searchに"youth"と""adult"を含むデータセットを探す</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat_toc</span>(<span class="at">search =</span> <span class="st">"youth | adult"</span>, <span class="at">fixed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 失業または若者のデータセットを探す</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat_toc</span>(<span class="at">search =</span> <span class="st">"unemployment | youth"</span>, <span class="at">fixed =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="データをダウンロードする" class="level3">
<h3 class="anchored" data-anchor-id="データをダウンロードする">2.7.2 データをダウンロードする</h3>
<p>データをダウンロードするためにはget_ilostat( )関数を使います。この関数の主要な引数は次のようになります。</p>
<ul>
<li><p>id = ” “: データセットのid名を入力します。たとえば id =”LUU_XLU2_SEX_EDU_RT_A”</p></li>
<li><p>segment = ” ” : “indicator”（デフォルト）もしくは”ref_area”を入力します。</p></li>
<li><p>filters = : データセット全体を取得する場合は none (デフォルト)，データテーブルの一部だけを取得する場合はフィルタの名前付きリスト. リストオブジェクトの名前はilostatの変数コードであり、値は観測コードのベクトル. フィルターは変数を検出するので、部分的である可能性がある。追加オプション：</p>
<p>timefrom : データセットの開始年.</p>
<p>timeto : データセットの終了年.</p></li>
</ul>
<p>filtersについては以下の例を参考にしてください。それではこの関数を利用してILOSTATのデータをダウンロードしてみましょう。</p>
<p><strong>１つのデータセットを取得する</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat</span>(<span class="st">"UNE_2UNE_SEX_AGE_NB_A"</span>), segment <span class="ot">=</span> <span class="st">"indicator"</span><span class="er">)</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># segmentのindicatorはデフォルトですので省略可能 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>複数のデータセットを取得する</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ２つのデータをダウンロードする</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat</span>(<span class="fu">c</span>(<span class="st">"CPI_ACPI_COI_RT_M"</span>, <span class="st">'CPI_ACPI_COI_RT_Q'</span>), <span class="at">cache =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ２つの地域－アフガニスタンとトリニダード・トバゴ－の年次データをダウンロードする</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">"AFG_A"</span>,<span class="st">"TTO_A"</span>), <span class="at">segment =</span> <span class="st">"ref_area"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>filtersを使ってデータセットを取得する</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_ilostat</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">"UNE_2UNE_SEX_AGE_NB_A"</span>,<span class="st">'EMP_2EMP_SEX_AGE_NB_A'</span>), </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">filters =</span> <span class="fu">list</span>( <span class="at">ref_area =</span> <span class="st">"FRA"</span>, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">classif1 =</span> <span class="st">"AGE_YTHADULT_YGE15"</span>, </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">time =</span> <span class="st">"2016"</span>,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"T"</span>, <span class="st">'SEX_F'</span>)), <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="オープンデータポータル---dbnomics" class="level2">
<h2 class="anchored" data-anchor-id="オープンデータポータル---dbnomics">2.8 オープンデータポータル - DBnomics</h2>
<p><strong>フランスの数理経済計画予測研究所(CEPREMAP)</strong>のマクロ経済分析チーム「マクロ経済観測所」に所属するCEPREMAPモデリングチームは、広範囲な経済モデルを扱うためのソフトウェアDynareの開発と同時に、国内外の公開された経済データを集約した<a href="https://db.nomics.world">オープンデータポータルDBnomics</a>を運営しています.</p>
<p>DBnomicsは世界の経済データを一箇所に集め、しかも無料で一般に公開することを目的としたオープンソースプロジェクトです.具体的には、国内機関や国際機関 ― Eurostat, World Bank, IMF, ECB等、87のデータ提供組織・機関 ― から収集された何百万ものデータ系列が提供されています.すでにこれまでに紹介したEurostat, OECD, IMF, BISおよびPenn World Tableも提供されています.</p>
<p>たとえば、2-5でダウンロードしたデータはDBnomicsにおいても取得できます.imfrを使って得た実行為替レートは次のように入力することで得ることできます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>exch_rate_3c <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">"IMF/IFS/A.CN.ENEER_IX"</span>,<span class="st">"IMF/IFS/A.JP.ENEER_IX"</span>,<span class="st">"IMF/IFS/A.US.ENEER_IX"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>BISによって取得した長期政策利子率を取得するためには次のように入力します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>policyrate3c <span class="ot">&lt;-</span><span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">"BIS/cbpol/M.JP"</span>, <span class="st">"BIS/cbpol/M.SE"</span>,<span class="st">"BIS/cbpol/M.US"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="rパッケージ---rdbnomics" class="level3">
<h3 class="anchored" data-anchor-id="rパッケージ---rdbnomics">2.6.1 Rパッケージ - rdbnomics</h3>
<p>このデータの利用を容易にするために<code>rdbnomics</code>と呼ばれるRパッケージが開発されています.rdbnomicsパッケージは、DBnomics データシリーズへのアクセスを提供します. ダウンロードするデータ系列の指定にあたっては統一的な方法が採用されています.後で示すように、データの取得にあたってはrdb()関数の<code>idb =</code> 引数で指定しますが、そのさい、データ提供組織名/データセット名/データ系列名という形で指定します.たとえば、<code>rdb = WHO/WHS6/WHS6_102.DEU.A</code>は、データを提供する組織がWHO, データセット名がWHS６、データ系列名はWHS6_102.DEU.Aです.また系列名の末尾のDEUはドイツを示す３文字の国コード、Aは年次データであることを示しています.</p>
<section id="rdbnomicsのインストール" class="level4">
<h4 class="anchored" data-anchor-id="rdbnomicsのインストール">2.6.1.1 rdbnomicsのインストール</h4>
<p>RパッケージDBnomicsをインストールするには他のRパッケージと同様に次のように入力します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">install.packages</span>(<span class="st">"rdbnomics"</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(rdbnomics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="rdbnomicsの利用方法" class="level3">
<h3 class="anchored" data-anchor-id="rdbnomicsの利用方法">2.6.2 rdbnomicsの利用方法</h3>
<section id="rdb関数を利用したデータ系列の取得" class="level4">
<h4 class="anchored" data-anchor-id="rdb関数を利用したデータ系列の取得">2.6.2.1 rdb()関数を利用したデータ系列の取得</h4>
<p>データをダウンロードするためには、<code>rdb()</code>関数を利用します。こ の関数の利用にあたっては３つの情報が必要となります.</p>
<ul>
<li><p>データの提供機関のコードprovider_code</p></li>
<li><p>データセット・コードdataset_code</p></li>
<li><p>データ系列コードseries_code</p></li>
</ul>
<p>この３つの情報を<code>rdb()</code>関数の引数<code>ids =</code> において指定します.ids引数の書き方は次のようになります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> 提供機関コード<span class="sc">/</span>データセット・コード<span class="sc">/</span>データ系列コード</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>実際に世界保健機構WHOが提供するドイツの「病床数（人口１万人あたり）」データを取得してみましょう.このためには上の３つの情報が必要となります.データ提供機関コードはWHO, データセット・コードはWHS6, データ系列コードはWHS6_102.DEU.Aです.取得したドイツ病床数データをbeds_deuというオブジェクトに容れるとすると、次のようなスクリプトでダウンロードすることができます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>beds_deu <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="st">"WHO/WHS6/WHS6_102.DEU.A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>結果を<code>str()</code>関数を使い、beds_deuの変数を確認してみましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(beds_deu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>21の変数（列）がbeds_deuに格納されていることが分かります.<code>ids()</code>関数を利用し、データを取得すると、少なくとも次の10の変数を得ることができます.</p>
<ul>
<li><p>dataset_code</p></li>
<li><p>provider_code</p></li>
<li><p>dataset_name</p></li>
<li><p>series_code</p></li>
<li><p>original_period</p></li>
<li><p>period</p></li>
<li><p>original_value</p></li>
<li><p>value</p></li>
<li><p>@frequency</p></li>
</ul>
<p>データベースごとに異なりますが、上記以外に単位unit、地理情報geo、年次、四半期別等の情報freqを取得することもできます.</p>
<p>以下のグラフはデータフレームbeds_deuのデータををもとggplotを利用し、ドイツの病床の時系列変化のグラフを描いたものです.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> beds_deu, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period,<span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"year"</span>,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a> <span class="at">y =</span> <span class="st">"per 10000 pupulation"</span>, <span class="at">subtitle =</span> <span class="st">"Hospital beds (per 10 000 population) in German"</span>)<span class="sc">+</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src=".png" class="img-fluid"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/bedsDEU.png" class="img-fluid figure-img" width="525"></p>
<figcaption>ドイツの病床数</figcaption>
</figure>
</div>
<p>繰り返しになりますが、上述のように、データ系列を取得するためは３つの情報が必要となります.そこで３つの情報を取得するための方法を順番に紹介して行きましょう.</p>
<ol type="1">
<li><p>データを提供する機関のコード名</p></li>
<li><p>その機関の提供するデータセットのコード名</p></li>
<li><p>データ系列のコード名</p></li>
</ol>
<p><strong>1. 機関のコード名の取得</strong></p>
<p>機関コード名はrdb_providers()関数を利用することで取得できます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdb_providers</span>(<span class="at">code =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>code =</code> 引数はTRUEかFALSEの論理値をとり、既定値はFALSEです.上のように、<code>code = TRUE</code>とした場合、提供機関のコード名が表示されます.既定値FALSEにした場合、機関コード名の他に機関名nama、カバー地域region、ホームページアドレスweb site等が表示されます.</p>
<p><strong>2. データセットコードの取得</strong></p>
<p>このコードの取得のためには<code>rdb_datasets()</code>関数を使います.この関数では特定の機関を指定せずに、すべてのデータセットのリストをダウンロードすることもできますが、<code>rdb_providers()</code>で取得した機関コード指定した方が効率的です.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdb_datasets</span>(<span class="at">provider_code =</span> <span class="st">"IMF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これでIMFの提供するデータセット一覧を取得できます.</p>
<p><strong>3. データ系列リストの取得</strong></p>
<p>次に、提供機関IMFのデータセットIFSに、どのようなデータ系列が保存されているかをみます.このためには<code>rdb_series()</code>関数を利用します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdb_series</span>(<span class="at">provider_code =</span> <span class="st">"IMF"</span>, <span class="at">dataset_code =</span> <span class="st">"IFS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上の手順1 ~3は<a href="https://db.nomics.world">DBnomicsのホームページ</a>においても行うことができます.ホームページにおいて下の方にスクロールすると、[DBnomics providers]一覧が掲載されています.[IMF]International Monetary Fund選択すると、データセットの一覧を見ることができます.さらに、ここでデータセットInternational Financial statistics (IFS) [IMF/IFS]を選択すると、IFSが有するデータ系列を選択し、ダウンロードすることができるようになっています.</p>
<p>以上でDBnomicsの基本的な利用法の説明は終了です.続けていくつかの利用パタンを紹介しましょう。</p>
</section>
<section id="同一のデータセットから複数のデータ系列を取得する" class="level4">
<h4 class="anchored" data-anchor-id="同一のデータセットから複数のデータ系列を取得する">2.6.2.2 同一のデータセットから複数のデータ系列を取得する</h4>
<p>次に、複数のデータ系列をダウンロードする方法を紹介しましょう.これは<code>c( )</code>を使い、その中にデータ系列名を並べて書くことで簡単にダウンロードできます.以下のスクリプトがその例です.ダウンロードした結果は、beds3cというオブジェクトに格納されています.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>beds3c <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">"WHO/WHS6/WHS6_102.DEU.A"</span>, <span class="st">"WHO/WHS6/WHS6_102.JPN.A"</span>, <span class="st">"WHO/WHS6/WHS6_102.USA.A"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ここでは、WHOのWorld Health Statistics[WHS6]からドイツ、日本およびアメリカの病床データ -―WHS6_102.DEU.A、WHS6_102.JPN.A、WHS6_102.USA.A ―-をダウンロードし、オブジェクトbeds3cに容れています.</p>
<p>beds3cのデータをもとに３カ国のプロットを描くと、ドイツの病床の水準は日本とアメリカの中間にあるようです.一般的に言われているように、日本の病床数は多く、アメリカの病床数は低い水準にあることが分かります.また、いずれの国も傾向的には病床数は減少しているようです.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/beds_JPDEUUSA.png" class="img-fluid figure-img" width="535"></p>
<figcaption>ドイツ，日本およびUSAにおける病床数</figcaption>
</figure>
</div>
<p>このグラフは次のスクリプトによって描くことができます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> beds3c, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span>Country)<span class="sc">+</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このスクリプトでも、facet_wrap()関数を利用し、国別の複数のグラフを作成しています.facet_wrap()は使い方は次のようになります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="fu">vars</span>(分類する基準となる変数))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>また、テーマはtheme_minimal()を利用し、シンプルなテーマを選択しています.表示文字のサイズはbase_size = を利用し、９ポイントに指定しています.</p>
<p>この例ではWHOのWorld Health Statistics[WHS6]というデータセットを利用しました.この他にWHOからは次の４つのデータセットが提供されています.International Health Regulations (2005) monitoring network, Sustainable development goals, Health workforceおよびRoad Safetyです。</p>
</section>
<section id="異なったデータセットから異なったデータ系列の取得" class="level4">
<h4 class="anchored" data-anchor-id="異なったデータセットから異なったデータ系列の取得">2.6.2.3 異なったデータセットから異なったデータ系列の取得</h4>
<p>次に異なったデータセットから異なったデータ系列をダンロードしてみましょう.同じWHOの中にHealth workforce[WHO/HWV]というデータセットがあり、その中に「医師数（人口１万人あたり）」のデータが提供されています.病床数と一緒に、このデータも取得してみましょう.いずれも日本のデータです.この例では結果をbed_mdというオブジェクトに容れます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>beds_md <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">"WHO/WHS6/WHS6_102.JPN.A"</span>,<span class="st">"WHO/HWF/HWF_0001.JPN.A"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>names()関数を利用し、beds_mdが持つ変数一覧を表示させてみましょう.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(beds_md)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>データフレームbeds_mdが25変数（列）を持っていることが分かります.変数（列）はDBnomicsでは統一されています、つまり病床数データと医師数データは同一の変数の中にあります（異なる場合、変数列が追加されます）.このため病床数データの行が終了すると、医師数データの行が追加されてます.</p>
<p>このためデータを処理するさい、INDICATORもしくはseries_code変数によって識別する必要があります.</p>
<p><strong>データフレーム名$変数名</strong>を使ってデータフレームの変数を指定し、INDICATORを表示させると、19行めまではWHS6_102ですが、20行めからはHWF_0001であることが分かります.つまり19行めまではベッド数データ、20行めからは医師数のデータであることが分かります.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a> beds_md<span class="sc">$</span>INDICATOR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>次に、このデータを使って医師数とベッド数の推移のグラフを描いていみましょう.</p>
<p>最初に、このINDICATORをもとにベッド数と医師数データをそれぞれ別のデータフレーム―beds_jpn, doctor_jpn―に容れます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a> beds_jpn <span class="ot">&lt;-</span> beds_md <span class="sc">|&gt;</span> <span class="fu">filter</span>(INDICATOR <span class="sc">==</span> <span class="st">"WHS6_102"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>doctor_jpn <span class="ot">&lt;-</span> beds_md <span class="sc">|&gt;</span>  <span class="fu">filter</span>(INDICATOR <span class="sc">==</span> <span class="st">"HWF_0001"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>いずれもfilter()関数を使ってベッド数のデータの入っている行（もしくは医師数のデータの入っている行）を抽出しています.なお、filter()関数の書き方は</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(データフレーム名、抽出条件)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>です.ただし、この例ではパイプ(|&gt;)で連結していますので、データフレーム名は省略しています。抽 出条件は<code>INDICATOR == "WHS6_102"</code>です。こ れはINDICATOR変数が文字列”WHS6_102”に等しい行だけを抽出しなさいということを意味します。</p>
<p>最後に、抽出した結果つまりデータフレームを<code>ggplot()</code>に渡します。そ してggplot2を使って描いたグラフをオブジェクトbeds_figに容れます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>beds_fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> beds_jpn, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> original_period, <span class="at">y =</span> value, <span class="at">group =</span> INDICATOR)) <span class="sc">+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Hospital beds (per 10 000 population)"</span>,</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2019</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>beds_figの作成にあたっては<strong>scale_x_discrete()</strong>を利用し、x軸のラベルを変更しています.x軸の変数’orignal_period’は見た目では連続変数ですが、じっさいには文字列変数です.データフレームbeds_jpnの中のoriginal_period変数にclass()を適用すると、</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(beds_jpn<span class="sc">$</span>original_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>’orignal_period’変数が文字列であることが分かります。変 数の型を変換しても良いのですが、ここではそのまま文字列として扱い、x軸のラベルを変更します。こ のためにscale_x_discrete()を利用します. discreteは離散変数を意味し、x軸を離散変数として扱うことを示しています. 引数<strong>breaks =</strong>によってラベルの表示範囲を指定します. <strong>seq(2000, 2019, 5)</strong>は開始年を2000年とし、最後の年を2019とし、5年おきにラベルをつけるということを指示しています.</p>
<p>さらに、<strong>annotate()</strong>関数を使い、注釈をグラフに入れてあります.annotate(“text”, x = 12, y = 145, label = ““)が示しているように、annotate()関数を使ってテキスト注釈を挿入する場合は、”text”,そしてテキストの位置をx軸とy軸の座標で指定します。そ の上で挿入する注釈を<code>label = ""</code>に記入します。</p>
<p>同様に、医師数データを表示するスクリプトは次のようになります</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>doctor_fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> doctor_jpn, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> original_period, <span class="at">y =</span> value, <span class="at">group =</span> INDICATOR))<span class="sc">+</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Medical doctors (per 10,000)"</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2019</span>, <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上の2つのグラフ – beds_figとdoctor_fig – を表示させますが、そのさい、グラフのレイアウトを調整するRパッケージ’patchwork’を使い、2つのグラフを縦に並べています.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>beds_fig<span class="sc">/</span>doctor_fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/beds_doctors.png" class="img-fluid figure-img"></p>
<figcaption>日本における病床数と医師数</figcaption>
</figure>
</div>
</section>
<section id="異なったデータ提供機関および異なったデータセットからデータ系列を取得する" class="level4">
<h4 class="anchored" data-anchor-id="異なったデータ提供機関および異なったデータセットからデータ系列を取得する">2.6.2.4 異なったデータ提供機関および異なったデータセットからデータ系列を取得する</h4>
<p>これまではWHOという同一の機関からデータを取得してきましたが、最後に、異なった機関からのデータを取得する方法を紹介しておきましょう.</p>
<p>たとえば、アメリカにおける2000年台以降の失業率と自殺率の関連を知りたいとします.このためにWDIからは自殺率、ILOから失業率をダウンロードするとします.各種の機関・組織からデータを収集しているDBnomicsではデータベース横断的なデータの取得がとても簡単です.上で紹介した方法と同様に、<code>rdb()</code>関数を利用し、引数<code>ids =</code>にWDIとILOのデータを指定するだけです.</p>
<p>WDIの提供するアメリカの自殺率データのDBnomics形式の指標名は次のとおりです.ここでは性別の２種類のデータが指定されています.<strong>“WB/WDI/SH.STA.SUIC.MA.P5-US”</strong>と<strong>“WB/WDI/SH.STA.SUIC.FE.P5-US”</strong>です.</p>
<p>ダウンロードには上述のように<code>rdb(ids = "")</code>を利用します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>suicide <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span> <span class="fu">c</span>(<span class="st">"WB/WDI/SH.STA.SUIC.MA.P5-US"</span>,<span class="st">"WB/WDI/SH.STA.SUIC.FE.P5-US"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> suicide, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.integer</span>(original_period), <span class="at">y =</span> value,<span class="at">group =</span> series_name ))<span class="sc">+</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> series_name))<span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Suicide mortality rate (per 100,000 female population)"</span>,</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a> <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>)<span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_hue</span>(<span class="at">name =</span> <span class="st">""</span>,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>))<span class="sc">+</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">xlim</span> (<span class="dv">2000</span>,<span class="dv">2020</span>)<span class="sc">+</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このグラフは自殺率データをもとに描いたグラフです.グラフのx軸にはoriginal_period変数が利用されています.この変数original_periodは文字列型です.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(suicide<span class="sc">$</span>original_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>グラフのx軸にするにはこのデータ型は扱いづらいのでグラフ作成にあたっては<em>as.integer()</em>関数によって整数型に変化しています.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">class</span>(<span class="fu">as.integer</span>(suicide<span class="sc">$</span>original_period))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>ケース・ディートン著<a href="https://www.msz.co.jp/book/detail/08963/">『絶望死のアメリカ―資本主義がめざすべきもの』</a></strong>は、おもにアメリカ疾病予防管理センター（CDC）のデータをもとに1990年台から低学歴白人アメリカ人中年男性の自殺率だけが急増している事実を報告しています.グラフは学歴別ではありませんが、男性の自殺率が、女性に比べ、高い水準にあり、とりわけリーマンショック後に急増していることが伺えます.</p>
<p>また、失業率データは45-54歳年齢の男性データを利用します.これは学歴別の失業率データです.</p>
<ul>
<li><p>“ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_3.SEX_M.A”</p></li>
<li><p>“ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_6.SEX_M.A”</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">rdb</span>(<span class="at">ids =</span><span class="fu">c</span>( <span class="st">"ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_3.SEX_M.A"</span>,<span class="st">"ILO/UNE_DEAP_SEX_AGE_EDU_RT/USA.BA_453.AGE_10YRBANDS_Y45-54.EDU_ISCED11_6.SEX_M.A"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>学歴別の中年(45-54歳)男性の失業率の推移を見てみましょう.期待どおりですが、低学歴グループが高い失業率を示しています.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> unemp, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> original_period, <span class="at">y =</span> value,<span class="at">group =</span> classif2))<span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> classif2))<span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Male unemployment rate, by education level"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>)<span class="sc">+</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_hue</span>(<span class="at">name =</span> <span class="st">""</span>,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Upper secondary </span><span class="sc">\n</span><span class="st">education"</span>, <span class="st">"Bachelor's </span><span class="sc">\n</span><span class="st">or equivalent level"</span>))<span class="sc">+</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2019</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/unemp_by_ed.png" class="img-fluid figure-img"></p>
<figcaption>学歴別失業率</figcaption>
</figure>
</div>
<p>グラフから理解されるように、あきらかに低学歴グループの失業率が、学士卒のグループよりも高いことが分かります.つまり、このデータは労働市場のショックが不均等に低学歴グループに影響を与えることを示しています.</p>
<p>最後に、こうした低学歴失業率と自殺率の単純な相関を観察してみます.このために次の4つの手順を踏みます.</p>
<ol type="1">
<li><p>自殺率データから男性の自殺率だけを抽出する</p></li>
<li><p>失業率のデータから低学歴男性の失業率を抽出する</p></li>
<li><p>上の２つのデータを結合する</p></li>
<li><p>必要な変数のみ取り出し、ggplot2によって散布図を描く</p></li>
<li></li>
</ol>
<p><strong>1. 自殺率データから男性の自殺率だけを抽出する</strong></p>
<p>データフレームsuicideにfilter()関数を適用し、series_code が “WB/WDI/SH.STA.SUIC.MA.P5-US” に一致する行を取り出します.そしてその結果をsuicide_maleという名前のオブジェクトに容れます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>suicide_male <span class="ot">&lt;-</span> suicide <span class="sc">|&gt;</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(series_code <span class="sc">==</span> <span class="st">"WB/WDI/SH.STA.SUIC.MA.P5-US"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2. 失業率のデータから低学歴男性の失業率を抽出する</strong></p>
<p>　　同様に、filter()関数を使い、データフレームsuicideから低学歴中年男性の失業率を抽出します.具体的には、classif2が”EDU_ISCED11_3”に一致する行を取り出します.ここでは抽出された結果はunemp_low_edというオブジェクトに容れます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>unemp_low_ed <span class="ot">&lt;-</span> unemp <span class="sc">|&gt;</span> </span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>( classif2 <span class="sc">==</span> <span class="st">"EDU_ISCED11_3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>3. 上の２つのデータを結合する</strong></p>
<p>　上で抽出した２つのデータフレームを結合します.このためにはinner_join()関数を利用します.たとえば、A,Bという２つのデータフレームを結合するとします.この場合、inner_join()は次のように書きます. 　</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(データフレームA、データフレームB, <span class="at">by =</span> <span class="st">"結合の基準となる変数名"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>それではこの関数を使い、２つのデータフレーム — suicide_maleとunemp_low_ed — を結合します.結合にあたっての共通の変数は<strong>original_period</strong>になります.結合されたデータフレームは<strong>suicide_unemployment</strong>というオブジェクトに容れます.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>suicide_unemployment <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(suicide_male,unemp_low_ed,<span class="at">by =</span> <span class="st">"original_period"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>4　必要な変数のみ取り出し、ggplot2によって散布図を描く</strong></p>
<p>次に、select()関数を利用し、必要な変数を取り出します.その際、変数名も変更しておきます.select()関数は引数に抽出する変数名を入力するだけですが、変数名を変更する場合は<code>新しい変数名 = 古い変数名</code>と入力します.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>su <span class="ot">&lt;-</span> suicide_unemployment <span class="sc">|&gt;</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(original_period,<span class="at">suicide_rate =</span> value.x, <span class="at">unemp_rate =</span> value.y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>この例では結果を<code>su</code>というオブジェクトに格納しています.このデータフレームを利用し、最後に、ggplot2で自殺率と失業率の散布図を描くとします.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> su, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> unemp_rate, <span class="at">y =</span> suicide_rate))<span class="sc">+</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>,<span class="at">size =</span> <span class="dv">1</span>,<span class="at">color =</span> <span class="st">"gray"</span>)<span class="sc">+</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_y_continuous</span>(</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a> <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a> <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a> <span class="at">x =</span> <span class="st">"Male unemployment rate (45-54), </span><span class="sc">\n</span><span class="st">upper secondary education "</span>, <span class="at">y =</span> <span class="st">"Male suicide mortality rate </span><span class="sc">\n</span><span class="st">(per 100,000)"</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a> )<span class="sc">+</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_minimal</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/suicide_unemp.png" class="img-fluid figure-img"></p>
<figcaption>男性自殺率vs.低学歴中年労働者失業率</figcaption>
</figure>
</div>
<p>グラフ作成にあたって利用されたデータがそれほど適切なものではないため、とくに男性失業率の年齢階層別データを利用していないために、失業率と自殺率の間に何らかの関連を見出すことはできませんでした。</p>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>詳細については，<a href="http://www.ggdc.net/pwt/" class="uri">http://www.ggdc.net/pwt/</a> で提供されている Feenstra, Inklaar, and Timmer (2016, 2015) を参照してください。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Chris Brunsdon, Lex Comber著(湯谷啓明・工藤和奏・市川太祐訳)『Rによる地理空間データ解析入門』共立出版, 2018年.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>スティーグ・ラーソン著『ミレニアム』（早川文庫）シリーズの主人公.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>ヴァルランダーシリーズ,ヘニング・マンケル著『リガの犬たち』（創元社）.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>